{"file_contents":{"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/pages/shipping-accounts.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Wallet, CreditCard, Printer, Pencil, Trash2, ArrowRightLeft, Plus, Ship } from \"lucide-react\";\nimport { openPrintWindow } from \"@/lib/printStyles\";\nimport type { ShippingCompany } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\nfunction formatDateFr(dateStr: string | null | undefined): string {\n  if (!dateStr) return \"-\";\n  return new Date(dateStr).toLocaleDateString(\"fr-FR\");\n}\n\nexport default function ShippingAccounts() {\n  const { toast } = useToast();\n  const [selectedCompany, setSelectedCompany] = useState(\"\");\n  const [addCompanyOpen, setAddCompanyOpen] = useState(false);\n  const [newCompanyName, setNewCompanyName] = useState(\"\");\n  const [newCompanyPhone, setNewCompanyPhone] = useState(\"\");\n  const [newCompanyAddress, setNewCompanyAddress] = useState(\"\");\n  const [paymentDialogOpen, setPaymentDialogOpen] = useState(false);\n  const [payAmount, setPayAmount] = useState(\"\");\n  const [payCurrency, setPayCurrency] = useState(\"CNY\");\n  const [payNote, setPayNote] = useState(\"\");\n  const [editPaymentDialogOpen, setEditPaymentDialogOpen] = useState(false);\n  const [editPayment, setEditPayment] = useState<any>(null);\n  const [editAmount, setEditAmount] = useState(\"\");\n  const [editCurrency, setEditCurrency] = useState(\"CNY\");\n  const [editNote, setEditNote] = useState(\"\");\n  const [deletePaymentId, setDeletePaymentId] = useState<number | null>(null);\n  const [convertDialogOpen, setConvertDialogOpen] = useState(false);\n  const [convertPayment, setConvertPayment] = useState<any>(null);\n  const [convertRate, setConvertRate] = useState(\"\");\n  const printRef = useRef<HTMLDivElement>(null);\n\n  const { data: companies } = useQuery<ShippingCompany[]>({\n    queryKey: [\"/api/shipping-companies\"],\n  });\n\n  const { data: accountData, isLoading: accountLoading } = useQuery<any>({\n    queryKey: [\"/api/shipping-companies\", selectedCompany, \"account\"],\n    enabled: !!selectedCompany,\n  });\n\n  const addCompanyMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await apiRequest(\"POST\", \"/api/shipping-companies\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/shipping-companies\"] });\n      setAddCompanyOpen(false);\n      setNewCompanyName(\"\");\n      setNewCompanyPhone(\"\");\n      setNewCompanyAddress(\"\");\n      toast({ title: \"تم إضافة شركة الشحن بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const paymentMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await apiRequest(\"POST\", \"/api/shipping-payments\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/shipping-companies\", selectedCompany, \"account\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/summary\"] });\n      setPaymentDialogOpen(false);\n      setPayAmount(\"\");\n      setPayNote(\"\");\n      toast({ title: \"تم تسجيل الدفعة بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updatePaymentMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: any }) => {\n      const res = await apiRequest(\"PATCH\", `/api/shipping-payments/${id}`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/shipping-companies\", selectedCompany, \"account\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/summary\"] });\n      setEditPaymentDialogOpen(false);\n      setEditPayment(null);\n      toast({ title: \"تم تحديث الدفعة بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deletePaymentMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/shipping-payments/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/shipping-companies\", selectedCompany, \"account\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/summary\"] });\n      setDeletePaymentId(null);\n      toast({ title: \"تم حذف الدفعة بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const convertPaymentMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: any }) => {\n      const res = await apiRequest(\"PATCH\", `/api/shipping-payments/${id}`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/shipping-companies\", selectedCompany, \"account\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/summary\"] });\n      setConvertDialogOpen(false);\n      setConvertPayment(null);\n      setConvertRate(\"\");\n      toast({ title: \"تم تحويل العملة بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const handlePayment = () => {\n    if (!payAmount || !selectedCompany) return;\n    paymentMutation.mutate({\n      shippingCompanyId: parseInt(selectedCompany),\n      amount: parseFloat(payAmount),\n      currency: payCurrency,\n      note: payNote,\n    });\n  };\n\n  const openEditPayment = (pay: any) => {\n    setEditPayment(pay);\n    setEditAmount(String(pay.amount));\n    setEditCurrency(pay.currency);\n    setEditNote(pay.note || \"\");\n    setEditPaymentDialogOpen(true);\n  };\n\n  const handleUpdatePayment = () => {\n    if (!editPayment) return;\n    updatePaymentMutation.mutate({\n      id: editPayment.id,\n      data: {\n        amount: parseFloat(editAmount),\n        currency: editCurrency,\n        note: editNote,\n      },\n    });\n  };\n\n  const openConvertPayment = (pay: any) => {\n    setConvertPayment(pay);\n    setConvertRate(\"\");\n    setConvertDialogOpen(true);\n  };\n\n  const handleConvert = () => {\n    if (!convertPayment || !convertRate) return;\n    const rate = parseFloat(convertRate);\n    if (rate <= 0) return;\n    const newAmount = convertPayment.amount * rate;\n    const newCurrency = convertPayment.currency === \"CNY\" ? \"USD\" : \"CNY\";\n    const notePrefix = `تحويل من ${convertPayment.currency === \"CNY\" ? \"يوان\" : \"دولار\"} بسعر ${rate}`;\n    const existingNote = convertPayment.note ? ` | ${convertPayment.note}` : \"\";\n    convertPaymentMutation.mutate({\n      id: convertPayment.id,\n      data: {\n        amount: parseFloat(newAmount.toFixed(2)),\n        currency: newCurrency,\n        note: notePrefix + existingNote,\n      },\n    });\n  };\n\n  const handlePrint = () => {\n    const printContent = printRef.current;\n    if (!printContent) return;\n    const companyName = companies?.find(c => c.id === parseInt(selectedCompany))?.name || \"\";\n    openPrintWindow({\n      title: \"كشف حساب شركة الشحن\",\n      subtitle: companyName,\n      content: printContent.innerHTML,\n    });\n  };\n\n  const remainingCNY = (accountData?.totalCNY || 0) - (accountData?.paidCNY || 0);\n  const remainingUSD = (accountData?.totalUSD || 0) - (accountData?.paidUSD || 0);\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-shipping-accounts-title\">حسابات شركات الشحن</h1>\n          <p className=\"text-muted-foreground\">عرض أرصدة ومدفوعات شركات الشحن</p>\n        </div>\n        <div className=\"flex gap-2 flex-wrap\">\n          <Dialog open={addCompanyOpen} onOpenChange={setAddCompanyOpen}>\n            <DialogTrigger asChild>\n              <Button variant=\"outline\" data-testid=\"button-add-shipping-company\">\n                <Plus className=\"h-4 w-4\" />\n                إضافة شركة شحن\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>إضافة شركة شحن</DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4 pt-4\">\n                <div className=\"space-y-2\">\n                  <Label>اسم الشركة</Label>\n                  <Input data-testid=\"input-new-company-name\" value={newCompanyName} onChange={(e) => setNewCompanyName(e.target.value)} placeholder=\"اسم شركة الشحن\" />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>الهاتف</Label>\n                  <Input data-testid=\"input-new-company-phone\" value={newCompanyPhone} onChange={(e) => setNewCompanyPhone(e.target.value)} placeholder=\"رقم الهاتف\" />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>العنوان</Label>\n                  <Input data-testid=\"input-new-company-address\" value={newCompanyAddress} onChange={(e) => setNewCompanyAddress(e.target.value)} placeholder=\"العنوان\" />\n                </div>\n                <Button className=\"w-full\" onClick={() => addCompanyMutation.mutate({ name: newCompanyName, phone: newCompanyPhone, address: newCompanyAddress })} disabled={!newCompanyName || addCompanyMutation.isPending} data-testid=\"button-submit-company\">\n                  {addCompanyMutation.isPending ? \"جاري الإضافة...\" : \"إضافة\"}\n                </Button>\n              </div>\n            </DialogContent>\n          </Dialog>\n          {selectedCompany && accountData && (\n            <Button variant=\"outline\" onClick={handlePrint} data-testid=\"button-print-shipping-account\">\n              <Printer className=\"h-4 w-4\" />\n              طباعة كشف الحساب\n            </Button>\n          )}\n        </div>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label>اختر شركة الشحن</Label>\n        <Select value={selectedCompany} onValueChange={setSelectedCompany}>\n          <SelectTrigger className=\"max-w-sm\" data-testid=\"select-shipping-company\">\n            <SelectValue placeholder=\"اختر شركة الشحن لعرض حسابها\" />\n          </SelectTrigger>\n          <SelectContent>\n            {companies?.map((c) => (\n              <SelectItem key={c.id} value={String(c.id)}>{c.name}</SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n\n      {selectedCompany && (\n        <>\n          {accountLoading ? (\n            <div className=\"space-y-4\">\n              <Skeleton className=\"h-32 w-full\" />\n              <Skeleton className=\"h-48 w-full\" />\n            </div>\n          ) : accountData ? (\n            <div className=\"space-y-6\" ref={printRef}>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm font-medium text-muted-foreground\">إجمالي المستحق (يوان)</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <span className=\"text-2xl font-bold\" data-testid=\"text-sc-total-cny\">{(accountData.totalCNY || 0).toFixed(2)}</span>\n                    <span className=\"text-sm text-muted-foreground mr-1\">CNY</span>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm font-medium text-muted-foreground\">إجمالي المستحق (دولار)</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <span className=\"text-2xl font-bold\" data-testid=\"text-sc-total-usd\">{(accountData.totalUSD || 0).toFixed(2)}</span>\n                    <span className=\"text-sm text-muted-foreground mr-1\">USD</span>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm font-medium text-muted-foreground\">إجمالي المدفوع</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-1\">\n                      <div><span className=\"text-lg font-bold\" data-testid=\"text-sc-paid-cny\">{(accountData.paidCNY || 0).toFixed(2)}</span> <span className=\"text-sm text-muted-foreground\">CNY</span></div>\n                      <div><span className=\"text-lg font-bold\" data-testid=\"text-sc-paid-usd\">{(accountData.paidUSD || 0).toFixed(2)}</span> <span className=\"text-sm text-muted-foreground\">USD</span></div>\n                    </div>\n                  </CardContent>\n                </Card>\n                <Card className=\"border-destructive/30\">\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm font-medium text-destructive\">المبلغ المتبقي</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-1\">\n                      {(remainingCNY > 0 || accountData.totalCNY > 0) && (\n                        <div>\n                          <span className=\"text-lg font-bold text-destructive\" data-testid=\"text-sc-remaining-cny\">{remainingCNY.toFixed(2)}</span>\n                          <span className=\"text-sm text-muted-foreground mr-1\">CNY</span>\n                        </div>\n                      )}\n                      {(remainingUSD > 0 || accountData.totalUSD > 0) && (\n                        <div>\n                          <span className=\"text-lg font-bold text-destructive\" data-testid=\"text-sc-remaining-usd\">{remainingUSD.toFixed(2)}</span>\n                          <span className=\"text-sm text-muted-foreground mr-1\">USD</span>\n                        </div>\n                      )}\n                      {remainingCNY <= 0 && remainingUSD <= 0 && (\n                        <Badge variant=\"secondary\" className=\"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200\">\n                          تم السداد بالكامل\n                        </Badge>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                <h2 className=\"text-lg font-semibold\">الحاويات</h2>\n                <Dialog open={paymentDialogOpen} onOpenChange={setPaymentDialogOpen}>\n                  <DialogTrigger asChild>\n                    <Button data-testid=\"button-add-shipping-payment\">\n                      <CreditCard className=\"h-4 w-4\" />\n                      تسجيل دفعة\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent>\n                    <DialogHeader>\n                      <DialogTitle>تسجيل دفعة لشركة الشحن</DialogTitle>\n                    </DialogHeader>\n                    <div className=\"space-y-4 pt-4\">\n                      <div className=\"space-y-2\">\n                        <Label>المبلغ</Label>\n                        <Input data-testid=\"input-sp-amount\" type=\"number\" step=\"0.01\" value={payAmount} onChange={(e) => setPayAmount(e.target.value)} placeholder=\"0.00\" />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label>العملة</Label>\n                        <Select value={payCurrency} onValueChange={setPayCurrency}>\n                          <SelectTrigger data-testid=\"select-sp-currency\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"CNY\">يوان صيني</SelectItem>\n                            <SelectItem value=\"USD\">دولار أمريكي</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label>ملاحظة</Label>\n                        <Input data-testid=\"input-sp-note\" value={payNote} onChange={(e) => setPayNote(e.target.value)} placeholder=\"ملاحظة اختيارية\" />\n                      </div>\n                      <Button className=\"w-full\" onClick={handlePayment} disabled={paymentMutation.isPending} data-testid=\"button-submit-sp\">\n                        {paymentMutation.isPending ? \"جاري التسجيل...\" : \"تسجيل الدفعة\"}\n                      </Button>\n                    </div>\n                  </DialogContent>\n                </Dialog>\n              </div>\n\n              {accountData.containers && accountData.containers.length > 0 ? (\n                <Card>\n                  <CardContent className=\"pt-6\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>رقم الحاوية</TableHead>\n                          <TableHead>رقم الفاتورة</TableHead>\n                          <TableHead>الحالة</TableHead>\n                          <TableHead>السعر (يوان)</TableHead>\n                          <TableHead>السعر (دولار)</TableHead>\n                          <TableHead>التاريخ</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {accountData.containers.map((cont: any) => (\n                          <TableRow key={cont.id}>\n                            <TableCell className=\"font-medium\">{cont.containerNumber || `#${cont.id}`}</TableCell>\n                            <TableCell>{cont.invoiceNumber || \"-\"}</TableCell>\n                            <TableCell>\n                              <Badge variant=\"secondary\">\n                                {cont.status === \"arrived\" ? \"وصلت\" : \"في الشحن\"}\n                              </Badge>\n                            </TableCell>\n                            <TableCell>{(cont.priceCNY || 0).toFixed(2)}</TableCell>\n                            <TableCell>{(cont.priceUSD || 0).toFixed(2)}</TableCell>\n                            <TableCell className=\"text-sm\">{formatDateFr(cont.createdAt)}</TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </CardContent>\n                </Card>\n              ) : (\n                <Card>\n                  <CardContent className=\"flex flex-col items-center justify-center py-8 text-center\">\n                    <Ship className=\"h-10 w-10 text-muted-foreground mb-2\" />\n                    <p className=\"text-muted-foreground\">لا توجد حاويات لهذه الشركة</p>\n                  </CardContent>\n                </Card>\n              )}\n\n              {accountData.payments && accountData.payments.length > 0 && (\n                <div className=\"space-y-4\">\n                  <h2 className=\"text-lg font-semibold\">سجل المدفوعات</h2>\n                  <Card>\n                    <CardContent className=\"pt-6\">\n                      <Table>\n                        <TableHeader>\n                          <TableRow>\n                            <TableHead>التاريخ</TableHead>\n                            <TableHead>المبلغ</TableHead>\n                            <TableHead>العملة</TableHead>\n                            <TableHead>ملاحظة</TableHead>\n                            <TableHead>إجراءات</TableHead>\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          {accountData.payments.map((pay: any) => (\n                            <TableRow key={pay.id} data-testid={`row-sp-${pay.id}`}>\n                              <TableCell className=\"text-sm\">{formatDateFr(pay.createdAt)}</TableCell>\n                              <TableCell className=\"font-semibold\">{pay.amount?.toFixed(2)}</TableCell>\n                              <TableCell>{pay.currency === \"CNY\" ? \"يوان\" : \"دولار\"}</TableCell>\n                              <TableCell className=\"text-sm text-muted-foreground\">{pay.note || \"-\"}</TableCell>\n                              <TableCell>\n                                <div className=\"flex gap-1\">\n                                  <Button size=\"icon\" variant=\"ghost\" onClick={() => openEditPayment(pay)} data-testid={`button-edit-sp-${pay.id}`}>\n                                    <Pencil className=\"h-4 w-4\" />\n                                  </Button>\n                                  <Button size=\"icon\" variant=\"ghost\" onClick={() => openConvertPayment(pay)} data-testid={`button-convert-sp-${pay.id}`}>\n                                    <ArrowRightLeft className=\"h-4 w-4\" />\n                                  </Button>\n                                  <Button size=\"icon\" variant=\"ghost\" onClick={() => setDeletePaymentId(pay.id)} data-testid={`button-delete-sp-${pay.id}`}>\n                                    <Trash2 className=\"h-4 w-4 text-destructive\" />\n                                  </Button>\n                                </div>\n                              </TableCell>\n                            </TableRow>\n                          ))}\n                        </TableBody>\n                      </Table>\n                    </CardContent>\n                  </Card>\n                </div>\n              )}\n            </div>\n          ) : null}\n        </>\n      )}\n\n      {!selectedCompany && (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n            <Wallet className=\"h-12 w-12 text-muted-foreground mb-3\" />\n            <p className=\"text-muted-foreground\">اختر شركة شحن لعرض حسابها</p>\n          </CardContent>\n        </Card>\n      )}\n\n      <Dialog open={editPaymentDialogOpen} onOpenChange={setEditPaymentDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>تعديل الدفعة</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"space-y-2\">\n              <Label>المبلغ</Label>\n              <Input data-testid=\"input-edit-sp-amount\" type=\"number\" step=\"0.01\" value={editAmount} onChange={(e) => setEditAmount(e.target.value)} placeholder=\"0.00\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>العملة</Label>\n              <Select value={editCurrency} onValueChange={setEditCurrency}>\n                <SelectTrigger data-testid=\"select-edit-sp-currency\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"CNY\">يوان صيني</SelectItem>\n                  <SelectItem value=\"USD\">دولار أمريكي</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>ملاحظة</Label>\n              <Input data-testid=\"input-edit-sp-note\" value={editNote} onChange={(e) => setEditNote(e.target.value)} placeholder=\"ملاحظة اختيارية\" />\n            </div>\n            <Button className=\"w-full\" onClick={handleUpdatePayment} disabled={updatePaymentMutation.isPending} data-testid=\"button-submit-edit-sp\">\n              {updatePaymentMutation.isPending ? \"جاري التحديث...\" : \"تحديث الدفعة\"}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={convertDialogOpen} onOpenChange={setConvertDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>تحويل العملة</DialogTitle>\n          </DialogHeader>\n          {convertPayment && (\n            <div className=\"space-y-4 pt-4\">\n              <div className=\"p-4 bg-muted rounded-md space-y-2\">\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-sm text-muted-foreground\">المبلغ الحالي:</span>\n                  <span className=\"font-semibold\">{convertPayment.amount?.toFixed(2)} {convertPayment.currency === \"CNY\" ? \"يوان\" : \"دولار\"}</span>\n                </div>\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-sm text-muted-foreground\">التحويل إلى:</span>\n                  <span className=\"font-semibold\">{convertPayment.currency === \"CNY\" ? \"دولار أمريكي\" : \"يوان صيني\"}</span>\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <Label>سعر التحويل</Label>\n                <Input data-testid=\"input-convert-sp-rate\" type=\"number\" step=\"0.001\" value={convertRate} onChange={(e) => setConvertRate(e.target.value)} placeholder=\"أدخل سعر التحويل\" />\n              </div>\n              {convertRate && parseFloat(convertRate) > 0 && (\n                <div className=\"p-3 bg-muted rounded-md text-center\">\n                  <span className=\"text-sm text-muted-foreground\">المبلغ بعد التحويل: </span>\n                  <span className=\"font-bold text-lg\">\n                    {(convertPayment.amount * parseFloat(convertRate)).toFixed(2)} {convertPayment.currency === \"CNY\" ? \"USD\" : \"CNY\"}\n                  </span>\n                </div>\n              )}\n              <Button className=\"w-full\" onClick={handleConvert} disabled={convertPaymentMutation.isPending || !convertRate} data-testid=\"button-submit-convert-sp\">\n                {convertPaymentMutation.isPending ? \"جاري التحويل...\" : \"تأكيد التحويل\"}\n              </Button>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={!!deletePaymentId} onOpenChange={(open) => { if (!open) setDeletePaymentId(null); }}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>تأكيد الحذف</AlertDialogTitle>\n            <AlertDialogDescription>هل أنت متأكد من حذف هذه الدفعة؟ لا يمكن التراجع عن هذا الإجراء.</AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter className=\"flex gap-2\">\n            <AlertDialogCancel>إلغاء</AlertDialogCancel>\n            <AlertDialogAction onClick={() => deletePaymentId && deletePaymentMutation.mutate(deletePaymentId)} data-testid=\"button-confirm-delete-sp\">\n              حذف\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":28369,"size_tokens":null},"server/storage.ts":{"content":"import { eq, and, sql, desc } from \"drizzle-orm\";\nimport { db } from \"./db\";\nimport {\n  categories, suppliers, warehouses, products, orders, orderItems,\n  deliveries, deliveryItems, containers, containerItems, payments, users, productParts, userCategories,\n  shippingCompanies, shippingPayments, cashboxTransactions, expenses, containerDocuments,\n  type InsertCategory, type Category,\n  type InsertSupplier, type Supplier,\n  type InsertShippingCompany, type ShippingCompany,\n  type InsertWarehouse, type Warehouse,\n  type InsertProduct, type Product,\n  type InsertOrder, type Order,\n  type InsertOrderItem, type OrderItem,\n  type InsertDelivery, type Delivery,\n  type InsertDeliveryItem, type DeliveryItem,\n  type InsertContainer, type Container,\n  type InsertContainerItem, type ContainerItem,\n  type InsertPayment, type Payment,\n  type InsertShippingPayment, type ShippingPayment,\n  type InsertUser, type User,\n  type InsertProductPart, type ProductPart,\n  type UserCategory,\n  type InsertCashboxTransaction, type CashboxTransaction,\n  type InsertExpense, type Expense,\n} from \"@shared/schema\";\n\nexport interface IStorage {\n  getCategories(): Promise<Category[]>;\n  createCategory(data: InsertCategory): Promise<Category>;\n  updateCategory(id: number, data: Partial<InsertCategory>): Promise<Category | undefined>;\n  getSuppliers(): Promise<Supplier[]>;\n  createSupplier(data: InsertSupplier): Promise<Supplier>;\n  getShippingCompanies(): Promise<ShippingCompany[]>;\n  createShippingCompany(data: InsertShippingCompany): Promise<ShippingCompany>;\n  updateShippingCompany(id: number, data: Partial<InsertShippingCompany>): Promise<ShippingCompany | undefined>;\n  deleteShippingCompany(id: number): Promise<void>;\n  getWarehouses(): Promise<Warehouse[]>;\n  createWarehouse(data: InsertWarehouse): Promise<Warehouse>;\n  getProducts(): Promise<Product[]>;\n  getProductsByStatus(status: string): Promise<Product[]>;\n  createProduct(data: InsertProduct): Promise<Product>;\n  updateProductStatus(id: number, status: string): Promise<Product | undefined>;\n  getOrders(): Promise<any[]>;\n  createOrder(supplierId: number, items: any[]): Promise<Order>;\n  updateOrderItem(itemId: number, data: any): Promise<any>;\n  getSupplierOrderedItems(supplierId: number): Promise<any[]>;\n  createDelivery(supplierId: number, warehouseId: number, items: any[]): Promise<Delivery>;\n  getDeliveries(): Promise<any[]>;\n  getContainers(): Promise<any[]>;\n  createContainer(data: any, items: any[]): Promise<Container>;\n  updateContainer(id: number, data: any): Promise<Container | undefined>;\n  markContainerArrived(containerId: number): Promise<Container | undefined>;\n  updateProduct(id: number, data: Partial<InsertProduct>): Promise<Product | undefined>;\n  deleteProduct(id: number): Promise<void>;\n  updateSupplier(id: number, data: Partial<InsertSupplier>): Promise<Supplier | undefined>;\n  deleteSupplier(id: number): Promise<void>;\n  deleteCategory(id: number): Promise<void>;\n  getSupplierAccount(supplierId: number): Promise<any>;\n  getShippingCompanyAccount(companyId: number): Promise<any>;\n  createPayment(data: InsertPayment): Promise<Payment>;\n  updatePayment(id: number, data: Partial<InsertPayment>): Promise<Payment | undefined>;\n  deletePayment(id: number): Promise<void>;\n  createShippingPayment(data: InsertShippingPayment): Promise<ShippingPayment>;\n  updateShippingPayment(id: number, data: Partial<InsertShippingPayment>): Promise<ShippingPayment | undefined>;\n  deleteShippingPayment(id: number): Promise<void>;\n  getProductParts(productId: number): Promise<ProductPart[]>;\n  createProductPart(data: InsertProductPart): Promise<ProductPart>;\n  deleteProductPart(id: number): Promise<void>;\n  getWarehouseInventory(): Promise<any[]>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserById(id: number): Promise<User | undefined>;\n  createUser(data: InsertUser): Promise<User>;\n  updateUser(id: number, data: Partial<{ username: string; password: string; displayName: string }>): Promise<User | undefined>;\n  getUsers(): Promise<User[]>;\n  getUserCategories(userId: number): Promise<number[]>;\n  setUserCategories(userId: number, categoryIds: number[]): Promise<void>;\n  getCashboxTransactions(): Promise<any[]>;\n  getCashboxSummary(): Promise<any>;\n  createCashboxTransaction(data: InsertCashboxTransaction): Promise<CashboxTransaction>;\n  updateCashboxTransaction(id: number, data: Partial<InsertCashboxTransaction>): Promise<CashboxTransaction | undefined>;\n  deleteCashboxTransaction(id: number): Promise<void>;\n  getExpenses(): Promise<Expense[]>;\n  createExpense(data: InsertExpense): Promise<Expense>;\n  updateExpense(id: number, data: Partial<InsertExpense>): Promise<Expense | undefined>;\n  deleteExpense(id: number): Promise<void>;\n  getCashboxByExpenseId(expenseId: number): Promise<CashboxTransaction | undefined>;\n  deleteCashboxByExpenseId(expenseId: number): Promise<void>;\n  updateCashboxByExpenseId(expenseId: number, data: Partial<InsertCashboxTransaction>): Promise<CashboxTransaction | undefined>;\n  getContainerDocuments(): Promise<any[]>;\n  getContainerDocument(id: number): Promise<any>;\n  updateContainerDocument(id: number, data: any): Promise<any>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getCategories(): Promise<Category[]> {\n    return db.select().from(categories);\n  }\n\n  async createCategory(data: InsertCategory): Promise<Category> {\n    const [cat] = await db.insert(categories).values(data).returning();\n    return cat;\n  }\n\n  async updateCategory(id: number, data: Partial<InsertCategory>): Promise<Category | undefined> {\n    const [cat] = await db.update(categories).set(data).where(eq(categories.id, id)).returning();\n    return cat;\n  }\n\n  async getSuppliers(): Promise<Supplier[]> {\n    return db.select().from(suppliers);\n  }\n\n  async createSupplier(data: InsertSupplier): Promise<Supplier> {\n    const [sup] = await db.insert(suppliers).values(data).returning();\n    return sup;\n  }\n\n  async getShippingCompanies(): Promise<ShippingCompany[]> {\n    return db.select().from(shippingCompanies);\n  }\n\n  async createShippingCompany(data: InsertShippingCompany): Promise<ShippingCompany> {\n    const [sc] = await db.insert(shippingCompanies).values(data).returning();\n    return sc;\n  }\n\n  async updateShippingCompany(id: number, data: Partial<InsertShippingCompany>): Promise<ShippingCompany | undefined> {\n    const [updated] = await db.update(shippingCompanies).set(data).where(eq(shippingCompanies.id, id)).returning();\n    return updated;\n  }\n\n  async deleteShippingCompany(id: number): Promise<void> {\n    const relatedContainers = await db.select().from(containers).where(eq(containers.shippingCompanyId, id));\n    const relatedPayments = await db.select().from(shippingPayments).where(eq(shippingPayments.shippingCompanyId, id));\n    if (relatedContainers.length > 0 || relatedPayments.length > 0) {\n      throw new Error(\"لا يمكن حذف شركة الشحن لوجود عمليات مرتبطة بها\");\n    }\n    await db.delete(shippingCompanies).where(eq(shippingCompanies.id, id));\n  }\n\n  async getWarehouses(): Promise<Warehouse[]> {\n    return db.select().from(warehouses);\n  }\n\n  async createWarehouse(data: InsertWarehouse): Promise<Warehouse> {\n    const [wh] = await db.insert(warehouses).values(data).returning();\n    return wh;\n  }\n\n  async updateWarehouse(id: number, data: Partial<InsertWarehouse>): Promise<Warehouse | undefined> {\n    const [updated] = await db.update(warehouses).set(data).where(eq(warehouses.id, id)).returning();\n    return updated;\n  }\n\n  async deleteWarehouse(id: number): Promise<void> {\n    const relatedDeliveries = await db.select().from(deliveries).where(eq(deliveries.warehouseId, id));\n    const relatedContainers = await db.select().from(containers).where(eq(containers.warehouseId, id));\n    if (relatedDeliveries.length > 0 || relatedContainers.length > 0) {\n      throw new Error(\"لا يمكن حذف المخزن لوجود تسليمات أو حاويات مرتبطة به\");\n    }\n    await db.delete(warehouses).where(eq(warehouses.id, id));\n  }\n\n  async getProducts(): Promise<Product[]> {\n    return db.select().from(products);\n  }\n\n  async getProductsByStatus(status: string): Promise<Product[]> {\n    return db.select().from(products).where(eq(products.status, status as any));\n  }\n\n  async createProduct(data: InsertProduct): Promise<Product> {\n    const existing = await db.select().from(products)\n      .where(and(eq(products.name, data.name), eq(products.status, \"purchase_order\")));\n    if (existing.length > 0) {\n      const old = existing[0];\n      const newQty = (old.quantity || 0) + (data.quantity || 0);\n      const [updated] = await db.update(products).set({ quantity: newQty }).where(eq(products.id, old.id)).returning();\n      return updated;\n    }\n    const [prod] = await db.insert(products).values({\n      ...data,\n      status: data.status || \"purchase_order\",\n    }).returning();\n    return prod;\n  }\n\n  async updateProductStatus(id: number, status: string): Promise<Product | undefined> {\n    const [prod] = await db.update(products)\n      .set({ status: status as any, statusChangedAt: new Date() })\n      .where(eq(products.id, id))\n      .returning();\n    return prod;\n  }\n\n  async updateProduct(id: number, data: Partial<InsertProduct>): Promise<Product | undefined> {\n    const [updated] = await db.update(products).set(data).where(eq(products.id, id)).returning();\n    return updated;\n  }\n\n  async deleteProduct(id: number): Promise<void> {\n    await db.delete(orderItems).where(eq(orderItems.productId, id));\n    await db.delete(deliveryItems).where(eq(deliveryItems.productId, id));\n    await db.delete(containerItems).where(eq(containerItems.productId, id));\n    await db.delete(productParts).where(eq(productParts.productId, id));\n    await db.delete(products).where(eq(products.id, id));\n  }\n\n  async updateSupplier(id: number, data: Partial<InsertSupplier>): Promise<Supplier | undefined> {\n    const [updated] = await db.update(suppliers).set(data).where(eq(suppliers.id, id)).returning();\n    return updated;\n  }\n\n  async deleteSupplier(id: number): Promise<void> {\n    const relatedOrders = await db.select().from(orders).where(eq(orders.supplierId, id));\n    const relatedDeliveries = await db.select().from(deliveries).where(eq(deliveries.supplierId, id));\n    const relatedPayments = await db.select().from(payments).where(eq(payments.supplierId, id));\n    if (relatedOrders.length > 0 || relatedDeliveries.length > 0 || relatedPayments.length > 0) {\n      throw new Error(\"لا يمكن حذف المورد لوجود عمليات مرتبطة به (طلبات، تسليمات، أو دفعات)\");\n    }\n    await db.delete(suppliers).where(eq(suppliers.id, id));\n  }\n\n  async deleteCategory(id: number): Promise<void> {\n    const relatedProducts = await db.select().from(products).where(eq(products.categoryId, id));\n    if (relatedProducts.length > 0) {\n      throw new Error(\"لا يمكن حذف الفئة لوجود منتجات مرتبطة بها\");\n    }\n    await db.delete(categories).where(eq(categories.id, id));\n  }\n\n  async getOrders(): Promise<any[]> {\n    const allOrders = await db.select().from(orders).orderBy(desc(orders.id));\n    const result = [];\n    for (const order of allOrders) {\n      const items = await db.select().from(orderItems).where(eq(orderItems.orderId, order.id));\n      const sup = await db.select().from(suppliers).where(eq(suppliers.id, order.supplierId));\n      const enrichedItems = [];\n      for (const item of items) {\n        const prods = await db.select().from(products).where(eq(products.id, item.productId));\n        enrichedItems.push({\n          ...item,\n          productName: prods[0]?.name || `منتج #${item.productId}`,\n        });\n      }\n      result.push({\n        ...order,\n        supplierName: sup[0]?.name || \"\",\n        items: enrichedItems,\n      });\n    }\n    return result;\n  }\n\n  async createOrder(supplierId: number, items: any[]): Promise<Order> {\n    const [order] = await db.insert(orders).values({\n      supplierId,\n      confirmed: \"confirmed\",\n    }).returning();\n\n    for (const item of items) {\n      await db.insert(orderItems).values({\n        orderId: order.id,\n        productId: item.productId,\n        quantityRequested: item.quantityRequested,\n        quantityOrdered: item.quantityOrdered,\n        price: item.price,\n        currency: item.currency,\n      });\n\n      const [prod] = await db.select().from(products).where(eq(products.id, item.productId));\n      if (prod) {\n        const remaining = prod.quantity - item.quantityOrdered;\n        if (remaining <= 0) {\n          await db.update(products)\n            .set({ status: \"ordered\", statusChangedAt: new Date(), quantity: item.quantityOrdered })\n            .where(eq(products.id, item.productId));\n        } else {\n          await db.update(products)\n            .set({ status: \"ordered\", statusChangedAt: new Date(), quantity: item.quantityOrdered })\n            .where(eq(products.id, item.productId));\n\n          const [newProd] = await db.insert(products).values({\n            name: prod.name,\n            quantity: remaining,\n            categoryId: prod.categoryId,\n            status: \"purchase_order\",\n            statusChangedAt: new Date(),\n          }).returning();\n\n          if (prod.status === \"semi_manufactured\") {\n            const existingParts = await db.select().from(productParts).where(eq(productParts.productId, item.productId));\n            for (const part of existingParts) {\n              await db.insert(productParts).values({\n                productId: newProd.id,\n                name: part.name,\n                quantity: part.quantity,\n                length: part.length,\n                width: part.width,\n                height: part.height,\n                weight: part.weight,\n                piecesPerCarton: part.piecesPerCarton,\n              });\n            }\n          }\n        }\n      }\n    }\n\n    return order;\n  }\n\n  async updateOrderItem(itemId: number, data: any): Promise<any> {\n    const updateData: Record<string, any> = {};\n    if (data.quantityRequested !== undefined) updateData.quantityRequested = data.quantityRequested;\n    if (data.quantityOrdered !== undefined) updateData.quantityOrdered = data.quantityOrdered;\n    if (data.price !== undefined) updateData.price = data.price;\n    if (data.currency !== undefined) updateData.currency = data.currency;\n    const [updated] = await db.update(orderItems).set(updateData).where(eq(orderItems.id, itemId)).returning();\n    return updated;\n  }\n\n  async getSupplierOrderedItems(supplierId: number): Promise<any[]> {\n    const supplierOrders = await db.select().from(orders)\n      .where(and(eq(orders.supplierId, supplierId), eq(orders.confirmed, \"confirmed\")));\n\n    const result = [];\n    for (const order of supplierOrders) {\n      const items = await db.select().from(orderItems).where(eq(orderItems.orderId, order.id));\n      for (const item of items) {\n        const prods = await db.select().from(products).where(eq(products.id, item.productId));\n        if (prods[0] && (prods[0].status === \"ordered\" || prods[0].status === \"semi_manufactured\")) {\n          const parts = prods[0].status === \"semi_manufactured\"\n            ? await db.select().from(productParts).where(eq(productParts.productId, item.productId))\n            : [];\n          result.push({\n            ...item,\n            productName: prods[0].name,\n            productStatus: prods[0].status,\n            parts,\n          });\n        }\n      }\n    }\n    return result;\n  }\n\n  async createDelivery(supplierId: number, warehouseId: number, items: any[]): Promise<Delivery> {\n    const [delivery] = await db.insert(deliveries).values({\n      supplierId,\n      warehouseId,\n    }).returning();\n\n    for (const item of items) {\n      if (!item.quantity || item.quantity <= 0) continue;\n\n      await db.insert(deliveryItems).values({\n        deliveryId: delivery.id,\n        productId: item.productId,\n        quantity: item.quantity,\n        price: item.price,\n        currency: item.currency,\n        length: item.length,\n        width: item.width,\n        height: item.height,\n        weight: item.weight,\n        piecesPerCarton: item.piecesPerCarton,\n      });\n\n      const [prod] = await db.select().from(products).where(eq(products.id, item.productId));\n      const orderedQty = prod?.quantity || 0;\n      const receivedQty = item.quantity || 0;\n      const remaining = orderedQty - receivedQty;\n\n      const newStatus = prod.status === \"semi_manufactured\" ? \"semi_manufactured\" : \"received\";\n      await db.update(products)\n        .set({ status: newStatus, statusChangedAt: new Date(), quantity: receivedQty })\n        .where(eq(products.id, item.productId));\n\n      if (item.parts && Array.isArray(item.parts) && prod.status === \"semi_manufactured\") {\n        await db.delete(productParts).where(eq(productParts.productId, item.productId));\n        for (const part of item.parts) {\n          if (!part.name) continue;\n          await db.insert(productParts).values({\n            productId: item.productId,\n            name: part.name,\n            quantity: part.quantity || 0,\n            length: part.length || null,\n            width: part.width || null,\n            height: part.height || null,\n            weight: part.weight || null,\n            piecesPerCarton: part.piecesPerCarton || null,\n          });\n        }\n      }\n\n      if (remaining > 0) {\n        const [newProd] = await db.insert(products).values({\n          name: prod.name,\n          quantity: remaining,\n          categoryId: prod.categoryId,\n          status: \"ordered\",\n          statusChangedAt: new Date(),\n        }).returning();\n\n        if (prod.status === \"semi_manufactured\") {\n          const existingParts = await db.select().from(productParts).where(eq(productParts.productId, item.productId));\n          for (const part of existingParts) {\n            await db.insert(productParts).values({\n              productId: newProd.id,\n              name: part.name,\n              quantity: part.quantity,\n              length: part.length,\n              width: part.width,\n              height: part.height,\n              weight: part.weight,\n              piecesPerCarton: part.piecesPerCarton,\n            });\n          }\n        }\n      }\n    }\n\n    return delivery;\n  }\n\n  async getDeliveries(): Promise<any[]> {\n    const allDeliveries = await db.select().from(deliveries);\n    const result = [];\n    for (const del of allDeliveries) {\n      const sup = await db.select().from(suppliers).where(eq(suppliers.id, del.supplierId));\n      const wh = await db.select().from(warehouses).where(eq(warehouses.id, del.warehouseId));\n      const items = await db.select().from(deliveryItems).where(eq(deliveryItems.deliveryId, del.id));\n      const enrichedItems = [];\n      for (const item of items) {\n        const prods = await db.select().from(products).where(eq(products.id, item.productId));\n        enrichedItems.push({\n          ...item,\n          productName: prods[0]?.name || `منتج #${item.productId}`,\n        });\n      }\n      result.push({\n        ...del,\n        supplierName: sup[0]?.name || \"\",\n        warehouseName: wh[0]?.name || \"\",\n        items: enrichedItems,\n      });\n    }\n    return result;\n  }\n\n  async getContainers(): Promise<any[]> {\n    const allContainers = await db.select().from(containers);\n    const result = [];\n    for (const cont of allContainers) {\n      const wh = cont.warehouseId ? await db.select().from(warehouses).where(eq(warehouses.id, cont.warehouseId)) : [];\n      const sc = cont.shippingCompanyId ? await db.select().from(shippingCompanies).where(eq(shippingCompanies.id, cont.shippingCompanyId)) : [];\n      const cItems = await db.select().from(containerItems).where(eq(containerItems.containerId, cont.id));\n      const enrichedItems = [];\n      for (const item of cItems) {\n        const prods = await db.select().from(products).where(eq(products.id, item.productId));\n        enrichedItems.push({\n          ...item,\n          productName: prods[0]?.name || `منتج #${item.productId}`,\n        });\n      }\n      result.push({\n        ...cont,\n        warehouseName: wh[0]?.name || \"\",\n        shippingCompanyName: sc[0]?.name || cont.shippingCompany || \"\",\n        items: enrichedItems,\n      });\n    }\n    return result;\n  }\n\n  async createContainer(data: any, items: any[]): Promise<Container> {\n    const [container] = await db.insert(containers).values({\n      invoiceNumber: data.invoiceNumber,\n      containerNumber: data.containerNumber,\n      shippingCompany: data.shippingCompany,\n      shippingCompanyId: data.shippingCompanyId || null,\n      priceCNY: data.priceCNY || 0,\n      priceUSD: data.priceUSD || 0,\n      warehouseId: data.warehouseId,\n      status: \"shipping\",\n    }).returning();\n\n    for (const item of items) {\n      const [prod] = await db.select().from(products).where(eq(products.id, item.productId));\n      if (!prod || (prod.status !== \"received\" && prod.status !== \"semi_manufactured\")) continue;\n\n      const shippedQty = item.quantity || prod.quantity;\n      const remaining = (prod.quantity || 0) - shippedQty;\n\n      await db.insert(containerItems).values({\n        containerId: container.id,\n        productId: item.productId,\n        quantity: shippedQty,\n      });\n\n      await db.update(products)\n        .set({ status: \"shipping\", statusChangedAt: new Date(), quantity: shippedQty })\n        .where(eq(products.id, item.productId));\n\n      if (remaining > 0) {\n        const [newProd] = await db.insert(products).values({\n          name: prod.name,\n          quantity: remaining,\n          categoryId: prod.categoryId,\n          status: prod.status as any,\n          statusChangedAt: new Date(),\n        }).returning();\n\n        if (prod.status === \"semi_manufactured\") {\n          const existingParts = await db.select().from(productParts).where(eq(productParts.productId, item.productId));\n          for (const part of existingParts) {\n            await db.insert(productParts).values({\n              productId: newProd.id,\n              name: part.name,\n              quantity: part.quantity,\n              length: part.length,\n              width: part.width,\n              height: part.height,\n              weight: part.weight,\n              piecesPerCarton: part.piecesPerCarton,\n            });\n          }\n        }\n      }\n    }\n\n    const docInvoiceNumber = container.invoiceNumber || container.containerNumber || String(container.id);\n\n    const existingDoc = await db.select().from(containerDocuments)\n      .where(eq(containerDocuments.invoiceNumber, docInvoiceNumber));\n\n    if (existingDoc.length > 0 && container.invoiceNumber) {\n      const groupId = existingDoc[0].groupInvoiceId || existingDoc[0].id;\n      if (!existingDoc[0].groupInvoiceId) {\n        await db.update(containerDocuments)\n          .set({ groupInvoiceId: existingDoc[0].id })\n          .where(eq(containerDocuments.id, existingDoc[0].id));\n      }\n      await db.insert(containerDocuments).values({\n        containerId: container.id,\n        invoiceNumber: docInvoiceNumber,\n        invoiceDate: new Date(),\n        groupInvoiceId: groupId,\n      });\n    } else {\n      await db.insert(containerDocuments).values({\n        containerId: container.id,\n        invoiceNumber: docInvoiceNumber,\n        invoiceDate: new Date(),\n      });\n    }\n\n    return container;\n  }\n\n  async updateContainer(id: number, data: any): Promise<Container | undefined> {\n    const updateData: any = {};\n    if (data.invoiceNumber !== undefined) updateData.invoiceNumber = data.invoiceNumber;\n    if (data.containerNumber !== undefined) updateData.containerNumber = data.containerNumber;\n    if (data.shippingCompanyId !== undefined) updateData.shippingCompanyId = data.shippingCompanyId;\n    if (data.shippingCompany !== undefined) updateData.shippingCompany = data.shippingCompany;\n    if (data.priceCNY !== undefined) updateData.priceCNY = data.priceCNY;\n    if (data.priceUSD !== undefined) updateData.priceUSD = data.priceUSD;\n\n    const [container] = await db.update(containers)\n      .set(updateData)\n      .where(eq(containers.id, id))\n      .returning();\n    return container;\n  }\n\n  async markContainerArrived(containerId: number): Promise<Container | undefined> {\n    const [container] = await db.update(containers)\n      .set({ status: \"arrived\" })\n      .where(eq(containers.id, containerId))\n      .returning();\n\n    const cItems = await db.select().from(containerItems).where(eq(containerItems.containerId, containerId));\n    for (const item of cItems) {\n      await db.update(products)\n        .set({ status: \"arrived\", statusChangedAt: new Date() })\n        .where(eq(products.id, item.productId));\n    }\n\n    return container;\n  }\n\n  async getSupplierAccount(supplierId: number): Promise<any> {\n    const allDeliveries = await db.select().from(deliveries)\n      .where(eq(deliveries.supplierId, supplierId));\n\n    const allDeliveryItems = [];\n    let totalCNY = 0;\n    let totalUSD = 0;\n\n    for (const del of allDeliveries) {\n      const items = await db.select().from(deliveryItems)\n        .where(eq(deliveryItems.deliveryId, del.id));\n      for (const item of items) {\n        const prods = await db.select().from(products).where(eq(products.id, item.productId));\n        const enriched = {\n          ...item,\n          productName: prods[0]?.name || `منتج #${item.productId}`,\n        };\n        allDeliveryItems.push(enriched);\n        if (item.currency === \"CNY\") totalCNY += (item.price || 0) * item.quantity;\n        else totalUSD += (item.price || 0) * item.quantity;\n      }\n    }\n\n    const allPayments = await db.select().from(payments)\n      .where(eq(payments.supplierId, supplierId));\n\n    let paidCNY = 0;\n    let paidUSD = 0;\n    for (const p of allPayments) {\n      if (p.currency === \"CNY\") paidCNY += p.amount;\n      else paidUSD += p.amount;\n    }\n\n    return {\n      totalCNY,\n      totalUSD,\n      paidCNY,\n      paidUSD,\n      deliveryItems: allDeliveryItems,\n      payments: allPayments,\n    };\n  }\n\n  async getShippingCompanyAccount(companyId: number): Promise<any> {\n    const companyContainers = await db.select().from(containers)\n      .where(eq(containers.shippingCompanyId, companyId));\n\n    let totalCNY = 0;\n    let totalUSD = 0;\n    const containersList = [];\n\n    for (const cont of companyContainers) {\n      totalCNY += cont.priceCNY || 0;\n      totalUSD += cont.priceUSD || 0;\n      const cItems = await db.select().from(containerItems).where(eq(containerItems.containerId, cont.id));\n      const enrichedItems = [];\n      for (const item of cItems) {\n        const prods = await db.select().from(products).where(eq(products.id, item.productId));\n        enrichedItems.push({\n          ...item,\n          productName: prods[0]?.name || `منتج #${item.productId}`,\n        });\n      }\n      containersList.push({\n        ...cont,\n        items: enrichedItems,\n      });\n    }\n\n    const allPayments = await db.select().from(shippingPayments)\n      .where(eq(shippingPayments.shippingCompanyId, companyId));\n\n    let paidCNY = 0;\n    let paidUSD = 0;\n    for (const p of allPayments) {\n      if (p.currency === \"CNY\") paidCNY += p.amount;\n      else paidUSD += p.amount;\n    }\n\n    return {\n      totalCNY,\n      totalUSD,\n      paidCNY,\n      paidUSD,\n      containers: containersList,\n      payments: allPayments,\n    };\n  }\n\n  async createPayment(data: InsertPayment): Promise<Payment> {\n    const [pay] = await db.insert(payments).values(data).returning();\n    return pay;\n  }\n\n  async updatePayment(id: number, data: Partial<InsertPayment>): Promise<Payment | undefined> {\n    const [updated] = await db.update(payments).set(data).where(eq(payments.id, id)).returning();\n    return updated;\n  }\n\n  async deletePayment(id: number): Promise<void> {\n    await db.delete(payments).where(eq(payments.id, id));\n  }\n\n  async createShippingPayment(data: InsertShippingPayment): Promise<ShippingPayment> {\n    const [pay] = await db.insert(shippingPayments).values(data).returning();\n    return pay;\n  }\n\n  async updateShippingPayment(id: number, data: Partial<InsertShippingPayment>): Promise<ShippingPayment | undefined> {\n    const [updated] = await db.update(shippingPayments).set(data).where(eq(shippingPayments.id, id)).returning();\n    return updated;\n  }\n\n  async deleteShippingPayment(id: number): Promise<void> {\n    await db.delete(shippingPayments).where(eq(shippingPayments.id, id));\n  }\n\n  async getProductParts(productId: number): Promise<ProductPart[]> {\n    return db.select().from(productParts).where(eq(productParts.productId, productId));\n  }\n\n  async createProductPart(data: InsertProductPart): Promise<ProductPart> {\n    const [part] = await db.insert(productParts).values(data).returning();\n    return part;\n  }\n\n  async deleteProductPart(id: number): Promise<void> {\n    await db.delete(productParts).where(eq(productParts.id, id));\n  }\n\n  async getWarehouseInventory(): Promise<any[]> {\n    const receivedProducts = await db.select().from(products)\n      .where(sql`${products.status} IN ('received', 'semi_manufactured')`);\n\n    const result = [];\n    for (const prod of receivedProducts) {\n      const delItems = await db.select().from(deliveryItems)\n        .where(eq(deliveryItems.productId, prod.id));\n\n      const latestDelivery = delItems.length > 0 ? delItems[delItems.length - 1] : null;\n      const cat = prod.categoryId ? await db.select().from(categories).where(eq(categories.id, prod.categoryId)) : [];\n\n      let parts: ProductPart[] = [];\n      if (prod.status === \"semi_manufactured\") {\n        parts = await db.select().from(productParts).where(eq(productParts.productId, prod.id));\n      }\n\n      result.push({\n        ...prod,\n        categoryName: cat[0]?.name || \"\",\n        length: latestDelivery?.length || 0,\n        width: latestDelivery?.width || 0,\n        height: latestDelivery?.height || 0,\n        weight: latestDelivery?.weight || 0,\n        piecesPerCarton: latestDelivery?.piecesPerCarton || 0,\n        parts,\n      });\n    }\n    return result;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user;\n  }\n\n  async getUserById(id: number): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async createUser(data: InsertUser): Promise<User> {\n    const [user] = await db.insert(users).values(data).returning();\n    return user;\n  }\n\n  async updateUser(id: number, data: Partial<{ username: string; password: string; displayName: string }>): Promise<User | undefined> {\n    const [user] = await db.update(users).set(data).where(eq(users.id, id)).returning();\n    return user;\n  }\n\n  async getUsers(): Promise<User[]> {\n    return db.select().from(users);\n  }\n\n  async getUserCategories(userId: number): Promise<number[]> {\n    const rows = await db.select().from(userCategories).where(eq(userCategories.userId, userId));\n    return rows.map(r => r.categoryId);\n  }\n\n  async setUserCategories(userId: number, categoryIds: number[]): Promise<void> {\n    await db.delete(userCategories).where(eq(userCategories.userId, userId));\n    if (categoryIds.length > 0) {\n      await db.insert(userCategories).values(\n        categoryIds.map(categoryId => ({ userId, categoryId }))\n      );\n    }\n  }\n\n  async getCashboxTransactions(): Promise<any[]> {\n    const txns = await db.select().from(cashboxTransactions);\n    const result = [];\n    for (const txn of txns) {\n      let entityName = \"\";\n      if (txn.category === \"supplier\" && txn.supplierId) {\n        const [sup] = await db.select().from(suppliers).where(eq(suppliers.id, txn.supplierId));\n        entityName = sup?.name || \"\";\n      } else if (txn.category === \"shipping\" && txn.shippingCompanyId) {\n        const [sc] = await db.select().from(shippingCompanies).where(eq(shippingCompanies.id, txn.shippingCompanyId));\n        entityName = sc?.name || \"\";\n      } else if (txn.category === \"expense\" && txn.expenseId) {\n        const [exp] = await db.select().from(expenses).where(eq(expenses.id, txn.expenseId));\n        entityName = exp?.title || \"\";\n      }\n      result.push({ ...txn, entityName });\n    }\n    return result;\n  }\n\n  async getCashboxSummary(): Promise<any> {\n    const txns = await db.select().from(cashboxTransactions);\n    let incomeCNY = 0, incomeUSD = 0, expenseCNY = 0, expenseUSD = 0;\n    for (const txn of txns) {\n      if (txn.type === \"income\") {\n        if (txn.currency === \"CNY\") incomeCNY += txn.amount;\n        else incomeUSD += txn.amount;\n      } else {\n        if (txn.currency === \"CNY\") expenseCNY += txn.amount;\n        else expenseUSD += txn.amount;\n      }\n    }\n    return {\n      incomeCNY, incomeUSD,\n      expenseCNY, expenseUSD,\n      balanceCNY: incomeCNY - expenseCNY,\n      balanceUSD: incomeUSD - expenseUSD,\n    };\n  }\n\n  async createCashboxTransaction(data: InsertCashboxTransaction): Promise<CashboxTransaction> {\n    const [txn] = await db.insert(cashboxTransactions).values(data).returning();\n    return txn;\n  }\n\n  async updateCashboxTransaction(id: number, data: Partial<InsertCashboxTransaction>): Promise<CashboxTransaction | undefined> {\n    const [updated] = await db.update(cashboxTransactions).set(data).where(eq(cashboxTransactions.id, id)).returning();\n    return updated;\n  }\n\n  async deleteCashboxTransaction(id: number): Promise<void> {\n    await db.delete(cashboxTransactions).where(eq(cashboxTransactions.id, id));\n  }\n\n  async getCashboxByPaymentId(paymentId: number): Promise<CashboxTransaction | undefined> {\n    const [txn] = await db.select().from(cashboxTransactions).where(eq(cashboxTransactions.paymentId, paymentId));\n    return txn;\n  }\n\n  async getCashboxByShippingPaymentId(shippingPaymentId: number): Promise<CashboxTransaction | undefined> {\n    const [txn] = await db.select().from(cashboxTransactions).where(eq(cashboxTransactions.shippingPaymentId, shippingPaymentId));\n    return txn;\n  }\n\n  async deleteCashboxByPaymentId(paymentId: number): Promise<void> {\n    await db.delete(cashboxTransactions).where(eq(cashboxTransactions.paymentId, paymentId));\n  }\n\n  async deleteCashboxByShippingPaymentId(shippingPaymentId: number): Promise<void> {\n    await db.delete(cashboxTransactions).where(eq(cashboxTransactions.shippingPaymentId, shippingPaymentId));\n  }\n\n  async updateCashboxByPaymentId(paymentId: number, data: Partial<InsertCashboxTransaction>): Promise<CashboxTransaction | undefined> {\n    const [updated] = await db.update(cashboxTransactions).set(data).where(eq(cashboxTransactions.paymentId, paymentId)).returning();\n    return updated;\n  }\n\n  async updateCashboxByShippingPaymentId(shippingPaymentId: number, data: Partial<InsertCashboxTransaction>): Promise<CashboxTransaction | undefined> {\n    const [updated] = await db.update(cashboxTransactions).set(data).where(eq(cashboxTransactions.shippingPaymentId, shippingPaymentId)).returning();\n    return updated;\n  }\n\n  async getExpenses(): Promise<Expense[]> {\n    return db.select().from(expenses);\n  }\n\n  async createExpense(data: InsertExpense): Promise<Expense> {\n    const [expense] = await db.insert(expenses).values(data).returning();\n    return expense;\n  }\n\n  async updateExpense(id: number, data: Partial<InsertExpense>): Promise<Expense | undefined> {\n    const [updated] = await db.update(expenses).set(data).where(eq(expenses.id, id)).returning();\n    return updated;\n  }\n\n  async deleteExpense(id: number): Promise<void> {\n    await db.delete(expenses).where(eq(expenses.id, id));\n  }\n\n  async getCashboxByExpenseId(expenseId: number): Promise<CashboxTransaction | undefined> {\n    const [txn] = await db.select().from(cashboxTransactions).where(eq(cashboxTransactions.expenseId, expenseId));\n    return txn;\n  }\n\n  async deleteCashboxByExpenseId(expenseId: number): Promise<void> {\n    await db.delete(cashboxTransactions).where(eq(cashboxTransactions.expenseId, expenseId));\n  }\n\n  async updateCashboxByExpenseId(expenseId: number, data: Partial<InsertCashboxTransaction>): Promise<CashboxTransaction | undefined> {\n    const [updated] = await db.update(cashboxTransactions).set(data).where(eq(cashboxTransactions.expenseId, expenseId)).returning();\n    return updated;\n  }\n\n  async getContainerDocuments(): Promise<any[]> {\n    const docs = await db.select().from(containerDocuments).orderBy(desc(containerDocuments.id));\n    const result = [];\n    for (const doc of docs) {\n      const [container] = await db.select().from(containers).where(eq(containers.id, doc.containerId));\n      result.push({ ...doc, container });\n    }\n    return result;\n  }\n\n  async getContainerDocument(id: number): Promise<any> {\n    const [doc] = await db.select().from(containerDocuments).where(eq(containerDocuments.id, id));\n    return doc;\n  }\n\n  async updateContainerDocument(id: number, data: any): Promise<any> {\n    const [updated] = await db.update(containerDocuments).set(data).where(eq(containerDocuments.id, id)).returning();\n    return updated;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":37190,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/pages/orders.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Plus, ShoppingCart, Printer, RotateCcw, Pencil } from \"lucide-react\";\nimport { openPrintWindow } from \"@/lib/printStyles\";\nimport { useAuth } from \"@/App\";\nimport { useLanguage } from \"@/lib/language-context\";\nimport { t } from \"@/lib/translations\";\nimport type { Product, Supplier } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\n\nfunction formatDateFr(dateStr: string | null | undefined): string {\n  if (!dateStr) return \"-\";\n  return new Date(dateStr).toLocaleDateString(\"fr-FR\");\n}\n\ninterface OrderItemDraft {\n  productId: number;\n  productName: string;\n  quantityRequested: number;\n  quantityOrdered: number;\n  price: number;\n  currency: \"CNY\" | \"USD\";\n  selected: boolean;\n}\n\nexport default function Orders() {\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const { language } = useLanguage();\n  const hidePrice = user?.role === \"warehouse\";\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [supplierId, setSupplierId] = useState(\"\");\n  const [orderItems, setOrderItems] = useState<OrderItemDraft[]>([]);\n  const [step, setStep] = useState<\"supplier\" | \"items\" | \"summary\">(\"supplier\");\n  const [confirmed, setConfirmed] = useState(false);\n\n  const { data: suppliers } = useQuery<Supplier[]>({\n    queryKey: [\"/api/suppliers\"],\n  });\n\n  const { data: products } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  const purchaseProducts = products?.filter(p => p.status === \"purchase_order\") || [];\n\n  const createOrderMutation = useMutation({\n    mutationFn: async (data: { supplierId: number; items: any[] }) => {\n      const res = await apiRequest(\"POST\", \"/api/orders\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n      setDialogOpen(false);\n      resetForm();\n      toast({ title: \"تم إنشاء الطلب بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const resetRemainingMutation = useMutation({\n    mutationFn: async (productId: number) => {\n      const res = await apiRequest(\"PATCH\", `/api/products/${productId}`, { quantity: 0 });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n      toast({ title: \"تم تصفير الكمية المتبقية\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const resetForm = () => {\n    setSupplierId(\"\");\n    setOrderItems([]);\n    setStep(\"supplier\");\n    setConfirmed(false);\n  };\n\n  const handleSelectSupplier = () => {\n    if (!supplierId) {\n      toast({ title: \"يرجى اختيار المورد\", variant: \"destructive\" });\n      return;\n    }\n    const items: OrderItemDraft[] = purchaseProducts.map(p => ({\n      productId: p.id,\n      productName: p.name,\n      quantityRequested: p.quantity,\n      quantityOrdered: p.quantity,\n      price: 0,\n      currency: \"CNY\" as const,\n      selected: false,\n    }));\n    setOrderItems(items);\n    setStep(\"items\");\n  };\n\n  const toggleItem = (idx: number) => {\n    setOrderItems(prev => prev.map((item, i) =>\n      i === idx ? { ...item, selected: !item.selected } : item\n    ));\n  };\n\n  const updateItem = (idx: number, field: string, value: any) => {\n    setOrderItems(prev => prev.map((item, i) =>\n      i === idx ? { ...item, [field]: value } : item\n    ));\n  };\n\n  const handleConfirmOrder = () => {\n    const selected = orderItems.filter(i => i.selected);\n    if (selected.length === 0) {\n      toast({ title: \"يرجى اختيار منتج واحد على الأقل\", variant: \"destructive\" });\n      return;\n    }\n    setStep(\"summary\");\n  };\n\n  const handleSubmitOrder = () => {\n    const selected = orderItems.filter(i => i.selected);\n    createOrderMutation.mutate({\n      supplierId: parseInt(supplierId),\n      items: selected.map(i => ({\n        productId: i.productId,\n        quantityRequested: i.quantityRequested,\n        quantityOrdered: i.quantityOrdered,\n        price: i.price,\n        currency: i.currency,\n      })),\n    });\n  };\n\n  const selectedItems = orderItems.filter(i => i.selected);\n  const totalCNY = selectedItems.filter(i => i.currency === \"CNY\").reduce((s, i) => s + (i.price * i.quantityOrdered), 0);\n  const totalUSD = selectedItems.filter(i => i.currency === \"USD\").reduce((s, i) => s + (i.price * i.quantityOrdered), 0);\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-orders-title\">{t(\"orders.title\", language)}</h1>\n          <p className=\"text-muted-foreground\">{t(\"orders.subtitle\", language)}</p>\n        </div>\n        {!hidePrice && (\n          <Dialog open={dialogOpen} onOpenChange={(open) => { setDialogOpen(open); if (!open) resetForm(); }}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-create-order\">\n              <Plus className=\"h-4 w-4\" />\n              {t(\"orders.newOrder\", language)}\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>\n                {step === \"supplier\" && \"اختيار المورد\"}\n                {step === \"items\" && \"اختيار المنتجات\"}\n                {step === \"summary\" && \"ملخص الطلب\"}\n              </DialogTitle>\n            </DialogHeader>\n\n            {step === \"supplier\" && (\n              <div className=\"space-y-4 pt-4\">\n                <div className=\"space-y-2\">\n                  <Label>المورد</Label>\n                  <Select value={supplierId} onValueChange={setSupplierId}>\n                    <SelectTrigger data-testid=\"select-order-supplier\">\n                      <SelectValue placeholder={t(\"orders.selectSupplier\", language)} />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {suppliers?.map((s) => (\n                        <SelectItem key={s.id} value={String(s.id)}>{s.name}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <Button data-testid=\"button-next-step\" className=\"w-full\" onClick={handleSelectSupplier}>{t(\"common.next\", language)}</Button>\n              </div>\n            )}\n\n            {step === \"items\" && (\n              <div className=\"space-y-4 pt-4\">\n                {purchaseProducts.length === 0 ? (\n                  <div className=\"text-center py-8\">\n                    <ShoppingCart className=\"h-12 w-12 text-muted-foreground mx-auto mb-3\" />\n                    <p className=\"text-muted-foreground\">لا توجد منتجات في حالة طلب الشراء</p>\n                  </div>\n                ) : (\n                  <>\n                    <div className=\"overflow-x-auto\">\n                      <Table>\n                        <TableHeader>\n                          <TableRow>\n                            <TableHead className=\"w-10\">اختيار</TableHead>\n                            <TableHead>{t(\"common.product\", language)}</TableHead>\n                            <TableHead>{t(\"orders.quantityOrdered\", language)}</TableHead>\n                            <TableHead>{t(\"common.quantity\", language)}</TableHead>\n                            <TableHead>المتبقي</TableHead>\n                            {!hidePrice && <TableHead>السعر</TableHead>}\n                            {!hidePrice && <TableHead>العملة</TableHead>}\n                            <TableHead>تصفير</TableHead>\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          {orderItems.map((item, idx) => (\n                            <TableRow key={item.productId}>\n                              <TableCell>\n                                <Checkbox checked={item.selected} onCheckedChange={() => toggleItem(idx)} data-testid={`checkbox-item-${item.productId}`} />\n                              </TableCell>\n                              <TableCell className=\"font-medium\">{item.productName}</TableCell>\n                              <TableCell>\n                                <Input type=\"number\" className=\"w-20\" value={item.quantityRequested} onChange={(e) => updateItem(idx, \"quantityRequested\", parseInt(e.target.value) || 0)} data-testid={`input-qty-requested-${item.productId}`} />\n                              </TableCell>\n                              <TableCell>\n                                <Input type=\"number\" className=\"w-20\" value={item.quantityOrdered} onChange={(e) => updateItem(idx, \"quantityOrdered\", parseInt(e.target.value) || 0)} data-testid={`input-qty-${item.productId}`} />\n                              </TableCell>\n                              <TableCell>\n                                <span className={item.quantityRequested - item.quantityOrdered < 0 ? \"text-destructive font-semibold\" : \"\"}>\n                                  {item.quantityRequested - item.quantityOrdered}\n                                </span>\n                              </TableCell>\n                              {!hidePrice && <TableCell>\n                                <Input type=\"number\" step=\"0.01\" className=\"w-24\" value={item.price} onChange={(e) => updateItem(idx, \"price\", parseFloat(e.target.value) || 0)} data-testid={`input-price-${item.productId}`} />\n                              </TableCell>}\n                              {!hidePrice && <TableCell>\n                                <Select value={item.currency} onValueChange={(v) => updateItem(idx, \"currency\", v)}>\n                                  <SelectTrigger className=\"w-24\">\n                                    <SelectValue />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    <SelectItem value=\"CNY\">يوان</SelectItem>\n                                    <SelectItem value=\"USD\">دولار</SelectItem>\n                                  </SelectContent>\n                                </Select>\n                              </TableCell>}\n                              <TableCell>\n                                <Button size=\"icon\" variant=\"ghost\" onClick={() => { updateItem(idx, \"quantityRequested\", 0); resetRemainingMutation.mutate(item.productId); }} data-testid={`button-reset-remaining-${item.productId}`}>\n                                  <RotateCcw className=\"h-4 w-4\" />\n                                </Button>\n                              </TableCell>\n                            </TableRow>\n                          ))}\n                        </TableBody>\n                      </Table>\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <Button variant=\"outline\" onClick={() => setStep(\"supplier\")}>{t(\"common.back\", language)}</Button>\n                      <Button onClick={handleConfirmOrder} data-testid=\"button-confirm-items\">{t(\"orders.confirmOrder\", language)}</Button>\n                    </div>\n                  </>\n                )}\n              </div>\n            )}\n\n            {step === \"summary\" && (\n              <div className=\"space-y-4 pt-4\" id=\"order-summary\">\n                <h3 className=\"font-semibold\">المورد: {suppliers?.find(s => s.id === parseInt(supplierId))?.name}</h3>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>{t(\"common.product\", language)}</TableHead>\n                      <TableHead>{t(\"common.quantity\", language)}</TableHead>\n                      {!hidePrice && <TableHead>{t(\"orders.price\", language)}</TableHead>}\n                      {!hidePrice && <TableHead>{t(\"orders.currency\", language)}</TableHead>}\n                      {!hidePrice && <TableHead>{t(\"common.total\", language)}</TableHead>}\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {selectedItems.map((item) => (\n                      <TableRow key={item.productId}>\n                        <TableCell className=\"font-medium\">{item.productName}</TableCell>\n                        <TableCell>{item.quantityOrdered}</TableCell>\n                        {!hidePrice && <TableCell>{item.price.toFixed(2)}</TableCell>}\n                        {!hidePrice && <TableCell>{item.currency === \"CNY\" ? \"يوان\" : \"دولار\"}</TableCell>}\n                        {!hidePrice && <TableCell className=\"font-semibold\">{(item.price * item.quantityOrdered).toFixed(2)}</TableCell>}\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n                {!hidePrice && <div className=\"flex flex-col gap-2 p-4 bg-muted rounded-md\">\n                  {totalCNY > 0 && (\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"font-semibold\">المجموع باليوان الصيني:</span>\n                      <span className=\"text-lg font-bold\">{totalCNY.toFixed(2)} CNY</span>\n                    </div>\n                  )}\n                  {totalUSD > 0 && (\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"font-semibold\">المجموع بالدولار:</span>\n                      <span className=\"text-lg font-bold\">{totalUSD.toFixed(2)} USD</span>\n                    </div>\n                  )}\n                </div>}\n                <div className=\"flex gap-2\">\n                  <Button variant=\"outline\" onClick={() => setStep(\"items\")}>{t(\"common.back\", language)}</Button>\n                  <Button onClick={handleSubmitOrder} disabled={createOrderMutation.isPending} data-testid=\"button-submit-order\">\n                    {createOrderMutation.isPending ? t(\"common.loading\", language) : t(\"orders.confirmOrder\", language)}\n                  </Button>\n                </div>\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n        )}\n      </div>\n\n      <OrdersHistory />\n    </div>\n  );\n}\n\nfunction OrdersHistory() {\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const { language } = useLanguage();\n  const hidePrice = user?.role === \"warehouse\";\n  const { data: orders, isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/orders\"],\n  });\n  const { data: suppliers } = useQuery<Supplier[]>({\n    queryKey: [\"/api/suppliers\"],\n  });\n  const [editingItem, setEditingItem] = useState<any>(null);\n  const [editPrice, setEditPrice] = useState(\"\");\n  const [editQtyOrdered, setEditQtyOrdered] = useState(\"\");\n  const [editCurrency, setEditCurrency] = useState(\"CNY\");\n\n  const updateOrderItemMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: any }) => {\n      const res = await apiRequest(\"PATCH\", `/api/order-items/${id}`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n      setEditingItem(null);\n      toast({ title: \"تم تحديث العنصر بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const openEdit = (item: any) => {\n    setEditingItem(item);\n    setEditPrice(String(item.price || 0));\n    setEditQtyOrdered(String(item.quantityOrdered));\n    setEditCurrency(item.currency || \"CNY\");\n  };\n\n  const handleSaveEdit = () => {\n    if (!editingItem) return;\n    updateOrderItemMutation.mutate({\n      id: editingItem.id,\n      data: {\n        quantityOrdered: parseInt(editQtyOrdered) || 0,\n        price: parseFloat(editPrice) || 0,\n        currency: editCurrency,\n      },\n    });\n  };\n\n  const handlePrintOrder = (order: any) => {\n    const supplierName = order.supplierName || \"\";\n    const orderTotalCNY = order.items?.filter((i: any) => i.currency === \"CNY\").reduce((s: number, i: any) => s + ((i.price || 0) * i.quantityOrdered), 0) || 0;\n    const orderTotalUSD = order.items?.filter((i: any) => i.currency === \"USD\").reduce((s: number, i: any) => s + ((i.price || 0) * i.quantityOrdered), 0) || 0;\n\n    let itemsHtml = \"\";\n    order.items?.forEach((item: any) => {\n      itemsHtml += `\n        <tr>\n          <td>${item.productName || `منتج #${item.productId}`}</td>\n          <td class=\"text-center\">${item.quantityOrdered}</td>\n          ${!hidePrice ? `<td class=\"text-center\">${(item.price || 0).toFixed(2)}</td>` : \"\"}\n          ${!hidePrice ? `<td class=\"text-center\">${item.currency === \"CNY\" ? \"يوان\" : \"دولار\"}</td>` : \"\"}\n          ${!hidePrice ? `<td class=\"text-center\">${((item.price || 0) * item.quantityOrdered).toFixed(2)}</td>` : \"\"}\n        </tr>\n      `;\n    });\n\n    const infoHtml = `\n      <div class=\"info-row\">\n        <div class=\"info-item\"><span class=\"info-label\">المورد:</span> <span class=\"info-value\">${supplierName}</span></div>\n        <div class=\"info-item\"><span class=\"info-label\">التاريخ:</span> <span class=\"info-value\">${formatDateFr(order.createdAt)}</span></div>\n      </div>\n    `;\n\n    const tableHtml = `\n      <table>\n        <thead>\n          <tr>\n            <th>المنتج</th>\n            <th>الكمية</th>\n            ${!hidePrice ? `<th>السعر</th>` : \"\"}\n            ${!hidePrice ? `<th>العملة</th>` : \"\"}\n            ${!hidePrice ? `<th>المجموع</th>` : \"\"}\n          </tr>\n        </thead>\n        <tbody>${itemsHtml}</tbody>\n      </table>\n    `;\n\n    const totalsHtml = !hidePrice ? `\n      <div class=\"totals-section\">\n        ${orderTotalCNY > 0 ? `<div class=\"total-row\"><span class=\"total-label\">المجموع باليوان:</span> <span class=\"total-amount\">${orderTotalCNY.toFixed(2)} CNY</span></div>` : \"\"}\n        ${orderTotalUSD > 0 ? `<div class=\"total-row\"><span class=\"total-label\">المجموع بالدولار:</span> <span class=\"total-amount\">${orderTotalUSD.toFixed(2)} USD</span></div>` : \"\"}\n      </div>\n    ` : \"\";\n\n    openPrintWindow({\n      title: `طلب شراء #${order.id}`,\n      subtitle: supplierName,\n      content: infoHtml + tableHtml + totalsHtml,\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-4\">\n        {Array.from({ length: 3 }).map((_, i) => (\n          <Card key={i}>\n            <CardContent className=\"p-6\">\n              <Skeleton className=\"h-6 w-full\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    );\n  }\n\n  if (!orders || orders.length === 0) {\n    return (\n      <Card>\n        <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n          <ShoppingCart className=\"h-12 w-12 text-muted-foreground mb-3\" />\n          <p className=\"text-muted-foreground\">{t(\"orders.noOrders\", language)}</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <h2 className=\"text-lg font-semibold\">{t(\"orders.orderHistory\", language)}</h2>\n      {orders.map((order: any) => {\n        const orderTotalCNY = order.items?.filter((i: any) => i.currency === \"CNY\").reduce((s: number, i: any) => s + ((i.price || 0) * i.quantityOrdered), 0) || 0;\n        const orderTotalUSD = order.items?.filter((i: any) => i.currency === \"USD\").reduce((s: number, i: any) => s + ((i.price || 0) * i.quantityOrdered), 0) || 0;\n        return (\n          <Card key={order.id} data-testid={`card-order-${order.id}`}>\n            <CardHeader className=\"pb-3\">\n              <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                <CardTitle className=\"text-base\">\n                  طلب #{order.id} - {order.supplierName || \"مورد\"}\n                </CardTitle>\n                <div className=\"flex items-center gap-2\">\n                  <Button size=\"icon\" variant=\"ghost\" onClick={() => handlePrintOrder(order)} data-testid={`button-print-order-${order.id}`}>\n                    <Printer className=\"h-4 w-4\" />\n                  </Button>\n                  <Badge variant={order.confirmed === \"confirmed\" ? \"default\" : \"secondary\"}>\n                    {order.confirmed === \"confirmed\" ? \"مؤكد\" : \"معلق\"}\n                  </Badge>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-4 text-sm text-muted-foreground flex-wrap\">\n                <span>{formatDateFr(order.createdAt)}</span>\n                {!hidePrice && orderTotalCNY > 0 && <span>المجموع: {orderTotalCNY.toFixed(2)} CNY</span>}\n                {!hidePrice && orderTotalUSD > 0 && <span>المجموع: {orderTotalUSD.toFixed(2)} USD</span>}\n              </div>\n            </CardHeader>\n            {order.items && order.items.length > 0 && (\n              <CardContent>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>{t(\"common.product\", language)}</TableHead>\n                      <TableHead>{t(\"common.quantity\", language)}</TableHead>\n                      {!hidePrice && <TableHead>{t(\"orders.price\", language)}</TableHead>}\n                      {!hidePrice && <TableHead>{t(\"orders.currency\", language)}</TableHead>}\n                      {!hidePrice && <TableHead>{t(\"common.total\", language)}</TableHead>}\n                      {!hidePrice && <TableHead>{t(\"common.edit\", language)}</TableHead>}\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {order.items.map((item: any) => (\n                      <TableRow key={item.id}>\n                        <TableCell>{item.productName || `منتج #${item.productId}`}</TableCell>\n                        <TableCell>{item.quantityOrdered}</TableCell>\n                        {!hidePrice && <TableCell>{(item.price || 0).toFixed(2)}</TableCell>}\n                        {!hidePrice && <TableCell>{item.currency === \"CNY\" ? \"يوان\" : \"دولار\"}</TableCell>}\n                        {!hidePrice && <TableCell className=\"font-semibold\">{((item.price || 0) * item.quantityOrdered).toFixed(2)}</TableCell>}\n                        {!hidePrice && <TableCell>\n                          <Button size=\"icon\" variant=\"ghost\" onClick={() => openEdit(item)} data-testid={`button-edit-order-item-${item.id}`}>\n                            <Pencil className=\"h-4 w-4\" />\n                          </Button>\n                        </TableCell>}\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </CardContent>\n            )}\n          </Card>\n        );\n      })}\n\n      <Dialog open={!!editingItem} onOpenChange={(open) => { if (!open) setEditingItem(null); }}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>تعديل عنصر الطلب</DialogTitle>\n          </DialogHeader>\n          {editingItem && (\n            <div className=\"space-y-4 pt-4\">\n              <p className=\"text-sm text-muted-foreground\">المنتج: {editingItem.productName}</p>\n              <div className=\"space-y-2\">\n                <Label>الكمية المطلوبة</Label>\n                <Input data-testid=\"input-edit-order-qty\" type=\"number\" value={editQtyOrdered} onChange={(e) => setEditQtyOrdered(e.target.value)} />\n              </div>\n              {!hidePrice && <div className=\"space-y-2\">\n                <Label>السعر</Label>\n                <Input data-testid=\"input-edit-order-price\" type=\"number\" step=\"0.01\" value={editPrice} onChange={(e) => setEditPrice(e.target.value)} />\n              </div>}\n              {!hidePrice && <div className=\"space-y-2\">\n                <Label>العملة</Label>\n                <Select value={editCurrency} onValueChange={setEditCurrency}>\n                  <SelectTrigger data-testid=\"select-edit-order-currency\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"CNY\">يوان صيني</SelectItem>\n                    <SelectItem value=\"USD\">دولار أمريكي</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>}\n              <Button className=\"w-full\" onClick={handleSaveEdit} disabled={updateOrderItemMutation.isPending} data-testid=\"button-save-edit-order-item\">\n                {updateOrderItemMutation.isPending ? \"جاري الحفظ...\" : \"حفظ التعديل\"}\n              </Button>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":25835,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/pages/warehouse-inventory.tsx":{"content":"import { useRef } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Printer, Warehouse, Package, Layers } from \"lucide-react\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { useLanguage } from \"@/lib/language-context\";\nimport { t, getStatusLabel } from \"@/lib/translations\";\nimport { openPrintWindow } from \"@/lib/printStyles\";\n\nconst statusColors: Record<string, string> = {\n  received: \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\",\n  semi_manufactured: \"bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-200\",\n};\n\nexport default function WarehouseInventory() {\n  const printRef = useRef<HTMLDivElement>(null);\n  const { language } = useLanguage();\n\n  const { data: inventory, isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/warehouse-inventory\"],\n  });\n\n  const handlePrint = () => {\n    const printContent = printRef.current;\n    if (!printContent) return;\n    const isZh = language === \"zh\";\n    const dir = isZh ? \"ltr\" : \"rtl\";\n    const lang = isZh ? \"zh\" : \"ar\";\n    openPrintWindow({\n      title: t(\"warehouseInv.title\", language),\n      content: printContent.innerHTML,\n      dir,\n      lang,\n    });\n  };\n\n  const totalProducts = inventory?.length || 0;\n  const totalQuantity = inventory?.reduce((s: number, p: any) => s + p.quantity, 0) || 0;\n  const totalWeight = inventory?.reduce((s: number, p: any) => {\n    if (p.parts && p.parts.length > 0) {\n      return s + p.parts.reduce((ps: number, part: any) => ps + ((part.weight || 0) * (part.quantity || 0)), 0);\n    }\n    return s + ((p.weight || 0) * p.quantity);\n  }, 0) || 0;\n  const totalVolume = inventory?.reduce((s: number, p: any) => {\n    if (p.parts && p.parts.length > 0) {\n      return s + p.parts.reduce((ps: number, part: any) => {\n        const vol = ((part.length || 0) * (part.width || 0) * (part.height || 0)) / 1000000;\n        return ps + vol * (part.quantity || 0);\n      }, 0);\n    }\n    const vol = ((p.length || 0) * (p.width || 0) * (p.height || 0)) / 1000000;\n    return s + vol * p.quantity;\n  }, 0) || 0;\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <Skeleton className=\"h-10 w-48\" />\n        <Skeleton className=\"h-32 w-full\" />\n        <Skeleton className=\"h-64 w-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-inventory-title\">{t(\"warehouseInv.title\", language)}</h1>\n          <p className=\"text-muted-foreground\">{t(\"warehouseInv.subtitle\", language)}</p>\n        </div>\n        {inventory && inventory.length > 0 && (\n          <Button variant=\"outline\" onClick={handlePrint} data-testid=\"button-print-inventory\">\n            <Printer className=\"h-4 w-4\" />\n            {t(\"common.print\", language)}\n          </Button>\n        )}\n      </div>\n\n      <div ref={printRef}>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">{t(\"warehouseInv.totalProducts\", language)}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <span className=\"text-2xl font-bold\" data-testid=\"text-total-products\">{totalProducts}</span>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">{t(\"warehouseInv.totalQuantity\", language)}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <span className=\"text-2xl font-bold\" data-testid=\"text-total-quantity\">{totalQuantity}</span>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">{t(\"warehouseInv.totalWeight\", language)} ({t(\"products.kg\", language)})</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <span className=\"text-2xl font-bold\" data-testid=\"text-total-weight\">{totalWeight.toFixed(2)}</span>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">{t(\"warehouseInv.totalVolume\", language)} (m³)</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <span className=\"text-2xl font-bold\" data-testid=\"text-total-volume\">{totalVolume.toFixed(4)}</span>\n            </CardContent>\n          </Card>\n        </div>\n\n        {!inventory || inventory.length === 0 ? (\n          <Card>\n            <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n              <Warehouse className=\"h-12 w-12 text-muted-foreground mb-3\" />\n              <p className=\"text-muted-foreground\">{t(\"warehouseInv.noInventory\", language)}</p>\n            </CardContent>\n          </Card>\n        ) : (\n          <Card>\n            <CardContent className=\"pt-6\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>#</TableHead>\n                    <TableHead>{t(\"common.product\", language)}</TableHead>\n                    <TableHead>{t(\"common.category\", language)}</TableHead>\n                    <TableHead>{t(\"common.status\", language)}</TableHead>\n                    <TableHead>{t(\"common.quantity\", language)}</TableHead>\n                    <TableHead>{t(\"products.weight\", language)} ({t(\"products.kg\", language)})</TableHead>\n                    <TableHead>{t(\"warehouseInv.dimensions\", language)} ({t(\"products.cm\", language)})</TableHead>\n                    <TableHead>{t(\"warehouseInv.volume\", language)} (m³)</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {inventory.map((item: any, idx: number) => {\n                    const hasParts = item.parts && item.parts.length > 0;\n                    const itemWeight = hasParts\n                      ? item.parts.reduce((s: number, p: any) => s + ((p.weight || 0) * (p.quantity || 0)), 0)\n                      : (item.weight || 0) * item.quantity;\n                    const itemVolume = hasParts\n                      ? item.parts.reduce((s: number, p: any) => {\n                          return s + (((p.length || 0) * (p.width || 0) * (p.height || 0)) / 1000000) * (p.quantity || 0);\n                        }, 0)\n                      : (((item.length || 0) * (item.width || 0) * (item.height || 0)) / 1000000) * item.quantity;\n\n                    return (\n                      <>\n                        <TableRow key={item.id} data-testid={`row-inventory-${item.id}`}>\n                          <TableCell>{idx + 1}</TableCell>\n                          <TableCell className=\"font-medium\">\n                            <div className=\"flex items-center gap-2\">\n                              {item.name}\n                              {hasParts && <Layers className=\"h-4 w-4 text-muted-foreground\" />}\n                            </div>\n                          </TableCell>\n                          <TableCell>{item.categoryName || \"-\"}</TableCell>\n                          <TableCell>\n                            <Badge variant=\"secondary\" className={statusColors[item.status] || \"\"}>\n                              {getStatusLabel(item.status, language)}\n                            </Badge>\n                          </TableCell>\n                          <TableCell>{item.quantity}</TableCell>\n                          <TableCell>{itemWeight.toFixed(2)}</TableCell>\n                          <TableCell>\n                            {hasParts ? \"-\" : `${item.length || 0} × ${item.width || 0} × ${item.height || 0}`}\n                          </TableCell>\n                          <TableCell>{itemVolume.toFixed(4)}</TableCell>\n                        </TableRow>\n                        {hasParts && item.parts.map((part: any) => (\n                          <TableRow key={`part-${part.id}`} className=\"bg-muted/30\">\n                            <TableCell></TableCell>\n                            <TableCell className=\"text-sm text-muted-foreground pr-8\">\n                              <div className=\"flex items-center gap-1\">\n                                <Package className=\"h-3 w-3\" />\n                                {part.name}\n                              </div>\n                            </TableCell>\n                            <TableCell></TableCell>\n                            <TableCell>\n                              <Badge variant=\"secondary\" className=\"text-xs\">{t(\"products.parts\", language)}</Badge>\n                            </TableCell>\n                            <TableCell className=\"text-sm\">{part.quantity || 0}</TableCell>\n                            <TableCell className=\"text-sm\">{((part.weight || 0) * (part.quantity || 0)).toFixed(2)}</TableCell>\n                            <TableCell className=\"text-sm\">\n                              {part.length || 0} × {part.width || 0} × {part.height || 0}\n                            </TableCell>\n                            <TableCell className=\"text-sm\">\n                              {((((part.length || 0) * (part.width || 0) * (part.height || 0)) / 1000000) * (part.quantity || 0)).toFixed(4)}\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":10098,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"/{*path}\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":554,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1417,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 220 15% 97%;\n  --foreground: 220 13% 13%;\n  --border: 220 13% 91%;\n  --card: 220 14% 95%;\n  --card-foreground: 220 13% 13%;\n  --card-border: 220 13% 89%;\n  --sidebar: 220 14% 93%;\n  --sidebar-foreground: 220 13% 13%;\n  --sidebar-border: 220 13% 87%;\n  --sidebar-primary: 217 91% 48%;\n  --sidebar-primary-foreground: 217 91% 98%;\n  --sidebar-accent: 220 13% 88%;\n  --sidebar-accent-foreground: 220 13% 13%;\n  --sidebar-ring: 217 91% 48%;\n  --popover: 220 14% 91%;\n  --popover-foreground: 220 13% 13%;\n  --popover-border: 220 13% 85%;\n  --primary: 217 91% 48%;\n  --primary-foreground: 217 91% 98%;\n  --secondary: 220 12% 86%;\n  --secondary-foreground: 220 13% 13%;\n  --muted: 220 12% 89%;\n  --muted-foreground: 220 10% 35%;\n  --accent: 220 15% 90%;\n  --accent-foreground: 220 13% 13%;\n  --destructive: 0 84% 45%;\n  --destructive-foreground: 0 84% 98%;\n  --input: 220 13% 75%;\n  --ring: 217 91% 48%;\n  --chart-1: 217 91% 45%;\n  --chart-2: 173 58% 39%;\n  --chart-3: 197 37% 38%;\n  --chart-4: 43 74% 49%;\n  --chart-5: 27 87% 50%;\n  --font-sans: Open Sans, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(220 13% 13% / 0.05);\n  --shadow-xs: 0px 2px 0px 0px hsl(220 13% 13% / 0.08);\n  --shadow-sm: 0px 2px 0px 0px hsl(220 13% 13% / 0.05), 0px 1px 2px -1px hsl(220 13% 13% / 0.10);\n  --shadow: 0px 2px 0px 0px hsl(220 13% 13% / 0.05), 0px 1px 2px -1px hsl(220 13% 13% / 0.10);\n  --shadow-md: 0px 2px 0px 0px hsl(220 13% 13% / 0.06), 0px 2px 4px -1px hsl(220 13% 13% / 0.10);\n  --shadow-lg: 0px 2px 0px 0px hsl(220 13% 13% / 0.08), 0px 4px 6px -1px hsl(220 13% 13% / 0.10);\n  --shadow-xl: 0px 2px 0px 0px hsl(220 13% 13% / 0.10), 0px 8px 10px -1px hsl(220 13% 13% / 0.12);\n  --shadow-2xl: 0px 2px 0px 0px hsl(220 13% 13% / 0.15);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 220 15% 8%;\n  --foreground: 220 10% 92%;\n  --border: 220 12% 16%;\n  --card: 220 14% 10%;\n  --card-foreground: 220 10% 92%;\n  --card-border: 220 12% 14%;\n  --sidebar: 220 14% 12%;\n  --sidebar-foreground: 220 10% 92%;\n  --sidebar-border: 220 12% 17%;\n  --sidebar-primary: 217 91% 55%;\n  --sidebar-primary-foreground: 217 91% 98%;\n  --sidebar-accent: 220 12% 16%;\n  --sidebar-accent-foreground: 220 10% 92%;\n  --sidebar-ring: 217 91% 55%;\n  --popover: 220 14% 14%;\n  --popover-foreground: 220 10% 92%;\n  --popover-border: 220 12% 19%;\n  --primary: 217 91% 48%;\n  --primary-foreground: 217 91% 98%;\n  --secondary: 220 12% 18%;\n  --secondary-foreground: 220 10% 92%;\n  --muted: 220 12% 16%;\n  --muted-foreground: 220 8% 70%;\n  --accent: 220 14% 15%;\n  --accent-foreground: 220 10% 92%;\n  --destructive: 0 84% 45%;\n  --destructive-foreground: 0 84% 98%;\n  --input: 220 12% 30%;\n  --ring: 217 91% 55%;\n  --chart-1: 217 91% 65%;\n  --chart-2: 173 58% 55%;\n  --chart-3: 197 37% 60%;\n  --chart-4: 43 74% 65%;\n  --chart-5: 27 87% 65%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(220 15% 0% / 0.30);\n  --shadow-xs: 0px 2px 0px 0px hsl(220 15% 0% / 0.35);\n  --shadow-sm: 0px 2px 0px 0px hsl(220 15% 0% / 0.30), 0px 1px 2px -1px hsl(220 15% 0% / 0.40);\n  --shadow: 0px 2px 0px 0px hsl(220 15% 0% / 0.30), 0px 1px 2px -1px hsl(220 15% 0% / 0.40);\n  --shadow-md: 0px 2px 0px 0px hsl(220 15% 0% / 0.35), 0px 2px 4px -1px hsl(220 15% 0% / 0.45);\n  --shadow-lg: 0px 2px 0px 0px hsl(220 15% 0% / 0.40), 0px 4px 6px -1px hsl(220 15% 0% / 0.50);\n  --shadow-xl: 0px 2px 0px 0px hsl(220 15% 0% / 0.50), 0px 8px 10px -1px hsl(220 15% 0% / 0.60);\n  --shadow-2xl: 0px 2px 0px 0px hsl(220 15% 0% / 0.70);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","path":null,"size_bytes":10760,"size_tokens":null},"client/src/pages/products.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Plus, Search, Package, Trash2, RotateCcw, FileSpreadsheet, AlertTriangle, Layers } from \"lucide-react\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport type { Product, Category, ProductPart } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useAuth } from \"@/App\";\nimport { useLanguage } from \"@/lib/language-context\";\nimport { t, getStatusLabel } from \"@/lib/translations\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\n\nconst statusColors: Record<string, string> = {\n  purchase_order: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200\",\n  ordered: \"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200\",\n  received: \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\",\n  semi_manufactured: \"bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-200\",\n  shipping: \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200\",\n  arrived: \"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200\",\n};\n\nconst STATUS_AGING_THRESHOLDS: Record<string, number> = {\n  purchase_order: 7,\n  ordered: 30,\n  received: 7,\n};\nconst terminalStatuses = [\"arrived\"];\n\nfunction getAgingDays(product: Product): number | null {\n  if (!product.statusChangedAt || terminalStatuses.includes(product.status)) return null;\n  const threshold = STATUS_AGING_THRESHOLDS[product.status];\n  if (!threshold) return null;\n  const changed = new Date(product.statusChangedAt);\n  const now = new Date();\n  const diffMs = now.getTime() - changed.getTime();\n  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n  return diffDays >= threshold ? diffDays : null;\n}\n\nexport default function Products() {\n  const { toast } = useToast();\n  const { user: currentUser } = useAuth();\n  const { language } = useLanguage();\n  const [search, setSearch] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [resetDialogOpen, setResetDialogOpen] = useState(false);\n  const [productToDelete, setProductToDelete] = useState<Product | null>(null);\n  const [productToReset, setProductToReset] = useState<Product | null>(null);\n  const [partsDialogOpen, setPartsDialogOpen] = useState(false);\n  const [partsProduct, setPartsProduct] = useState<Product | null>(null);\n  const [compositeDialogOpen, setCompositeDialogOpen] = useState(false);\n  const [compositeName, setCompositeName] = useState(\"\");\n  const [compositeQuantity, setCompositeQuantity] = useState(\"\");\n  const [compositeCategoryId, setCompositeCategoryId] = useState(\"\");\n  const [name, setName] = useState(\"\");\n  const [quantity, setQuantity] = useState(\"\");\n  const [categoryId, setCategoryId] = useState(\"\");\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const { data: products, isLoading } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n  const { data: allCategories } = useQuery<Category[]>({\n    queryKey: [\"/api/categories\"],\n  });\n\n  const isAdmin = currentUser?.role === \"admin\";\n  const categories = isAdmin\n    ? allCategories\n    : allCategories?.filter(c => currentUser?.allowedCategories?.includes(c.id));\n\n  const createMutation = useMutation({\n    mutationFn: async (data: { name: string; quantity: number; categoryId: number | null }) => {\n      const res = await apiRequest(\"POST\", \"/api/products\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      setDialogOpen(false);\n      setName(\"\");\n      setQuantity(\"\");\n      setCategoryId(\"\");\n      toast({ title: \"تم إنشاء المنتج بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const createCompositeMutation = useMutation({\n    mutationFn: async (data: { name: string; quantity: number; categoryId: number | null }) => {\n      const res = await apiRequest(\"POST\", \"/api/products\", data);\n      return await res.json();\n    },\n    onSuccess: (product: Product) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      setCompositeDialogOpen(false);\n      setCompositeName(\"\");\n      setCompositeQuantity(\"\");\n      setCompositeCategoryId(\"\");\n      toast({ title: \"تم إنشاء المنتج المركب بنجاح\" });\n      setPartsProduct(product);\n      setPartsDialogOpen(true);\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/products/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      setDeleteDialogOpen(false);\n      setProductToDelete(null);\n      toast({ title: \"تم حذف المنتج بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const resetMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const res = await apiRequest(\"PATCH\", `/api/products/${id}`, { quantity: 0 });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      setResetDialogOpen(false);\n      setProductToReset(null);\n      toast({ title: \"تم تصفير الكمية بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const [importing, setImporting] = useState(false);\n\n  const handleImport = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    setImporting(true);\n    try {\n      const formData = new FormData();\n      formData.append(\"file\", file);\n      const res = await fetch(\"/api/products/import\", {\n        method: \"POST\",\n        body: formData,\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        const errData = await res.json();\n        throw new Error(errData.message || \"فشل في الاستيراد\");\n      }\n      const data = await res.json();\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      toast({ title: `تم استيراد ${data.imported} منتج بنجاح` });\n    } catch (error: any) {\n      toast({ title: \"خطأ في الاستيراد\", description: error.message, variant: \"destructive\" });\n    } finally {\n      setImporting(false);\n      if (fileInputRef.current) fileInputRef.current.value = \"\";\n    }\n  };\n\n  const handleCreate = () => {\n    if (!name.trim()) {\n      toast({ title: \"يرجى إدخال اسم المنتج\", variant: \"destructive\" });\n      return;\n    }\n    createMutation.mutate({\n      name: name.trim(),\n      quantity: parseInt(quantity) || 0,\n      categoryId: categoryId ? parseInt(categoryId) : null,\n    });\n  };\n\n  const handleCreateComposite = () => {\n    if (!compositeName.trim()) {\n      toast({ title: \"يرجى إدخال اسم المنتج المركب\", variant: \"destructive\" });\n      return;\n    }\n    createCompositeMutation.mutate({\n      name: compositeName.trim(),\n      quantity: parseInt(compositeQuantity) || 0,\n      categoryId: compositeCategoryId ? parseInt(compositeCategoryId) : null,\n    });\n  };\n\n  const filtered = (products?.filter((p) => {\n    const matchSearch = p.name.toLowerCase().includes(search.toLowerCase());\n    const matchStatus = statusFilter === \"all\" || p.status === statusFilter;\n    return matchSearch && matchStatus;\n  }) || []).sort((a, b) => b.id - a.id);\n\n  const getCategoryName = (catId: number | null) => {\n    if (!catId || !allCategories) return \"-\";\n    return allCategories.find(c => c.id === catId)?.name || \"-\";\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-products-title\">{t(\"products.title\", language)}</h1>\n          <p className=\"text-muted-foreground\">{t(\"products.subtitle\", language)}</p>\n        </div>\n        <div className=\"flex items-center gap-2 flex-wrap\">\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept=\".xlsx,.xls,.csv\"\n            className=\"hidden\"\n            onChange={handleImport}\n            data-testid=\"input-import-file\"\n          />\n          <Button\n            variant=\"outline\"\n            onClick={() => fileInputRef.current?.click()}\n            disabled={importing}\n            data-testid=\"button-import-products\"\n          >\n            <FileSpreadsheet className=\"h-4 w-4\" />\n            {importing ? \"جاري الاستيراد...\" : t(\"products.importExcel\", language)}\n          </Button>\n          <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n            <DialogTrigger asChild>\n              <Button data-testid=\"button-add-product\">\n                <Plus className=\"h-4 w-4\" />\n                {t(\"products.addProduct\", language)}\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>{t(\"products.addProduct\", language)}</DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4 pt-4\">\n                <div className=\"space-y-2\">\n                  <Label>{t(\"products.productName\", language)}</Label>\n                  <Input\n                    data-testid=\"input-product-name\"\n                    value={name}\n                    onChange={(e) => setName(e.target.value)}\n                    placeholder=\"أدخل اسم المنتج\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>{t(\"common.quantity\", language)}</Label>\n                  <Input\n                    data-testid=\"input-product-quantity\"\n                    type=\"number\"\n                    value={quantity}\n                    onChange={(e) => setQuantity(e.target.value)}\n                    placeholder=\"0\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>{t(\"common.category\", language)}</Label>\n                  <Select value={categoryId} onValueChange={setCategoryId}>\n                    <SelectTrigger data-testid=\"select-product-category\">\n                      <SelectValue placeholder=\"اختر الفئة\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {categories?.map((cat) => (\n                        <SelectItem key={cat.id} value={String(cat.id)}>\n                          {cat.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <Button\n                  data-testid=\"button-submit-product\"\n                  className=\"w-full\"\n                  onClick={handleCreate}\n                  disabled={createMutation.isPending}\n                >\n                  {createMutation.isPending ? \"جاري الإنشاء...\" : \"إنشاء المنتج\"}\n                </Button>\n              </div>\n            </DialogContent>\n          </Dialog>\n          <Dialog open={compositeDialogOpen} onOpenChange={setCompositeDialogOpen}>\n            <DialogTrigger asChild>\n              <Button variant=\"outline\" data-testid=\"button-add-composite-product\">\n                <Layers className=\"h-4 w-4\" />\n                {t(\"products.addComposite\", language)}\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>{t(\"products.addComposite\", language)}</DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4 pt-4\">\n                <div className=\"space-y-2\">\n                  <Label>{t(\"products.productName\", language)}</Label>\n                  <Input\n                    data-testid=\"input-composite-name\"\n                    value={compositeName}\n                    onChange={(e) => setCompositeName(e.target.value)}\n                    placeholder=\"أدخل اسم المنتج المركب\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>{t(\"common.quantity\", language)}</Label>\n                  <Input\n                    data-testid=\"input-composite-quantity\"\n                    type=\"number\"\n                    value={compositeQuantity}\n                    onChange={(e) => setCompositeQuantity(e.target.value)}\n                    placeholder=\"0\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>{t(\"common.category\", language)}</Label>\n                  <Select value={compositeCategoryId} onValueChange={setCompositeCategoryId}>\n                    <SelectTrigger data-testid=\"select-composite-category\">\n                      <SelectValue placeholder=\"اختر الفئة\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {categories?.map((cat) => (\n                        <SelectItem key={cat.id} value={String(cat.id)}>\n                          {cat.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <Button\n                  data-testid=\"button-submit-composite\"\n                  className=\"w-full\"\n                  onClick={handleCreateComposite}\n                  disabled={createCompositeMutation.isPending}\n                >\n                  {createCompositeMutation.isPending ? \"جاري الإنشاء...\" : \"إنشاء المنتج المركب\"}\n                </Button>\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      <Card>\n        <CardHeader className=\"pb-3\">\n          <div className=\"flex items-center gap-3 flex-wrap\">\n            <div className=\"relative flex-1 min-w-[200px]\">\n              <Search className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                data-testid=\"input-search-products\"\n                className=\"pr-9\"\n                placeholder={t(\"common.search\", language)}\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n              />\n            </div>\n            <Select value={statusFilter} onValueChange={setStatusFilter}>\n              <SelectTrigger className=\"w-[180px]\" data-testid=\"select-status-filter\">\n                <SelectValue placeholder=\"تصفية حسب الحالة\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">{t(\"common.all\", language)}</SelectItem>\n                {Object.keys(statusColors).map((key) => (\n                  <SelectItem key={key} value={key}>{getStatusLabel(key, language)}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"space-y-3\">\n              {Array.from({ length: 5 }).map((_, i) => (\n                <Skeleton key={i} className=\"h-12 w-full\" />\n              ))}\n            </div>\n          ) : filtered.length > 0 ? (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>#</TableHead>\n                    <TableHead>{t(\"products.productName\", language)}</TableHead>\n                    <TableHead>{t(\"common.quantity\", language)}</TableHead>\n                    <TableHead>{t(\"common.category\", language)}</TableHead>\n                    <TableHead>{t(\"common.status\", language)}</TableHead>\n                    <TableHead>{t(\"common.date\", language)}</TableHead>\n                    <TableHead>{t(\"common.edit\", language)}</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filtered.map((product, idx) => {\n                    const agingDays = getAgingDays(product);\n                    return (\n                    <TableRow\n                      key={product.id}\n                      data-testid={`row-product-${product.id}`}\n                      className={agingDays ? \"bg-amber-50/50 dark:bg-amber-950/20\" : \"\"}\n                    >\n                      <TableCell className=\"font-medium\">{idx + 1}</TableCell>\n                      <TableCell className=\"font-medium\">{product.name}</TableCell>\n                      <TableCell>{product.quantity}</TableCell>\n                      <TableCell>{getCategoryName(product.categoryId)}</TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-1.5\">\n                          <Badge variant=\"secondary\" className={statusColors[product.status]}>\n                            {getStatusLabel(product.status, language)}\n                          </Badge>\n                          {agingDays && (\n                            <Tooltip>\n                              <TooltipTrigger asChild>\n                                <AlertTriangle className=\"h-4 w-4 text-amber-500 shrink-0\" data-testid={`icon-aging-${product.id}`} />\n                              </TooltipTrigger>\n                              <TooltipContent>\n                                <p>{agingDays} {t(\"products.statusAge\", language)}</p>\n                              </TooltipContent>\n                            </Tooltip>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-muted-foreground text-sm\">\n                        {product.statusChangedAt\n                          ? new Date(product.statusChangedAt).toLocaleDateString(\"fr-FR\")\n                          : \"-\"}\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex gap-1\">\n                          {product.status === \"semi_manufactured\" && (\n                            <Tooltip>\n                              <TooltipTrigger asChild>\n                                <Button\n                                  size=\"icon\"\n                                  variant=\"ghost\"\n                                  data-testid={`button-parts-${product.id}`}\n                                  onClick={() => {\n                                    setPartsProduct(product);\n                                    setPartsDialogOpen(true);\n                                  }}\n                                >\n                                  <Layers className=\"h-4 w-4 text-cyan-600\" />\n                                </Button>\n                              </TooltipTrigger>\n                              <TooltipContent>\n                                <p>{t(\"products.parts\", language)}</p>\n                              </TooltipContent>\n                            </Tooltip>\n                          )}\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            data-testid={`button-reset-quantity-${product.id}`}\n                            onClick={() => {\n                              setProductToReset(product);\n                              setResetDialogOpen(true);\n                            }}\n                          >\n                            <RotateCcw className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            data-testid={`button-delete-product-${product.id}`}\n                            onClick={() => {\n                              setProductToDelete(product);\n                              setDeleteDialogOpen(true);\n                            }}\n                          >\n                            <Trash2 className=\"h-4 w-4 text-destructive\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </div>\n          ) : (\n            <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n              <Package className=\"h-12 w-12 text-muted-foreground mb-3\" />\n              <p className=\"text-muted-foreground\">{t(\"products.noProducts\", language)}</p>\n              <p className=\"text-sm text-muted-foreground\">أضف منتجًا جديدًا للبدء</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {partsProduct && (\n        <PartsDialog\n          product={partsProduct}\n          open={partsDialogOpen}\n          onOpenChange={(open) => {\n            setPartsDialogOpen(open);\n            if (!open) setPartsProduct(null);\n          }}\n        />\n      )}\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>تأكيد الحذف</AlertDialogTitle>\n            <AlertDialogDescription>\n              هل أنت متأكد من حذف المنتج \"{productToDelete?.name}\"؟ سيتم حذف جميع البيانات المرتبطة نهائيًا.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter className=\"flex gap-2\">\n            <AlertDialogCancel data-testid=\"button-cancel-delete\">{t(\"common.cancel\", language)}</AlertDialogCancel>\n            <AlertDialogAction\n              data-testid=\"button-confirm-delete\"\n              onClick={() => productToDelete && deleteMutation.mutate(productToDelete.id)}\n              className=\"bg-destructive text-destructive-foreground\"\n            >\n              {deleteMutation.isPending ? \"جاري الحذف...\" : t(\"common.delete\", language)}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      <AlertDialog open={resetDialogOpen} onOpenChange={setResetDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>تصفير الكمية</AlertDialogTitle>\n            <AlertDialogDescription>\n              هل أنت متأكد من تصفير كمية المنتج \"{productToReset?.name}\"؟ ستصبح الكمية صفرًا.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter className=\"flex gap-2\">\n            <AlertDialogCancel data-testid=\"button-cancel-reset\">{t(\"common.cancel\", language)}</AlertDialogCancel>\n            <AlertDialogAction\n              data-testid=\"button-confirm-reset\"\n              onClick={() => productToReset && resetMutation.mutate(productToReset.id)}\n            >\n              {resetMutation.isPending ? \"جاري التصفير...\" : t(\"common.reset\", language)}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n\nfunction PartsDialog({ product, open, onOpenChange }: { product: Product; open: boolean; onOpenChange: (open: boolean) => void }) {\n  const { toast } = useToast();\n  const { language } = useLanguage();\n  const [partName, setPartName] = useState(\"\");\n  const [partQuantity, setPartQuantity] = useState(\"\");\n  const [partLength, setPartLength] = useState(\"\");\n  const [partWidth, setPartWidth] = useState(\"\");\n  const [partHeight, setPartHeight] = useState(\"\");\n  const [partWeight, setPartWeight] = useState(\"\");\n  const [partPieces, setPartPieces] = useState(\"\");\n\n  const { data: parts, isLoading } = useQuery<ProductPart[]>({\n    queryKey: [\"/api/products\", product.id, \"parts\"],\n    enabled: open,\n  });\n\n  const createPartMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await apiRequest(\"POST\", `/api/products/${product.id}/parts`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\", product.id, \"parts\"] });\n      setPartName(\"\");\n      setPartQuantity(\"\");\n      setPartLength(\"\");\n      setPartWidth(\"\");\n      setPartHeight(\"\");\n      setPartWeight(\"\");\n      setPartPieces(\"\");\n      toast({ title: \"تم إضافة الجزء بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deletePartMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/product-parts/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\", product.id, \"parts\"] });\n      toast({ title: \"تم حذف الجزء\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const handleAddPart = () => {\n    if (!partName.trim()) {\n      toast({ title: \"يرجى إدخال اسم الجزء\", variant: \"destructive\" });\n      return;\n    }\n    createPartMutation.mutate({\n      name: partName.trim(),\n      quantity: partQuantity ? parseInt(partQuantity) : 0,\n      length: partLength ? parseFloat(partLength) : null,\n      width: partWidth ? parseFloat(partWidth) : null,\n      height: partHeight ? parseFloat(partHeight) : null,\n      weight: partWeight ? parseFloat(partWeight) : null,\n      piecesPerCarton: partPieces ? parseInt(partPieces) : null,\n    });\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>{t(\"products.parts\", language)}: {product.name}</DialogTitle>\n        </DialogHeader>\n        <div className=\"space-y-4 pt-4\">\n          <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-7 gap-2\">\n            <div className=\"col-span-2 md:col-span-2 lg:col-span-5\">\n              <Label>{t(\"products.partName\", language)}</Label>\n              <Input\n                data-testid=\"input-part-name\"\n                value={partName}\n                onChange={(e) => setPartName(e.target.value)}\n                placeholder={t(\"products.partName\", language)}\n              />\n            </div>\n            <div className=\"col-span-2 md:col-span-1 lg:col-span-2\">\n              <Label>{t(\"common.quantity\", language)}</Label>\n              <Input\n                data-testid=\"input-part-quantity\"\n                type=\"number\"\n                value={partQuantity}\n                onChange={(e) => setPartQuantity(e.target.value)}\n                placeholder=\"0\"\n              />\n            </div>\n            <div>\n              <Label>{t(\"products.length\", language)} ({t(\"products.cm\", language)})</Label>\n              <Input\n                data-testid=\"input-part-length\"\n                type=\"number\"\n                step=\"0.1\"\n                value={partLength}\n                onChange={(e) => setPartLength(e.target.value)}\n                placeholder=\"0\"\n              />\n            </div>\n            <div>\n              <Label>{t(\"products.width\", language)} ({t(\"products.cm\", language)})</Label>\n              <Input\n                data-testid=\"input-part-width\"\n                type=\"number\"\n                step=\"0.1\"\n                value={partWidth}\n                onChange={(e) => setPartWidth(e.target.value)}\n                placeholder=\"0\"\n              />\n            </div>\n            <div>\n              <Label>{t(\"products.height\", language)} ({t(\"products.cm\", language)})</Label>\n              <Input\n                data-testid=\"input-part-height\"\n                type=\"number\"\n                step=\"0.1\"\n                value={partHeight}\n                onChange={(e) => setPartHeight(e.target.value)}\n                placeholder=\"0\"\n              />\n            </div>\n            <div>\n              <Label>{t(\"products.weight\", language)} ({t(\"products.kg\", language)})</Label>\n              <Input\n                data-testid=\"input-part-weight\"\n                type=\"number\"\n                step=\"0.1\"\n                value={partWeight}\n                onChange={(e) => setPartWeight(e.target.value)}\n                placeholder=\"0\"\n              />\n            </div>\n            <div>\n              <Label>{t(\"products.piecesPerCarton\", language)}</Label>\n              <Input\n                data-testid=\"input-part-pieces\"\n                type=\"number\"\n                value={partPieces}\n                onChange={(e) => setPartPieces(e.target.value)}\n                placeholder=\"0\"\n              />\n            </div>\n            <div className=\"flex items-end\">\n              <Button\n                onClick={handleAddPart}\n                disabled={createPartMutation.isPending}\n                data-testid=\"button-add-part\"\n              >\n                <Plus className=\"h-4 w-4\" />\n                {t(\"common.add\", language)}\n              </Button>\n            </div>\n          </div>\n\n          {isLoading ? (\n            <Skeleton className=\"h-32 w-full\" />\n          ) : parts && parts.length > 0 ? (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>{t(\"products.partName\", language)}</TableHead>\n                  <TableHead>{t(\"common.quantity\", language)}</TableHead>\n                  <TableHead>{t(\"products.length\", language)} ({t(\"products.cm\", language)})</TableHead>\n                  <TableHead>{t(\"products.width\", language)} ({t(\"products.cm\", language)})</TableHead>\n                  <TableHead>{t(\"products.height\", language)} ({t(\"products.cm\", language)})</TableHead>\n                  <TableHead>{t(\"products.weight\", language)} ({t(\"products.kg\", language)})</TableHead>\n                  <TableHead>{t(\"products.piecesPerCarton\", language)}</TableHead>\n                  <TableHead>{t(\"common.delete\", language)}</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {parts.map((part) => (\n                  <TableRow key={part.id} data-testid={`row-part-${part.id}`}>\n                    <TableCell className=\"font-medium\">{part.name}</TableCell>\n                    <TableCell>{part.quantity}</TableCell>\n                    <TableCell>{part.length ?? \"-\"}</TableCell>\n                    <TableCell>{part.width ?? \"-\"}</TableCell>\n                    <TableCell>{part.height ?? \"-\"}</TableCell>\n                    <TableCell>{part.weight ?? \"-\"}</TableCell>\n                    <TableCell>{part.piecesPerCarton ?? \"-\"}</TableCell>\n                    <TableCell>\n                      <Button\n                        size=\"icon\"\n                        variant=\"ghost\"\n                        data-testid={`button-delete-part-${part.id}`}\n                        onClick={() => deletePartMutation.mutate(part.id)}\n                        disabled={deletePartMutation.isPending}\n                      >\n                        <Trash2 className=\"h-4 w-4 text-destructive\" />\n                      </Button>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          ) : (\n            <div className=\"flex flex-col items-center justify-center py-8 text-center\">\n              <Layers className=\"h-10 w-10 text-muted-foreground mb-2\" />\n              <p className=\"text-muted-foreground\">لا توجد أجزاء لهذا المنتج</p>\n              <p className=\"text-sm text-muted-foreground\">أضف أجزاء المنتج باستخدام النموذج أعلاه</p>\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":33196,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/app-sidebar.tsx":{"content":"import { useLocation } from \"wouter\";\nimport {\n  Package,\n  Users,\n  ShoppingCart,\n  Truck,\n  Ship,\n  Anchor,\n  LayoutDashboard,\n  Wallet,\n  FolderOpen,\n  Warehouse,\n  UserCog,\n  CreditCard,\n  Landmark,\n  Receipt,\n  FileText,\n} from \"lucide-react\";\nimport { useAuth } from \"@/App\";\nimport { useLanguage } from \"@/lib/language-context\";\nimport { t } from \"@/lib/translations\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarHeader,\n} from \"@/components/ui/sidebar\";\n\nconst mainItems = [\n  { titleKey: \"sidebar.dashboard\", url: \"/\", icon: LayoutDashboard },\n  { titleKey: \"sidebar.products\", url: \"/products\", icon: Package },\n  { titleKey: \"الموردين\", url: \"/suppliers\", icon: Users },\n  { titleKey: \"الفئات\", url: \"/categories\", icon: FolderOpen },\n  { titleKey: \"sidebar.warehouses\", url: \"/warehouses\", icon: Warehouse },\n];\n\nconst operationItems = [\n  { titleKey: \"sidebar.orders\", url: \"/orders\", icon: ShoppingCart },\n  { titleKey: \"sidebar.deliveries\", url: \"/deliveries\", icon: Truck },\n  { titleKey: \"sidebar.warehouseInventory\", url: \"/warehouse-inventory\", icon: Warehouse },\n  { titleKey: \"sidebar.shipping\", url: \"/shipping\", icon: Ship },\n  { titleKey: \"وصول الحاويات\", url: \"/arrivals\", icon: Anchor },\n  { titleKey: \"سجل الفواتير\", url: \"/container-invoices\", icon: FileText },\n];\n\nconst financeItems = [\n  { titleKey: \"صندوق الحسابات\", url: \"/cashbox\", icon: Landmark },\n  { titleKey: \"صندوق المصاريف\", url: \"/expenses\", icon: Receipt },\n  { titleKey: \"حسابات الموردين\", url: \"/supplier-accounts\", icon: Wallet },\n  { titleKey: \"حسابات شركات الشحن\", url: \"/shipping-accounts\", icon: CreditCard },\n];\n\nconst warehouseMainUrls = [\"/\", \"/products\", \"/warehouses\"];\nconst warehouseOperationUrls = [\"/orders\", \"/deliveries\", \"/warehouse-inventory\", \"/shipping\"];\n\nexport function AppSidebar() {\n  const [location] = useLocation();\n  const { user } = useAuth();\n  const { language } = useLanguage();\n  const isAdmin = user?.role === \"admin\";\n  const isWarehouse = user?.role === \"warehouse\";\n\n  const resolveTitle = (titleKey: string) => {\n    const translated = t(titleKey, language);\n    return translated !== titleKey ? translated : titleKey;\n  };\n\n  const getMainItems = () => {\n    if (isAdmin) return mainItems;\n    if (isWarehouse) return mainItems.filter(i => warehouseMainUrls.includes(i.url));\n    return mainItems.filter(i => i.url === \"/\" || i.url === \"/products\");\n  };\n\n  const getOperationItems = () => {\n    if (isAdmin) return operationItems;\n    if (isWarehouse) return operationItems.filter(i => warehouseOperationUrls.includes(i.url));\n    return [];\n  };\n\n  const visibleMainItems = getMainItems();\n  const visibleOperationItems = getOperationItems();\n\n  return (\n    <Sidebar side=\"right\">\n      <SidebarHeader className=\"p-4\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"flex h-9 w-9 items-center justify-center rounded-md bg-primary\">\n            <Package className=\"h-5 w-5 text-primary-foreground\" />\n          </div>\n          <div>\n            <h2 className=\"text-sm font-semibold\" data-testid=\"text-app-title\">\n              {isWarehouse && language === \"zh\" ? \"库存管理系统\" : \"نظام إدارة المخزون\"}\n            </h2>\n            <p className=\"text-xs text-muted-foreground\">\n              {isWarehouse && language === \"zh\" ? \"中国进口管理\" : \"إدارة الاستيراد من الصين\"}\n            </p>\n          </div>\n        </div>\n      </SidebarHeader>\n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupLabel>{t(\"sidebar.main\", language)}</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {visibleMainItems.map((item) => (\n                <SidebarMenuItem key={item.titleKey}>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === item.url}\n                    data-testid={`nav-${item.url.replace(\"/\", \"\") || \"dashboard\"}`}\n                  >\n                    <a href={item.url}>\n                      <item.icon className=\"h-4 w-4\" />\n                      <span>{resolveTitle(item.titleKey)}</span>\n                    </a>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n\n        {visibleOperationItems.length > 0 && (\n        <SidebarGroup>\n          <SidebarGroupLabel>{t(\"sidebar.operations\", language)}</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {visibleOperationItems.map((item) => (\n                <SidebarMenuItem key={item.titleKey}>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === item.url}\n                    data-testid={`nav-${item.url.replace(\"/\", \"\")}`}\n                  >\n                    <a href={item.url}>\n                      <item.icon className=\"h-4 w-4\" />\n                      <span>{resolveTitle(item.titleKey)}</span>\n                    </a>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n        )}\n\n        {isAdmin && (\n        <SidebarGroup>\n          <SidebarGroupLabel>المالية</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {financeItems.map((item) => (\n                <SidebarMenuItem key={item.titleKey}>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === item.url}\n                    data-testid={`nav-${item.url.replace(\"/\", \"\")}`}\n                  >\n                    <a href={item.url}>\n                      <item.icon className=\"h-4 w-4\" />\n                      <span>{resolveTitle(item.titleKey)}</span>\n                    </a>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n        )}\n\n        {isAdmin && (\n          <SidebarGroup>\n            <SidebarGroupLabel>الإدارة</SidebarGroupLabel>\n            <SidebarGroupContent>\n              <SidebarMenu>\n                <SidebarMenuItem>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === \"/users\"}\n                    data-testid=\"nav-users\"\n                  >\n                    <a href=\"/users\">\n                      <UserCog className=\"h-4 w-4\" />\n                      <span>إدارة المستخدمين</span>\n                    </a>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              </SidebarMenu>\n            </SidebarGroupContent>\n          </SidebarGroup>\n        )}\n      </SidebarContent>\n    </Sidebar>\n  );\n}\n","path":null,"size_bytes":7084,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"server/seed.ts":{"content":"import { db } from \"./db\";\nimport { categories, suppliers, warehouses, products, users } from \"@shared/schema\";\nimport { eq } from \"drizzle-orm\";\nimport bcrypt from \"bcryptjs\";\n\nexport async function seedDatabase() {\n  const existingUsers = await db.select().from(users);\n  if (existingUsers.length === 0) {\n    const hashedPassword = await bcrypt.hash(\"admin123\", 10);\n    await db.insert(users).values({\n      username: \"admin\",\n      password: hashedPassword,\n      displayName: \"المدير\",\n      role: \"admin\",\n    });\n    console.log(\"Admin user created (username: admin, password: admin123)\");\n  }\n\n  const existingCategories = await db.select().from(categories);\n  if (existingCategories.length > 0) return;\n\n  console.log(\"Seeding database...\");\n\n  await db.insert(categories).values([\n    { name: \"إلكترونيات\" },\n    { name: \"ملابس\" },\n    { name: \"أدوات منزلية\" },\n    { name: \"قطع غيار\" },\n    { name: \"ألعاب أطفال\" },\n  ]);\n\n  await db.insert(suppliers).values([\n    { name: \"شركة جوانزو للتجارة\", phone: \"+86 20 8888 1234\", address: \"جوانزو، الصين\" },\n    { name: \"مصنع شنزن للإلكترونيات\", phone: \"+86 755 2666 5678\", address: \"شنزن، الصين\" },\n    { name: \"شركة ييوو العالمية\", phone: \"+86 579 8523 9012\", address: \"ييوو، تشجيانغ، الصين\" },\n  ]);\n\n  await db.insert(warehouses).values([\n    { name: \"المخزن الرئيسي - جوانزو\" },\n    { name: \"مخزن شنزن\" },\n  ]);\n\n  const allCategories = await db.select().from(categories);\n  const elecId = allCategories.find(c => c.name === \"إلكترونيات\")?.id;\n  const clothId = allCategories.find(c => c.name === \"ملابس\")?.id;\n  const homeId = allCategories.find(c => c.name === \"أدوات منزلية\")?.id;\n  const partsId = allCategories.find(c => c.name === \"قطع غيار\")?.id;\n  const toysId = allCategories.find(c => c.name === \"ألعاب أطفال\")?.id;\n\n  await db.insert(products).values([\n    { name: \"شاحن لاسلكي 15W\", quantity: 500, categoryId: elecId!, status: \"purchase_order\" },\n    { name: \"سماعات بلوتوث TWS\", quantity: 300, categoryId: elecId!, status: \"purchase_order\" },\n    { name: \"كابل USB-C 1.5م\", quantity: 1000, categoryId: elecId!, status: \"purchase_order\" },\n    { name: \"قميص قطن رجالي\", quantity: 200, categoryId: clothId!, status: \"purchase_order\" },\n    { name: \"حقيبة يد نسائية\", quantity: 150, categoryId: clothId!, status: \"purchase_order\" },\n    { name: \"طقم أواني طهي\", quantity: 100, categoryId: homeId!, status: \"purchase_order\" },\n    { name: \"مكنسة كهربائية صغيرة\", quantity: 80, categoryId: homeId!, status: \"purchase_order\" },\n    { name: \"فلتر زيت محرك\", quantity: 400, categoryId: partsId!, status: \"purchase_order\" },\n    { name: \"لعبة تعليمية للأطفال\", quantity: 250, categoryId: toysId!, status: \"purchase_order\" },\n    { name: \"روبوت ذكي تعليمي\", quantity: 120, categoryId: toysId!, status: \"purchase_order\" },\n  ]);\n\n  console.log(\"Database seeded successfully!\");\n}\n","path":null,"size_bytes":3178,"size_tokens":null},"client/src/pages/suppliers.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Plus, Users, Phone, MapPin, Pencil, Trash2, Search } from \"lucide-react\";\nimport type { Supplier } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\nexport default function Suppliers() {\n  const { toast } = useToast();\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [selectedSupplier, setSelectedSupplier] = useState<Supplier | null>(null);\n  const [name, setName] = useState(\"\");\n  const [phone, setPhone] = useState(\"\");\n  const [address, setAddress] = useState(\"\");\n  const [editName, setEditName] = useState(\"\");\n  const [editPhone, setEditPhone] = useState(\"\");\n  const [editAddress, setEditAddress] = useState(\"\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  const { data: suppliers, isLoading } = useQuery<Supplier[]>({\n    queryKey: [\"/api/suppliers\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: { name: string; phone: string; address: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/suppliers\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\"] });\n      setDialogOpen(false);\n      setName(\"\");\n      setPhone(\"\");\n      setAddress(\"\");\n      toast({ title: \"تم إنشاء المورد بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: any }) => {\n      const res = await apiRequest(\"PATCH\", `/api/suppliers/${id}`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\"] });\n      setEditDialogOpen(false);\n      setSelectedSupplier(null);\n      toast({ title: \"تم تحديث المورد بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/suppliers/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\"] });\n      setDeleteDialogOpen(false);\n      setSelectedSupplier(null);\n      toast({ title: \"تم حذف المورد بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ في الحذف\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const handleCreate = () => {\n    if (!name.trim()) {\n      toast({ title: \"يرجى إدخال اسم المورد\", variant: \"destructive\" });\n      return;\n    }\n    createMutation.mutate({ name: name.trim(), phone, address });\n  };\n\n  const openEdit = (supplier: Supplier) => {\n    setSelectedSupplier(supplier);\n    setEditName(supplier.name);\n    setEditPhone(supplier.phone || \"\");\n    setEditAddress(supplier.address || \"\");\n    setEditDialogOpen(true);\n  };\n\n  const handleUpdate = () => {\n    if (!selectedSupplier || !editName.trim()) return;\n    updateMutation.mutate({\n      id: selectedSupplier.id,\n      data: { name: editName.trim(), phone: editPhone, address: editAddress },\n    });\n  };\n\n  const openDelete = (supplier: Supplier) => {\n    setSelectedSupplier(supplier);\n    setDeleteDialogOpen(true);\n  };\n\n  const filteredSuppliers = suppliers?.filter(s => {\n    if (!searchQuery.trim()) return true;\n    const q = searchQuery.toLowerCase();\n    return s.name.toLowerCase().includes(q) ||\n      (s.phone && s.phone.toLowerCase().includes(q)) ||\n      (s.address && s.address.toLowerCase().includes(q));\n  }) || [];\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-suppliers-title\">الموردين</h1>\n          <p className=\"text-muted-foreground\">إدارة قائمة الموردين</p>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-add-supplier\">\n              <Plus className=\"h-4 w-4\" />\n              إضافة مورد\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>إضافة مورد جديد</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4 pt-4\">\n              <div className=\"space-y-2\">\n                <Label>اسم المورد</Label>\n                <Input\n                  data-testid=\"input-supplier-name\"\n                  value={name}\n                  onChange={(e) => setName(e.target.value)}\n                  placeholder=\"أدخل اسم المورد\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>رقم الهاتف</Label>\n                <Input\n                  data-testid=\"input-supplier-phone\"\n                  value={phone}\n                  onChange={(e) => setPhone(e.target.value)}\n                  placeholder=\"رقم الهاتف\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>العنوان</Label>\n                <Input\n                  data-testid=\"input-supplier-address\"\n                  value={address}\n                  onChange={(e) => setAddress(e.target.value)}\n                  placeholder=\"العنوان\"\n                />\n              </div>\n              <Button\n                data-testid=\"button-submit-supplier\"\n                className=\"w-full\"\n                onClick={handleCreate}\n                disabled={createMutation.isPending}\n              >\n                {createMutation.isPending ? \"جاري الإنشاء...\" : \"إنشاء المورد\"}\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"relative max-w-sm\">\n        <Search className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n        <Input\n          data-testid=\"input-search-suppliers\"\n          className=\"pr-9\"\n          placeholder=\"البحث عن مورد...\"\n          value={searchQuery}\n          onChange={(e) => setSearchQuery(e.target.value)}\n        />\n      </div>\n\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {Array.from({ length: 3 }).map((_, i) => (\n            <Card key={i}>\n              <CardContent className=\"p-6\">\n                <Skeleton className=\"h-6 w-32 mb-3\" />\n                <Skeleton className=\"h-4 w-24 mb-2\" />\n                <Skeleton className=\"h-4 w-40\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : filteredSuppliers.length > 0 ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {filteredSuppliers.map((supplier) => (\n            <Card key={supplier.id} className=\"hover-elevate\" data-testid={`card-supplier-${supplier.id}`}>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-start gap-3\">\n                  <div className=\"flex h-10 w-10 items-center justify-center rounded-md bg-primary/10 shrink-0\">\n                    <Users className=\"h-5 w-5 text-primary\" />\n                  </div>\n                  <div className=\"min-w-0 flex-1\">\n                    <h3 className=\"font-semibold text-base truncate\">{supplier.name}</h3>\n                    {supplier.phone && (\n                      <div className=\"flex items-center gap-1.5 text-sm text-muted-foreground mt-1\">\n                        <Phone className=\"h-3.5 w-3.5 shrink-0\" />\n                        <span dir=\"ltr\">{supplier.phone}</span>\n                      </div>\n                    )}\n                    {supplier.address && (\n                      <div className=\"flex items-center gap-1.5 text-sm text-muted-foreground mt-1\">\n                        <MapPin className=\"h-3.5 w-3.5 shrink-0\" />\n                        <span className=\"truncate\">{supplier.address}</span>\n                      </div>\n                    )}\n                  </div>\n                  <div className=\"flex gap-1 shrink-0\">\n                    <Button\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      onClick={() => openEdit(supplier)}\n                      data-testid={`button-edit-supplier-${supplier.id}`}\n                    >\n                      <Pencil className=\"h-4 w-4\" />\n                    </Button>\n                    <Button\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      onClick={() => openDelete(supplier)}\n                      data-testid={`button-delete-supplier-${supplier.id}`}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n            <Users className=\"h-12 w-12 text-muted-foreground mb-3\" />\n            <p className=\"text-muted-foreground\">{searchQuery ? \"لا توجد نتائج للبحث\" : \"لا يوجد موردين\"}</p>\n            {!searchQuery && <p className=\"text-sm text-muted-foreground\">أضف موردًا جديدًا للبدء</p>}\n          </CardContent>\n        </Card>\n      )}\n\n      <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>تعديل المورد</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"space-y-2\">\n              <Label>اسم المورد</Label>\n              <Input\n                data-testid=\"input-edit-supplier-name\"\n                value={editName}\n                onChange={(e) => setEditName(e.target.value)}\n                placeholder=\"اسم المورد\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>رقم الهاتف</Label>\n              <Input\n                data-testid=\"input-edit-supplier-phone\"\n                value={editPhone}\n                onChange={(e) => setEditPhone(e.target.value)}\n                placeholder=\"رقم الهاتف\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>العنوان</Label>\n              <Input\n                data-testid=\"input-edit-supplier-address\"\n                value={editAddress}\n                onChange={(e) => setEditAddress(e.target.value)}\n                placeholder=\"العنوان\"\n              />\n            </div>\n            <Button\n              data-testid=\"button-submit-edit-supplier\"\n              className=\"w-full\"\n              onClick={handleUpdate}\n              disabled={updateMutation.isPending}\n            >\n              {updateMutation.isPending ? \"جاري التحديث...\" : \"حفظ التعديلات\"}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>حذف المورد</AlertDialogTitle>\n            <AlertDialogDescription>\n              هل أنت متأكد من حذف المورد \"{selectedSupplier?.name}\"؟ لا يمكن التراجع عن هذا الإجراء.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter className=\"flex gap-2\">\n            <AlertDialogCancel data-testid=\"button-cancel-delete\">إلغاء</AlertDialogCancel>\n            <AlertDialogAction\n              data-testid=\"button-confirm-delete-supplier\"\n              onClick={() => selectedSupplier && deleteMutation.mutate(selectedSupplier.id)}\n              className=\"bg-destructive text-destructive-foreground\"\n            >\n              {deleteMutation.isPending ? \"جاري الحذف...\" : \"حذف\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":13257,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, real, timestamp, pgEnum, boolean } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const userRoleEnum = pgEnum(\"user_role\", [\"admin\", \"user\", \"warehouse\"]);\n\nexport const users = pgTable(\"users\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  displayName: text(\"display_name\").notNull(),\n  role: userRoleEnum(\"role\").notNull().default(\"user\"),\n  active: boolean(\"active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const productStatusEnum = pgEnum(\"product_status\", [\n  \"purchase_order\",\n  \"ordered\",\n  \"received\",\n  \"semi_manufactured\",\n  \"shipping\",\n  \"arrived\",\n]);\n\nexport const currencyEnum = pgEnum(\"currency\", [\"CNY\", \"USD\"]);\n\nexport const categories = pgTable(\"categories\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  name: text(\"name\").notNull(),\n});\n\nexport const suppliers = pgTable(\"suppliers\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  name: text(\"name\").notNull(),\n  phone: text(\"phone\"),\n  address: text(\"address\"),\n});\n\nexport const shippingCompanies = pgTable(\"shipping_companies\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  name: text(\"name\").notNull(),\n  phone: text(\"phone\"),\n  address: text(\"address\"),\n});\n\nexport const warehouses = pgTable(\"warehouses\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  name: text(\"name\").notNull(),\n});\n\nexport const products = pgTable(\"products\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  name: text(\"name\").notNull(),\n  quantity: integer(\"quantity\").notNull().default(0),\n  categoryId: integer(\"category_id\").references(() => categories.id),\n  status: productStatusEnum(\"status\").notNull().default(\"purchase_order\"),\n  statusChangedAt: timestamp(\"status_changed_at\").defaultNow(),\n});\n\nexport const productParts = pgTable(\"product_parts\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  productId: integer(\"product_id\").references(() => products.id).notNull(),\n  name: text(\"name\").notNull(),\n  quantity: integer(\"quantity\").notNull().default(0),\n  length: real(\"length\"),\n  width: real(\"width\"),\n  height: real(\"height\"),\n  weight: real(\"weight\"),\n  piecesPerCarton: integer(\"pieces_per_carton\"),\n});\n\nexport const orders = pgTable(\"orders\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  supplierId: integer(\"supplier_id\").references(() => suppliers.id).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  confirmed: text(\"confirmed\").notNull().default(\"pending\"),\n});\n\nexport const orderItems = pgTable(\"order_items\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  orderId: integer(\"order_id\").references(() => orders.id).notNull(),\n  productId: integer(\"product_id\").references(() => products.id).notNull(),\n  quantityRequested: integer(\"quantity_requested\").notNull(),\n  quantityOrdered: integer(\"quantity_ordered\").notNull(),\n  price: real(\"price\").notNull().default(0),\n  currency: currencyEnum(\"currency\").notNull().default(\"CNY\"),\n});\n\nexport const deliveries = pgTable(\"deliveries\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  orderId: integer(\"order_id\").references(() => orders.id),\n  supplierId: integer(\"supplier_id\").references(() => suppliers.id).notNull(),\n  warehouseId: integer(\"warehouse_id\").references(() => warehouses.id).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const deliveryItems = pgTable(\"delivery_items\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  deliveryId: integer(\"delivery_id\").references(() => deliveries.id).notNull(),\n  productId: integer(\"product_id\").references(() => products.id).notNull(),\n  quantity: integer(\"quantity\").notNull(),\n  price: real(\"price\").notNull().default(0),\n  currency: currencyEnum(\"currency\").notNull().default(\"CNY\"),\n  length: real(\"length\"),\n  width: real(\"width\"),\n  height: real(\"height\"),\n  weight: real(\"weight\"),\n  piecesPerCarton: integer(\"pieces_per_carton\"),\n});\n\nexport const containers = pgTable(\"containers\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  invoiceNumber: text(\"invoice_number\"),\n  containerNumber: text(\"container_number\"),\n  shippingCompany: text(\"shipping_company\"),\n  shippingCompanyId: integer(\"shipping_company_id\").references(() => shippingCompanies.id),\n  priceCNY: real(\"price_cny\").default(0),\n  priceUSD: real(\"price_usd\").default(0),\n  warehouseId: integer(\"warehouse_id\").references(() => warehouses.id),\n  status: text(\"status\").notNull().default(\"shipping\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const containerItems = pgTable(\"container_items\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  containerId: integer(\"container_id\").references(() => containers.id).notNull(),\n  productId: integer(\"product_id\").references(() => products.id).notNull(),\n  quantity: integer(\"quantity\").notNull(),\n});\n\nexport const userCategories = pgTable(\"user_categories\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  categoryId: integer(\"category_id\").references(() => categories.id).notNull(),\n});\n\nexport const payments = pgTable(\"payments\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  supplierId: integer(\"supplier_id\").references(() => suppliers.id).notNull(),\n  amount: real(\"amount\").notNull(),\n  currency: currencyEnum(\"currency\").notNull().default(\"CNY\"),\n  note: text(\"note\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const shippingPayments = pgTable(\"shipping_payments\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  shippingCompanyId: integer(\"shipping_company_id\").references(() => shippingCompanies.id).notNull(),\n  amount: real(\"amount\").notNull(),\n  currency: currencyEnum(\"currency\").notNull().default(\"CNY\"),\n  note: text(\"note\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const expenses = pgTable(\"expenses\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  title: text(\"title\").notNull(),\n  amount: real(\"amount\").notNull(),\n  currency: currencyEnum(\"currency\").notNull().default(\"CNY\"),\n  description: text(\"description\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const cashboxTransactionTypeEnum = pgEnum(\"cashbox_transaction_type\", [\"income\", \"expense\"]);\nexport const cashboxCategoryEnum = pgEnum(\"cashbox_category\", [\"supplier\", \"shipping\", \"other\", \"expense\"]);\n\nexport const cashboxTransactions = pgTable(\"cashbox_transactions\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  type: cashboxTransactionTypeEnum(\"type\").notNull(),\n  category: cashboxCategoryEnum(\"category\").notNull().default(\"other\"),\n  amount: real(\"amount\").notNull(),\n  currency: currencyEnum(\"currency\").notNull().default(\"CNY\"),\n  supplierId: integer(\"supplier_id\").references(() => suppliers.id),\n  shippingCompanyId: integer(\"shipping_company_id\").references(() => shippingCompanies.id),\n  paymentId: integer(\"payment_id\").references(() => payments.id),\n  shippingPaymentId: integer(\"shipping_payment_id\").references(() => shippingPayments.id),\n  expenseId: integer(\"expense_id\").references(() => expenses.id),\n  description: text(\"description\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const containerDocuments = pgTable(\"container_documents\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  containerId: integer(\"container_id\").references(() => containers.id).notNull(),\n  invoiceNumber: text(\"invoice_number\"),\n  invoiceDate: timestamp(\"invoice_date\"),\n  shippingBill: boolean(\"shipping_bill\").default(false),\n  originCertificate: boolean(\"origin_certificate\").default(false),\n  conformityCertificate: boolean(\"conformity_certificate\").default(false),\n  invoice: text(\"invoice\"),\n  moneyArrival: real(\"money_arrival\"),\n  moneyArrivalCurrency: currencyEnum(\"money_arrival_currency\").default(\"CNY\"),\n  cashboxTransactionId: integer(\"cashbox_transaction_id\"),\n  groupInvoiceId: integer(\"group_invoice_id\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertContainerDocumentSchema = createInsertSchema(containerDocuments).omit({ id: true, createdAt: true });\n\nexport const insertProductPartSchema = createInsertSchema(productParts).omit({ id: true });\nexport const insertCategorySchema = createInsertSchema(categories).omit({ id: true });\nexport const insertSupplierSchema = createInsertSchema(suppliers).omit({ id: true });\nexport const insertShippingCompanySchema = createInsertSchema(shippingCompanies).omit({ id: true });\nexport const insertWarehouseSchema = createInsertSchema(warehouses).omit({ id: true });\nexport const insertProductSchema = createInsertSchema(products).omit({ id: true, statusChangedAt: true });\nexport const insertOrderSchema = createInsertSchema(orders).omit({ id: true, createdAt: true });\nexport const insertOrderItemSchema = createInsertSchema(orderItems).omit({ id: true });\nexport const insertDeliverySchema = createInsertSchema(deliveries).omit({ id: true, createdAt: true });\nexport const insertDeliveryItemSchema = createInsertSchema(deliveryItems).omit({ id: true });\nexport const insertContainerSchema = createInsertSchema(containers).omit({ id: true, createdAt: true });\nexport const insertContainerItemSchema = createInsertSchema(containerItems).omit({ id: true });\nexport const insertPaymentSchema = createInsertSchema(payments).omit({ id: true, createdAt: true });\nexport const insertShippingPaymentSchema = createInsertSchema(shippingPayments).omit({ id: true, createdAt: true });\nexport const insertExpenseSchema = createInsertSchema(expenses).omit({ id: true, createdAt: true });\n\nexport type InsertCategory = z.infer<typeof insertCategorySchema>;\nexport type Category = typeof categories.$inferSelect;\nexport type InsertSupplier = z.infer<typeof insertSupplierSchema>;\nexport type Supplier = typeof suppliers.$inferSelect;\nexport type InsertShippingCompany = z.infer<typeof insertShippingCompanySchema>;\nexport type ShippingCompany = typeof shippingCompanies.$inferSelect;\nexport type InsertWarehouse = z.infer<typeof insertWarehouseSchema>;\nexport type Warehouse = typeof warehouses.$inferSelect;\nexport type InsertProduct = z.infer<typeof insertProductSchema>;\nexport type Product = typeof products.$inferSelect;\nexport type InsertOrder = z.infer<typeof insertOrderSchema>;\nexport type Order = typeof orders.$inferSelect;\nexport type InsertOrderItem = z.infer<typeof insertOrderItemSchema>;\nexport type OrderItem = typeof orderItems.$inferSelect;\nexport type InsertDelivery = z.infer<typeof insertDeliverySchema>;\nexport type Delivery = typeof deliveries.$inferSelect;\nexport type InsertDeliveryItem = z.infer<typeof insertDeliveryItemSchema>;\nexport type DeliveryItem = typeof deliveryItems.$inferSelect;\nexport type InsertContainer = z.infer<typeof insertContainerSchema>;\nexport type Container = typeof containers.$inferSelect;\nexport type InsertContainerItem = z.infer<typeof insertContainerItemSchema>;\nexport type ContainerItem = typeof containerItems.$inferSelect;\nexport type InsertPayment = z.infer<typeof insertPaymentSchema>;\nexport type Payment = typeof payments.$inferSelect;\nexport type InsertShippingPayment = z.infer<typeof insertShippingPaymentSchema>;\nexport type ShippingPayment = typeof shippingPayments.$inferSelect;\n\nexport type InsertProductPart = z.infer<typeof insertProductPartSchema>;\nexport type ProductPart = typeof productParts.$inferSelect;\n\nexport type InsertExpense = z.infer<typeof insertExpenseSchema>;\nexport type Expense = typeof expenses.$inferSelect;\n\nexport const insertCashboxTransactionSchema = createInsertSchema(cashboxTransactions).omit({ id: true, createdAt: true });\nexport type InsertCashboxTransaction = z.infer<typeof insertCashboxTransactionSchema>;\nexport type CashboxTransaction = typeof cashboxTransactions.$inferSelect;\n\nexport const insertUserCategorySchema = createInsertSchema(userCategories).omit({ id: true });\nexport type InsertUserCategory = z.infer<typeof insertUserCategorySchema>;\nexport type UserCategory = typeof userCategories.$inferSelect;\n\nexport const insertUserSchema = createInsertSchema(users).omit({ id: true, createdAt: true, active: true });\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\nexport type InsertContainerDocument = z.infer<typeof insertContainerDocumentSchema>;\nexport type ContainerDocument = typeof containerDocuments.$inferSelect;\n","path":null,"size_bytes":12786,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst pool = new pg.Pool({\n  connectionString: process.env.DATABASE_URL,\n});\n\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":240,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport connectPgSimple from \"connect-pg-simple\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\nimport { seedDatabase } from \"./seed\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId: number;\n    role: string;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nconst PgSession = connectPgSimple(session);\napp.use(\n  session({\n    store: new PgSession({\n      conString: process.env.DATABASE_URL,\n      createTableIfMissing: true,\n    }),\n    secret: process.env.SESSION_SECRET || \"inventory-secret-key\",\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      maxAge: 30 * 24 * 60 * 60 * 1000,\n      httpOnly: true,\n      secure: false,\n    },\n  })\n);\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await seedDatabase().catch(console.error);\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    console.error(\"Internal Server Error:\", err);\n\n    if (res.headersSent) {\n      return next(err);\n    }\n\n    return res.status(status).json({ message });\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":3343,"size_tokens":null},"client/src/pages/arrivals.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Anchor, Ship, CheckCircle } from \"lucide-react\";\nimport type { Container } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nexport default function Arrivals() {\n  const { toast } = useToast();\n\n  const { data: containers, isLoading } = useQuery<Container[]>({\n    queryKey: [\"/api/containers\"],\n  });\n\n  const arrivalMutation = useMutation({\n    mutationFn: async (containerId: number) => {\n      const res = await apiRequest(\"PATCH\", `/api/containers/${containerId}/arrive`, {});\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/containers\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      toast({ title: \"تم تأكيد وصول الحاوية\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const shippingContainers = containers?.filter(c => c.status === \"shipping\") || [];\n  const arrivedContainers = containers?.filter(c => c.status === \"arrived\") || [];\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold\" data-testid=\"text-arrivals-title\">وصول الحاويات</h1>\n        <p className=\"text-muted-foreground\">تتبع وصول الحاويات إلى الميناء</p>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h2 className=\"text-lg font-semibold flex items-center gap-2\">\n          <Ship className=\"h-5 w-5\" />\n          حاويات في الطريق ({shippingContainers.length})\n        </h2>\n\n        {isLoading ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            {Array.from({ length: 2 }).map((_, i) => (\n              <Card key={i}><CardContent className=\"p-6\"><Skeleton className=\"h-20 w-full\" /></CardContent></Card>\n            ))}\n          </div>\n        ) : shippingContainers.length > 0 ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            {shippingContainers.map((c) => (\n              <Card key={c.id} data-testid={`card-container-${c.id}`}>\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                    <CardTitle className=\"text-base\">حاوية #{c.containerNumber || c.id}</CardTitle>\n                    <Badge className=\"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200\">في الشحن</Badge>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-2\">\n                  {c.invoiceNumber && <p className=\"text-sm\"><span className=\"text-muted-foreground\">فاتورة:</span> {c.invoiceNumber}</p>}\n                  {c.shippingCompany && <p className=\"text-sm\"><span className=\"text-muted-foreground\">شركة الشحن:</span> {c.shippingCompany}</p>}\n                  <p className=\"text-sm text-muted-foreground\">\n                    {c.createdAt ? new Date(c.createdAt).toLocaleDateString(\"fr-FR\") : \"\"}\n                  </p>\n                  <Button\n                    className=\"w-full mt-2\"\n                    onClick={() => arrivalMutation.mutate(c.id)}\n                    disabled={arrivalMutation.isPending}\n                    data-testid={`button-arrive-${c.id}`}\n                  >\n                    <Anchor className=\"h-4 w-4\" />\n                    تأكيد الوصول\n                  </Button>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : (\n          <Card>\n            <CardContent className=\"flex flex-col items-center justify-center py-8 text-center\">\n              <Ship className=\"h-10 w-10 text-muted-foreground mb-2\" />\n              <p className=\"text-muted-foreground\">لا توجد حاويات في الطريق</p>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n\n      <div className=\"space-y-4\">\n        <h2 className=\"text-lg font-semibold flex items-center gap-2\">\n          <CheckCircle className=\"h-5 w-5 text-green-600\" />\n          حاويات وصلت ({arrivedContainers.length})\n        </h2>\n\n        {arrivedContainers.length > 0 ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            {arrivedContainers.map((c) => (\n              <Card key={c.id} data-testid={`card-arrived-${c.id}`}>\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                    <CardTitle className=\"text-base\">حاوية #{c.containerNumber || c.id}</CardTitle>\n                    <Badge className=\"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200\">وصلت</Badge>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-1\">\n                  {c.invoiceNumber && <p className=\"text-sm\"><span className=\"text-muted-foreground\">فاتورة:</span> {c.invoiceNumber}</p>}\n                  {c.shippingCompany && <p className=\"text-sm\"><span className=\"text-muted-foreground\">شركة الشحن:</span> {c.shippingCompany}</p>}\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : (\n          <Card>\n            <CardContent className=\"flex flex-col items-center justify-center py-8 text-center\">\n              <Anchor className=\"h-10 w-10 text-muted-foreground mb-2\" />\n              <p className=\"text-muted-foreground\">لا توجد حاويات وصلت بعد</p>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":5991,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/pages/deliveries.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Truck, Printer, Layers, Plus, Trash2, ChevronDown, ChevronUp } from \"lucide-react\";\nimport { useAuth } from \"@/App\";\nimport { useLanguage } from \"@/lib/language-context\";\nimport { t } from \"@/lib/translations\";\nimport type { Supplier, Warehouse as WarehouseType } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\n\ninterface PartDraft {\n  id?: number;\n  name: string;\n  quantity: number;\n  length: number | null;\n  width: number | null;\n  height: number | null;\n  weight: number | null;\n  piecesPerCarton: number | null;\n}\n\ninterface DeliveryItemDraft {\n  productId: number;\n  productName: string;\n  productStatus: string;\n  selected: boolean;\n  quantity: number;\n  price: number;\n  currency: \"CNY\" | \"USD\";\n  length: number;\n  width: number;\n  height: number;\n  weight: number;\n  piecesPerCarton: number;\n  parts: PartDraft[];\n}\n\nexport default function Deliveries() {\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const { language } = useLanguage();\n  const hidePrice = user?.role === \"warehouse\";\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [supplierId, setSupplierId] = useState(\"\");\n  const [warehouseId, setWarehouseId] = useState(\"\");\n  const [items, setItems] = useState<DeliveryItemDraft[]>([]);\n  const [step, setStep] = useState<\"supplier\" | \"items\" | \"summary\">(\"supplier\");\n  const [expandedParts, setExpandedParts] = useState<number[]>([]);\n\n  const { data: suppliers } = useQuery<Supplier[]>({\n    queryKey: [\"/api/suppliers\"],\n  });\n  const { data: warehouses } = useQuery<WarehouseType[]>({\n    queryKey: [\"/api/warehouses\"],\n  });\n\n  const fetchSupplierOrdersMutation = useMutation({\n    mutationFn: async (sId: string) => {\n      const res = await fetch(`/api/suppliers/${sId}/ordered-items`, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch\");\n      return res.json();\n    },\n    onSuccess: (data: any[]) => {\n      const draftItems: DeliveryItemDraft[] = data.map((item: any) => ({\n        productId: item.productId,\n        productName: item.productName,\n        productStatus: item.productStatus || \"ordered\",\n        selected: true,\n        quantity: item.quantityOrdered,\n        price: item.price,\n        currency: item.currency,\n        length: 0,\n        width: 0,\n        height: 0,\n        weight: 0,\n        piecesPerCarton: 0,\n        parts: (item.parts || []).map((p: any) => ({\n          id: p.id,\n          name: p.name,\n          quantity: p.quantity || 0,\n          length: p.length,\n          width: p.width,\n          height: p.height,\n          weight: p.weight,\n          piecesPerCarton: p.piecesPerCarton,\n        })),\n      }));\n      setItems(draftItems);\n      setExpandedParts([]);\n      if (warehouses && warehouses.length > 0 && !warehouseId) {\n        setWarehouseId(String(warehouses[0].id));\n      }\n      setStep(\"items\");\n    },\n    onError: () => {\n      toast({ title: \"لا توجد بضائع مطلوبة لهذا المورد\", variant: \"destructive\" });\n    },\n  });\n\n  const confirmDeliveryMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await apiRequest(\"POST\", \"/api/deliveries\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/deliveries\"] });\n      setDialogOpen(false);\n      resetForm();\n      toast({ title: \"تم تأكيد التسليم بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const resetForm = () => {\n    setSupplierId(\"\");\n    setWarehouseId(\"\");\n    setItems([]);\n    setStep(\"supplier\");\n    setExpandedParts([]);\n  };\n\n  const handleSelectSupplier = () => {\n    if (!supplierId) {\n      toast({ title: \"يرجى اختيار المورد\", variant: \"destructive\" });\n      return;\n    }\n    fetchSupplierOrdersMutation.mutate(supplierId);\n  };\n\n  const updateItem = (idx: number, field: string, value: any) => {\n    setItems(prev => prev.map((item, i) =>\n      i === idx ? { ...item, [field]: value } : item\n    ));\n  };\n\n  const toggleSelect = (idx: number) => {\n    setItems(prev => prev.map((item, i) =>\n      i === idx ? { ...item, selected: !item.selected } : item\n    ));\n  };\n\n  const toggleExpandParts = (productId: number) => {\n    setExpandedParts(prev =>\n      prev.includes(productId) ? prev.filter(id => id !== productId) : [...prev, productId]\n    );\n  };\n\n  const updatePart = (itemIdx: number, partIdx: number, field: string, value: any) => {\n    setItems(prev => prev.map((item, i) => {\n      if (i !== itemIdx) return item;\n      const newParts = [...item.parts];\n      newParts[partIdx] = { ...newParts[partIdx], [field]: value };\n      return { ...item, parts: newParts };\n    }));\n  };\n\n  const addPart = (itemIdx: number) => {\n    setItems(prev => prev.map((item, i) => {\n      if (i !== itemIdx) return item;\n      return {\n        ...item,\n        parts: [...item.parts, { name: \"\", quantity: 0, length: null, width: null, height: null, weight: null, piecesPerCarton: null }],\n      };\n    }));\n  };\n\n  const removePart = (itemIdx: number, partIdx: number) => {\n    setItems(prev => prev.map((item, i) => {\n      if (i !== itemIdx) return item;\n      return { ...item, parts: item.parts.filter((_, pi) => pi !== partIdx) };\n    }));\n  };\n\n  const handleConfirm = () => {\n    const selected = items.filter(i => i.selected);\n    if (selected.length === 0) {\n      toast({ title: \"يرجى اختيار بضاعة واحدة على الأقل\", variant: \"destructive\" });\n      return;\n    }\n    setStep(\"summary\");\n  };\n\n  const handleSubmit = () => {\n    const selected = items.filter(i => i.selected);\n    confirmDeliveryMutation.mutate({\n      supplierId: parseInt(supplierId),\n      warehouseId: parseInt(warehouseId),\n      items: selected.map(i => ({\n        productId: i.productId,\n        quantity: i.quantity,\n        price: i.price,\n        currency: i.currency,\n        length: i.length || null,\n        width: i.width || null,\n        height: i.height || null,\n        weight: i.weight || null,\n        piecesPerCarton: i.piecesPerCarton || null,\n        parts: i.parts,\n      })),\n    });\n  };\n\n  const selectedItems = items.filter(i => i.selected);\n  const totalCNY = selectedItems.filter(i => i.currency === \"CNY\").reduce((s, i) => s + (i.price * i.quantity), 0);\n  const totalUSD = selectedItems.filter(i => i.currency === \"USD\").reduce((s, i) => s + (i.price * i.quantity), 0);\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-deliveries-title\">{t(\"deliveries.title\", language)}</h1>\n          <p className=\"text-muted-foreground\">{t(\"deliveries.subtitle\", language)}</p>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={(open) => { setDialogOpen(open); if (!open) resetForm(); }}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-receive-delivery\">\n              <Truck className=\"h-4 w-4\" />\n              {t(\"deliveries.newDelivery\", language)}\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>\n                {step === \"supplier\" && \"اختيار المورد\"}\n                {step === \"items\" && \"تفاصيل البضاعة\"}\n                {step === \"summary\" && \"ملخص التسليم\"}\n              </DialogTitle>\n            </DialogHeader>\n\n            {step === \"supplier\" && (\n              <div className=\"space-y-4 pt-4\">\n                <div className=\"space-y-2\">\n                  <Label>المورد</Label>\n                  <Select value={supplierId} onValueChange={setSupplierId}>\n                    <SelectTrigger data-testid=\"select-delivery-supplier\">\n                      <SelectValue placeholder={t(\"deliveries.selectSupplier\", language)} />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {suppliers?.map((s) => (\n                        <SelectItem key={s.id} value={String(s.id)}>{s.name}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <Button\n                  data-testid=\"button-fetch-orders\"\n                  className=\"w-full\"\n                  onClick={handleSelectSupplier}\n                  disabled={fetchSupplierOrdersMutation.isPending}\n                >\n                  {fetchSupplierOrdersMutation.isPending ? \"جاري البحث...\" : \"عرض البضاعة\"}\n                </Button>\n              </div>\n            )}\n\n            {step === \"items\" && (\n              <div className=\"space-y-4 pt-4\">\n                <div className=\"space-y-2\">\n                  <Label>المخزن</Label>\n                  <Select value={warehouseId} onValueChange={setWarehouseId}>\n                    <SelectTrigger data-testid=\"select-delivery-warehouse\">\n                      <SelectValue placeholder={t(\"deliveries.selectWarehouse\", language)} />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {warehouses?.map((wh) => (\n                        <SelectItem key={wh.id} value={String(wh.id)}>{wh.name}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                {items.length === 0 ? (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    لا توجد بضائع مطلوبة\n                  </div>\n                ) : (\n                  <div className=\"space-y-2\">\n                    <div className=\"overflow-x-auto\">\n                      <table className=\"w-full text-xs border-collapse\">\n                        <thead>\n                          <tr className=\"border-b text-muted-foreground\">\n                            <th className=\"p-1 text-right\"></th>\n                            <th className=\"p-1 text-right\">{t(\"common.product\", language)}</th>\n                            <th className=\"p-1 text-center\">{t(\"common.quantity\", language)}</th>\n                            {!hidePrice && <th className=\"p-1 text-center\">السعر</th>}\n                            {!hidePrice && <th className=\"p-1 text-center\">العملة</th>}\n                            <th className=\"p-1 text-center\">{t(\"deliveries.length\", language)}</th>\n                            <th className=\"p-1 text-center\">{t(\"deliveries.width\", language)}</th>\n                            <th className=\"p-1 text-center\">{t(\"deliveries.height\", language)}</th>\n                            <th className=\"p-1 text-center\">{t(\"deliveries.weight\", language)}</th>\n                            <th className=\"p-1 text-center\">{t(\"deliveries.pcsCarton\", language)}</th>\n                            <th className=\"p-1 text-center\"></th>\n                          </tr>\n                        </thead>\n                        <tbody>\n                          {items.map((item, idx) => (\n                            <>\n                              <tr key={item.productId} className={`border-b ${!item.selected ? \"opacity-40\" : \"\"}`}>\n                                <td className=\"p-1\">\n                                  <Checkbox\n                                    checked={item.selected}\n                                    onCheckedChange={() => toggleSelect(idx)}\n                                    data-testid={`checkbox-item-${item.productId}`}\n                                  />\n                                </td>\n                                <td className=\"p-1 font-medium whitespace-nowrap\">\n                                  <div className=\"flex items-center gap-1\">\n                                    {item.productName}\n                                    {item.productStatus === \"semi_manufactured\" && (\n                                      <Badge variant=\"secondary\" className=\"bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-200 text-[10px] px-1\">\n                                        مركب\n                                      </Badge>\n                                    )}\n                                  </div>\n                                </td>\n                                <td className=\"p-1\">\n                                  <input type=\"number\" className=\"w-12 border rounded px-1 py-0.5 text-center text-xs bg-background\" value={item.quantity}\n                                    onChange={(e) => updateItem(idx, \"quantity\", parseInt(e.target.value) || 0)}\n                                    disabled={!item.selected} data-testid={`input-quantity-${item.productId}`} />\n                                </td>\n                                {!hidePrice && <td className=\"p-1\">\n                                  <input type=\"number\" step=\"0.01\" className=\"w-14 border rounded px-1 py-0.5 text-center text-xs bg-background\" value={item.price}\n                                    onChange={(e) => updateItem(idx, \"price\", parseFloat(e.target.value) || 0)}\n                                    disabled={!item.selected} data-testid={`input-price-${item.productId}`} />\n                                </td>}\n                                {!hidePrice && <td className=\"p-1 text-center\">{item.currency === \"CNY\" ? \"¥\" : \"$\"}</td>}\n                                <td className=\"p-1\">\n                                  <input type=\"number\" step=\"0.1\" className=\"w-12 border rounded px-1 py-0.5 text-center text-xs bg-background\" value={item.length || \"\"}\n                                    onChange={(e) => updateItem(idx, \"length\", parseFloat(e.target.value) || 0)}\n                                    disabled={!item.selected} data-testid={`input-length-${item.productId}`} />\n                                </td>\n                                <td className=\"p-1\">\n                                  <input type=\"number\" step=\"0.1\" className=\"w-12 border rounded px-1 py-0.5 text-center text-xs bg-background\" value={item.width || \"\"}\n                                    onChange={(e) => updateItem(idx, \"width\", parseFloat(e.target.value) || 0)}\n                                    disabled={!item.selected} data-testid={`input-width-${item.productId}`} />\n                                </td>\n                                <td className=\"p-1\">\n                                  <input type=\"number\" step=\"0.1\" className=\"w-12 border rounded px-1 py-0.5 text-center text-xs bg-background\" value={item.height || \"\"}\n                                    onChange={(e) => updateItem(idx, \"height\", parseFloat(e.target.value) || 0)}\n                                    disabled={!item.selected} data-testid={`input-height-${item.productId}`} />\n                                </td>\n                                <td className=\"p-1\">\n                                  <input type=\"number\" step=\"0.1\" className=\"w-12 border rounded px-1 py-0.5 text-center text-xs bg-background\" value={item.weight || \"\"}\n                                    onChange={(e) => updateItem(idx, \"weight\", parseFloat(e.target.value) || 0)}\n                                    disabled={!item.selected} data-testid={`input-weight-${item.productId}`} />\n                                </td>\n                                <td className=\"p-1\">\n                                  <input type=\"number\" className=\"w-12 border rounded px-1 py-0.5 text-center text-xs bg-background\" value={item.piecesPerCarton || \"\"}\n                                    onChange={(e) => updateItem(idx, \"piecesPerCarton\", parseInt(e.target.value) || 0)}\n                                    disabled={!item.selected} data-testid={`input-ppc-${item.productId}`} />\n                                </td>\n                                <td className=\"p-1\">\n                                  {item.selected && item.productStatus === \"semi_manufactured\" && (\n                                    <Button size=\"icon\" variant=\"ghost\" onClick={() => toggleExpandParts(item.productId)}\n                                      data-testid={`button-toggle-parts-${item.productId}`}>\n                                      <Layers className=\"h-4 w-4 text-cyan-600\" />\n                                    </Button>\n                                  )}\n                                </td>\n                              </tr>\n                              {item.selected && item.productStatus === \"semi_manufactured\" && expandedParts.includes(item.productId) && (\n                                <tr key={`parts-${item.productId}`}>\n                                  <td colSpan={11} className=\"p-2\">\n                                    <div className=\"border rounded-md p-3 space-y-2 bg-muted/30\">\n                                      <div className=\"flex items-center justify-between gap-2\">\n                                        <h4 className=\"text-sm font-semibold flex items-center gap-1\">\n                                          <Layers className=\"h-3 w-3 text-cyan-600\" />\n                                          {t(\"deliveries.parts\", language)}: {item.productName}\n                                        </h4>\n                                        <Button size=\"sm\" variant=\"outline\" onClick={() => addPart(idx)} data-testid={`button-add-part-${item.productId}`}>\n                                          <Plus className=\"h-3 w-3 ml-1\" />\n                                          إضافة جزء\n                                        </Button>\n                                      </div>\n                                      {item.parts.length === 0 ? (\n                                        <p className=\"text-sm text-muted-foreground text-center py-2\">لا توجد أجزاء - اضغط إضافة جزء</p>\n                                      ) : (\n                                        <table className=\"w-full text-xs border-collapse\">\n                                          <thead>\n                                            <tr className=\"border-b text-muted-foreground\">\n                                              <th className=\"p-1 text-right\">الاسم</th>\n                                              <th className=\"p-1 text-center\">{t(\"common.quantity\", language)}</th>\n                                              <th className=\"p-1 text-center\">{t(\"deliveries.length\", language)}</th>\n                                              <th className=\"p-1 text-center\">{t(\"deliveries.width\", language)}</th>\n                                              <th className=\"p-1 text-center\">{t(\"deliveries.height\", language)}</th>\n                                              <th className=\"p-1 text-center\">{t(\"deliveries.weight\", language)}</th>\n                                              <th className=\"p-1 text-center\">{t(\"deliveries.pcsCarton\", language)}</th>\n                                              <th className=\"p-1\"></th>\n                                            </tr>\n                                          </thead>\n                                          <tbody>\n                                            {item.parts.map((part, pi) => (\n                                              <tr key={pi} className=\"border-b last:border-0\">\n                                                <td className=\"p-1\">\n                                                  <input value={part.name} onChange={(e) => updatePart(idx, pi, \"name\", e.target.value)}\n                                                    className=\"w-20 border rounded px-1 py-0.5 text-xs bg-background\" data-testid={`input-part-name-${item.productId}-${pi}`} />\n                                                </td>\n                                                <td className=\"p-1\">\n                                                  <input type=\"number\" value={part.quantity || \"\"} onChange={(e) => updatePart(idx, pi, \"quantity\", parseInt(e.target.value) || 0)}\n                                                    className=\"w-12 border rounded px-1 py-0.5 text-center text-xs bg-background\" data-testid={`input-part-qty-${item.productId}-${pi}`} />\n                                                </td>\n                                                <td className=\"p-1\">\n                                                  <input type=\"number\" step=\"0.1\" value={part.length ?? \"\"} onChange={(e) => updatePart(idx, pi, \"length\", parseFloat(e.target.value) || null)}\n                                                    className=\"w-12 border rounded px-1 py-0.5 text-center text-xs bg-background\" data-testid={`input-part-length-${item.productId}-${pi}`} />\n                                                </td>\n                                                <td className=\"p-1\">\n                                                  <input type=\"number\" step=\"0.1\" value={part.width ?? \"\"} onChange={(e) => updatePart(idx, pi, \"width\", parseFloat(e.target.value) || null)}\n                                                    className=\"w-12 border rounded px-1 py-0.5 text-center text-xs bg-background\" data-testid={`input-part-width-${item.productId}-${pi}`} />\n                                                </td>\n                                                <td className=\"p-1\">\n                                                  <input type=\"number\" step=\"0.1\" value={part.height ?? \"\"} onChange={(e) => updatePart(idx, pi, \"height\", parseFloat(e.target.value) || null)}\n                                                    className=\"w-12 border rounded px-1 py-0.5 text-center text-xs bg-background\" data-testid={`input-part-height-${item.productId}-${pi}`} />\n                                                </td>\n                                                <td className=\"p-1\">\n                                                  <input type=\"number\" step=\"0.1\" value={part.weight ?? \"\"} onChange={(e) => updatePart(idx, pi, \"weight\", parseFloat(e.target.value) || null)}\n                                                    className=\"w-12 border rounded px-1 py-0.5 text-center text-xs bg-background\" data-testid={`input-part-weight-${item.productId}-${pi}`} />\n                                                </td>\n                                                <td className=\"p-1\">\n                                                  <input type=\"number\" value={part.piecesPerCarton ?? \"\"} onChange={(e) => updatePart(idx, pi, \"piecesPerCarton\", parseInt(e.target.value) || null)}\n                                                    className=\"w-12 border rounded px-1 py-0.5 text-center text-xs bg-background\" data-testid={`input-part-ppc-${item.productId}-${pi}`} />\n                                                </td>\n                                                <td className=\"p-1\">\n                                                  <Button size=\"icon\" variant=\"ghost\" onClick={() => removePart(idx, pi)} data-testid={`button-remove-part-${item.productId}-${pi}`}>\n                                                    <Trash2 className=\"h-3 w-3 text-destructive\" />\n                                                  </Button>\n                                                </td>\n                                              </tr>\n                                            ))}\n                                          </tbody>\n                                        </table>\n                                      )}\n                                    </div>\n                                  </td>\n                                </tr>\n                              )}\n                            </>\n                          ))}\n                        </tbody>\n                      </table>\n                    </div>\n                  </div>\n                )}\n                <div className=\"flex gap-2\">\n                  <Button variant=\"outline\" onClick={() => setStep(\"supplier\")}>رجوع</Button>\n                  <Button onClick={handleConfirm} data-testid=\"button-confirm-delivery\">تأكيد</Button>\n                </div>\n              </div>\n            )}\n\n            {step === \"summary\" && (\n              <div className=\"space-y-4 pt-4\">\n                <div className=\"flex items-center justify-between gap-2\">\n                  <h3 className=\"font-semibold\">\n                    المورد: {suppliers?.find(s => s.id === parseInt(supplierId))?.name} |\n                    المخزن: {warehouses?.find(w => w.id === parseInt(warehouseId))?.name}\n                  </h3>\n                  <Button variant=\"outline\" size=\"icon\" onClick={() => window.print()} data-testid=\"button-print-delivery\">\n                    <Printer className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>{t(\"common.product\", language)}</TableHead>\n                      <TableHead>{t(\"common.quantity\", language)}</TableHead>\n                      {!hidePrice && <TableHead>السعر</TableHead>}\n                      {!hidePrice && <TableHead>العملة</TableHead>}\n                      {!hidePrice && <TableHead>المجموع</TableHead>}\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {selectedItems.map((item) => (\n                      <TableRow key={item.productId}>\n                        <TableCell className=\"font-medium\">\n                          <div className=\"flex items-center gap-1.5\">\n                            {item.productName}\n                            {item.productStatus === \"semi_manufactured\" && (\n                              <Badge variant=\"secondary\" className=\"bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-200 text-xs\">\n                                مركب\n                              </Badge>\n                            )}\n                          </div>\n                        </TableCell>\n                        <TableCell>{item.quantity}</TableCell>\n                        {!hidePrice && <TableCell>{item.price.toFixed(2)}</TableCell>}\n                        {!hidePrice && <TableCell>{item.currency === \"CNY\" ? \"يوان\" : \"دولار\"}</TableCell>}\n                        {!hidePrice && <TableCell className=\"font-semibold\">{(item.price * item.quantity).toFixed(2)}</TableCell>}\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n\n                {selectedItems.some(i => i.productStatus === \"semi_manufactured\" && i.parts.length > 0) && (\n                  <div className=\"space-y-3\">\n                    {selectedItems.filter(i => i.productStatus === \"semi_manufactured\" && i.parts.length > 0).map((item) => (\n                      <Card key={`parts-summary-${item.productId}`}>\n                        <CardHeader className=\"pb-2\">\n                          <CardTitle className=\"text-sm flex items-center gap-2\">\n                            <Layers className=\"h-4 w-4 text-cyan-600\" />\n                            {t(\"deliveries.parts\", language)}: {item.productName}\n                          </CardTitle>\n                        </CardHeader>\n                        <CardContent>\n                          <Table>\n                            <TableHeader>\n                              <TableRow>\n                                <TableHead>الجزء</TableHead>\n                                <TableHead>{t(\"common.quantity\", language)}</TableHead>\n                                <TableHead>{t(\"deliveries.length\", language)}</TableHead>\n                                <TableHead>{t(\"deliveries.width\", language)}</TableHead>\n                                <TableHead>{t(\"deliveries.height\", language)}</TableHead>\n                                <TableHead>{t(\"deliveries.weight\", language)}</TableHead>\n                                <TableHead>{t(\"deliveries.pcsCarton\", language)}</TableHead>\n                              </TableRow>\n                            </TableHeader>\n                            <TableBody>\n                              {item.parts.map((part, pi) => (\n                                <TableRow key={pi}>\n                                  <TableCell className=\"font-medium\">{part.name}</TableCell>\n                                  <TableCell>{part.quantity}</TableCell>\n                                  <TableCell>{part.length ?? \"-\"}</TableCell>\n                                  <TableCell>{part.width ?? \"-\"}</TableCell>\n                                  <TableCell>{part.height ?? \"-\"}</TableCell>\n                                  <TableCell>{part.weight ?? \"-\"}</TableCell>\n                                  <TableCell>{part.piecesPerCarton ?? \"-\"}</TableCell>\n                                </TableRow>\n                              ))}\n                            </TableBody>\n                          </Table>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                )}\n\n                {!hidePrice && <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <Card>\n                    <CardContent className=\"p-4 space-y-2\">\n                      <h4 className=\"font-semibold text-sm\">المجاميع المالية</h4>\n                      {totalCNY > 0 && (\n                        <div className=\"flex justify-between\"><span>يوان صيني:</span><span className=\"font-bold\">{totalCNY.toFixed(2)} CNY</span></div>\n                      )}\n                      {totalUSD > 0 && (\n                        <div className=\"flex justify-between\"><span>دولار:</span><span className=\"font-bold\">{totalUSD.toFixed(2)} USD</span></div>\n                      )}\n                    </CardContent>\n                  </Card>\n                </div>}\n\n                <div className=\"flex gap-2\">\n                  <Button variant=\"outline\" onClick={() => setStep(\"items\")}>رجوع</Button>\n                  <Button onClick={handleSubmit} disabled={confirmDeliveryMutation.isPending} data-testid=\"button-submit-delivery\">\n                    {confirmDeliveryMutation.isPending ? \"جاري التأكيد...\" : t(\"deliveries.confirmDelivery\", language)}\n                  </Button>\n                </div>\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <DeliveriesHistory />\n    </div>\n  );\n}\n\nfunction DeliveriesHistory() {\n  const { user } = useAuth();\n  const { language } = useLanguage();\n  const hidePrice = user?.role === \"warehouse\";\n  const { data: deliveriesList, isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/deliveries\"],\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-4\">\n        {Array.from({ length: 3 }).map((_, i) => (\n          <Card key={i}>\n            <CardContent className=\"p-6\">\n              <Skeleton className=\"h-6 w-full\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    );\n  }\n\n  if (!deliveriesList || deliveriesList.length === 0) {\n    return (\n      <Card>\n        <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n          <Truck className=\"h-12 w-12 text-muted-foreground mb-3\" />\n          <p className=\"text-muted-foreground\">{t(\"deliveries.noDeliveries\", language)}</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <h2 className=\"text-lg font-semibold\">{t(\"deliveries.deliveryHistory\", language)}</h2>\n      {deliveriesList.map((delivery: any) => (\n        <Card key={delivery.id} data-testid={`card-delivery-${delivery.id}`}>\n          <CardHeader className=\"pb-3\">\n            <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n              <CardTitle className=\"text-base\">\n                تسليم #{delivery.id} - {delivery.supplierName || \"مورد\"}\n              </CardTitle>\n              <Badge variant=\"secondary\">\n                {delivery.warehouseName || \"مخزن\"}\n              </Badge>\n            </div>\n            <p className=\"text-sm text-muted-foreground\">\n              {delivery.createdAt ? new Date(delivery.createdAt).toLocaleDateString(\"fr-FR\") : \"\"}\n            </p>\n          </CardHeader>\n          {delivery.items && delivery.items.length > 0 && (\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>{t(\"common.product\", language)}</TableHead>\n                    <TableHead>{t(\"common.quantity\", language)}</TableHead>\n                    {!hidePrice && <TableHead>السعر</TableHead>}\n                    {!hidePrice && <TableHead>العملة</TableHead>}\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {delivery.items.map((item: any) => (\n                    <TableRow key={item.id}>\n                      <TableCell>{item.productName || `منتج #${item.productId}`}</TableCell>\n                      <TableCell>{item.quantity}</TableCell>\n                      {!hidePrice && <TableCell>{item.price?.toFixed(2)}</TableCell>}\n                      {!hidePrice && <TableCell>{item.currency === \"CNY\" ? \"يوان\" : \"دولار\"}</TableCell>}\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </CardContent>\n          )}\n        </Card>\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":34576,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/pages/login.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Package, LogIn } from \"lucide-react\";\n\ninterface LoginProps {\n  onLogin: (user: any) => void;\n}\n\nexport default function Login({ onLogin }: LoginProps) {\n  const { toast } = useToast();\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!username.trim() || !password.trim()) {\n      toast({ title: \"يرجى إدخال اسم المستخدم وكلمة المرور\", variant: \"destructive\" });\n      return;\n    }\n    setLoading(true);\n    try {\n      const res = await apiRequest(\"POST\", \"/api/auth/login\", { username: username.trim(), password });\n      const user = await res.json();\n      onLogin(user);\n    } catch (error: any) {\n      toast({ title: \"خطأ في تسجيل الدخول\", description: error.message, variant: \"destructive\" });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"text-center space-y-4\">\n          <div className=\"flex justify-center\">\n            <div className=\"flex h-14 w-14 items-center justify-center rounded-md bg-primary\">\n              <Package className=\"h-8 w-8 text-primary-foreground\" />\n            </div>\n          </div>\n          <CardTitle className=\"text-2xl\" data-testid=\"text-login-title\">نظام إدارة المخزون</CardTitle>\n          <p className=\"text-muted-foreground text-sm\">تسجيل الدخول للمتابعة</p>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"username\">اسم المستخدم</Label>\n              <Input\n                id=\"username\"\n                data-testid=\"input-username\"\n                value={username}\n                onChange={(e) => setUsername(e.target.value)}\n                placeholder=\"أدخل اسم المستخدم\"\n                autoComplete=\"username\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">كلمة المرور</Label>\n              <Input\n                id=\"password\"\n                data-testid=\"input-password\"\n                type=\"password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                placeholder=\"أدخل كلمة المرور\"\n                autoComplete=\"current-password\"\n              />\n            </div>\n            <Button\n              type=\"submit\"\n              className=\"w-full\"\n              disabled={loading}\n              data-testid=\"button-login\"\n            >\n              <LogIn className=\"h-4 w-4\" />\n              {loading ? \"جاري الدخول...\" : \"تسجيل الدخول\"}\n            </Button>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":3426,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/pages/shipping.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Ship, Eye, Pencil, Printer } from \"lucide-react\";\nimport { openPrintWindow } from \"@/lib/printStyles\";\nimport { useAuth } from \"@/App\";\nimport type { Warehouse as WarehouseType, Product, ShippingCompany } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useLanguage } from \"@/lib/language-context\";\nimport { t } from \"@/lib/translations\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\n\nfunction formatDateFr(dateStr: string | null | undefined): string {\n  if (!dateStr) return \"-\";\n  return new Date(dateStr).toLocaleDateString(\"fr-FR\");\n}\n\ninterface ShipItem {\n  productId: number;\n  productName: string;\n  availableQty: number;\n  shipQty: number;\n  selected: boolean;\n}\n\nexport default function Shipping() {\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const { language } = useLanguage();\n  const hidePrice = user?.role === \"warehouse\";\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [warehouseId, setWarehouseId] = useState(\"\");\n  const [invoiceNumber, setInvoiceNumber] = useState(\"\");\n  const [containerNumber, setContainerNumber] = useState(\"\");\n  const [shippingCompanyId, setShippingCompanyId] = useState(\"\");\n  const [priceCNY, setPriceCNY] = useState(\"\");\n  const [priceUSD, setPriceUSD] = useState(\"\");\n  const [items, setItems] = useState<ShipItem[]>([]);\n  const [step, setStep] = useState<\"info\" | \"items\">(\"info\");\n\n  const { data: warehouses } = useQuery<WarehouseType[]>({\n    queryKey: [\"/api/warehouses\"],\n  });\n\n  const { data: receivedProducts } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: shippingCompanies } = useQuery<ShippingCompany[]>({\n    queryKey: [\"/api/shipping-companies\"],\n  });\n\n  const createContainerMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await apiRequest(\"POST\", \"/api/containers\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/containers\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/warehouse-inventory\"] });\n      setDialogOpen(false);\n      resetForm();\n      toast({ title: \"تم تحميل الحاوية بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const resetForm = () => {\n    setWarehouseId(\"\");\n    setInvoiceNumber(\"\");\n    setContainerNumber(\"\");\n    setShippingCompanyId(\"\");\n    setPriceCNY(\"\");\n    setPriceUSD(\"\");\n    setItems([]);\n    setStep(\"info\");\n  };\n\n  const handleNext = () => {\n    const received = receivedProducts?.filter(p => p.status === \"received\" || p.status === \"semi_manufactured\") || [];\n    const shipItems: ShipItem[] = received.map(p => ({\n      productId: p.id,\n      productName: p.name,\n      availableQty: p.quantity,\n      shipQty: p.quantity,\n      selected: false,\n    }));\n    setItems(shipItems);\n    if (warehouses && warehouses.length > 0 && !warehouseId) {\n      setWarehouseId(String(warehouses[0].id));\n    }\n    setStep(\"items\");\n  };\n\n  const toggleItem = (idx: number) => {\n    setItems(prev => prev.map((item, i) =>\n      i === idx ? { ...item, selected: !item.selected } : item\n    ));\n  };\n\n  const updateQty = (idx: number, qty: number) => {\n    setItems(prev => prev.map((item, i) =>\n      i === idx ? { ...item, shipQty: qty } : item\n    ));\n  };\n\n  const handleSubmit = () => {\n    const selected = items.filter(i => i.selected);\n    if (selected.length === 0) {\n      toast({ title: \"يرجى اختيار بضاعة للشحن\", variant: \"destructive\" });\n      return;\n    }\n    const company = shippingCompanies?.find(c => c.id === parseInt(shippingCompanyId));\n    createContainerMutation.mutate({\n      invoiceNumber,\n      containerNumber,\n      shippingCompany: company?.name || \"\",\n      shippingCompanyId: shippingCompanyId ? parseInt(shippingCompanyId) : null,\n      priceCNY: parseFloat(priceCNY) || 0,\n      priceUSD: parseFloat(priceUSD) || 0,\n      warehouseId: parseInt(warehouseId) || null,\n      items: selected.map(i => ({\n        productId: i.productId,\n        quantity: i.shipQty,\n      })),\n    });\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-shipping-title\">{t(\"shipping.title\", language)}</h1>\n          <p className=\"text-muted-foreground\">{t(\"shipping.subtitle\", language)}</p>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={(open) => { setDialogOpen(open); if (!open) resetForm(); }}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-load-container\">\n              <Ship className=\"h-4 w-4\" />\n              {t(\"shipping.newContainer\", language)}\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>\n                {step === \"info\" ? \"معلومات الحاوية\" : \"اختيار البضاعة\"}\n              </DialogTitle>\n            </DialogHeader>\n\n            {step === \"info\" && (\n              <div className=\"space-y-4 pt-4\">\n                <div className=\"space-y-2\">\n                  <Label>{t(\"common.warehouse\", language)}</Label>\n                  <Select value={warehouseId} onValueChange={setWarehouseId}>\n                    <SelectTrigger data-testid=\"select-ship-warehouse\">\n                      <SelectValue placeholder={t(\"shipping.selectWarehouse\", language)} />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {warehouses?.map((wh) => (\n                        <SelectItem key={wh.id} value={String(wh.id)}>{wh.name}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>{t(\"shipping.invoiceNumber\", language)}</Label>\n                  <Input data-testid=\"input-invoice\" value={invoiceNumber} onChange={(e) => setInvoiceNumber(e.target.value)} placeholder={t(\"shipping.invoiceNumber\", language)} />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>{t(\"shipping.containerNumber\", language)}</Label>\n                  <Input data-testid=\"input-container-number\" value={containerNumber} onChange={(e) => setContainerNumber(e.target.value)} placeholder={t(\"shipping.containerNumber\", language)} />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>{t(\"shipping.shippingCompany\", language)}</Label>\n                  <Select value={shippingCompanyId} onValueChange={setShippingCompanyId}>\n                    <SelectTrigger data-testid=\"select-shipping-company\">\n                      <SelectValue placeholder={t(\"shipping.shippingCompany\", language)} />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {shippingCompanies?.map((sc) => (\n                        <SelectItem key={sc.id} value={String(sc.id)}>{sc.name}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                {!hidePrice && <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label>سعر الحاوية (يوان)</Label>\n                    <Input data-testid=\"input-price-cny\" type=\"number\" step=\"0.01\" value={priceCNY} onChange={(e) => setPriceCNY(e.target.value)} placeholder=\"0.00\" />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>سعر الحاوية (دولار)</Label>\n                    <Input data-testid=\"input-price-usd\" type=\"number\" step=\"0.01\" value={priceUSD} onChange={(e) => setPriceUSD(e.target.value)} placeholder=\"0.00\" />\n                  </div>\n                </div>}\n                <Button className=\"w-full\" onClick={handleNext} data-testid=\"button-next-ship\">التالي</Button>\n              </div>\n            )}\n\n            {step === \"items\" && (\n              <div className=\"space-y-4 pt-4\">\n                {items.length === 0 ? (\n                  <div className=\"text-center py-8 text-muted-foreground\">لا توجد بضائع في المخزن</div>\n                ) : (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead className=\"w-10\">اختيار</TableHead>\n                        <TableHead>{t(\"common.product\", language)}</TableHead>\n                        <TableHead>{t(\"common.quantity\", language)}</TableHead>\n                        <TableHead>كمية الشحن</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {items.map((item, idx) => (\n                        <TableRow key={item.productId}>\n                          <TableCell>\n                            <Checkbox checked={item.selected} onCheckedChange={() => toggleItem(idx)} />\n                          </TableCell>\n                          <TableCell className=\"font-medium\">{item.productName}</TableCell>\n                          <TableCell data-testid={`text-available-qty-${item.productId}`}>{item.availableQty}</TableCell>\n                          <TableCell>\n                            <Input type=\"number\" className=\"w-20\" value={item.shipQty}\n                              onChange={(e) => updateQty(idx, parseInt(e.target.value) || 0)} />\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                )}\n                <div className=\"flex gap-2\">\n                  <Button variant=\"outline\" onClick={() => setStep(\"info\")}>رجوع</Button>\n                  <Button onClick={handleSubmit} disabled={createContainerMutation.isPending} data-testid=\"button-submit-container\">\n                    {createContainerMutation.isPending ? \"جاري التحميل...\" : t(\"shipping.confirmShip\", language)}\n                  </Button>\n                </div>\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <ContainersHistory />\n    </div>\n  );\n}\n\nfunction ContainersHistory() {\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const { language } = useLanguage();\n  const hidePrice = user?.role === \"warehouse\";\n  const { data: containersList, isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/containers\"],\n  });\n  const { data: shippingCompanies } = useQuery<ShippingCompany[]>({\n    queryKey: [\"/api/shipping-companies\"],\n  });\n\n  const [viewContainer, setViewContainer] = useState<any | null>(null);\n  const [editContainer, setEditContainer] = useState<any | null>(null);\n  const [editInvoice, setEditInvoice] = useState(\"\");\n  const [editContainerNum, setEditContainerNum] = useState(\"\");\n  const [editCompanyId, setEditCompanyId] = useState(\"\");\n  const [editPriceCNY, setEditPriceCNY] = useState(\"\");\n  const [editPriceUSD, setEditPriceUSD] = useState(\"\");\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: any }) => {\n      const res = await apiRequest(\"PATCH\", `/api/containers/${id}`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/containers\"] });\n      setEditContainer(null);\n      toast({ title: \"تم تحديث الحاوية بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const startEdit = (c: any) => {\n    setEditContainer(c);\n    setEditInvoice(c.invoiceNumber || \"\");\n    setEditContainerNum(c.containerNumber || \"\");\n    setEditCompanyId(c.shippingCompanyId ? String(c.shippingCompanyId) : \"\");\n    setEditPriceCNY(c.priceCNY ? String(c.priceCNY) : \"\");\n    setEditPriceUSD(c.priceUSD ? String(c.priceUSD) : \"\");\n  };\n\n  const saveEdit = () => {\n    if (!editContainer) return;\n    const company = shippingCompanies?.find(c => c.id === parseInt(editCompanyId));\n    updateMutation.mutate({\n      id: editContainer.id,\n      data: {\n        invoiceNumber: editInvoice,\n        containerNumber: editContainerNum,\n        shippingCompanyId: editCompanyId ? parseInt(editCompanyId) : null,\n        shippingCompany: company?.name || \"\",\n        priceCNY: parseFloat(editPriceCNY) || 0,\n        priceUSD: parseFloat(editPriceUSD) || 0,\n      },\n    });\n  };\n\n  const handlePrint = (container: any) => {\n    const itemsHtml = container.items?.map((item: any) =>\n      `<tr><td>${item.productName || `منتج #${item.productId}`}</td><td class=\"text-center\">${item.quantity}</td></tr>`\n    ).join(\"\") || \"\";\n\n    const infoHtml = `\n      <div class=\"info-row\">\n        <div class=\"info-item\"><span class=\"info-label\">رقم الفاتورة:</span> <span class=\"info-value\">${container.invoiceNumber || \"-\"}</span></div>\n        <div class=\"info-item\"><span class=\"info-label\">شركة الشحن:</span> <span class=\"info-value\">${container.shippingCompanyName || \"-\"}</span></div>\n        <div class=\"info-item\"><span class=\"info-label\">المخزن:</span> <span class=\"info-value\">${container.warehouseName || \"-\"}</span></div>\n        <div class=\"info-item\"><span class=\"info-label\">التاريخ:</span> <span class=\"info-value\">${container.createdAt ? new Date(container.createdAt).toLocaleDateString(\"fr-FR\") : \"-\"}</span></div>\n      </div>\n      ${!hidePrice && (container.priceCNY > 0 || container.priceUSD > 0) ? `\n      <div class=\"summary-grid\" style=\"grid-template-columns: repeat(2, 1fr);\">\n        ${container.priceCNY > 0 ? `<div class=\"summary-card\"><div class=\"summary-label\">السعر (يوان)</div><div class=\"summary-value\">${container.priceCNY.toFixed(2)}<span class=\"currency-label\">CNY</span></div></div>` : \"\"}\n        ${container.priceUSD > 0 ? `<div class=\"summary-card\"><div class=\"summary-label\">السعر (دولار)</div><div class=\"summary-value\">${container.priceUSD.toFixed(2)}<span class=\"currency-label\">USD</span></div></div>` : \"\"}\n      </div>` : \"\"}\n    `;\n\n    const tableHtml = `\n      <table>\n        <thead><tr><th>المنتج</th><th>الكمية</th></tr></thead>\n        <tbody>${itemsHtml}</tbody>\n      </table>\n    `;\n\n    openPrintWindow({\n      title: `حاوية #${container.containerNumber || container.id}`,\n      content: infoHtml + tableHtml,\n    });\n  };\n\n  const statusLabels: Record<string, string> = {\n    shipping: \"في الشحن\",\n    arrived: \"وصلت\",\n  };\n\n  const statusColors: Record<string, string> = {\n    shipping: \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200\",\n    arrived: \"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200\",\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-4\">\n        {Array.from({ length: 3 }).map((_, i) => (\n          <Card key={i}>\n            <CardContent className=\"p-6\">\n              <Skeleton className=\"h-6 w-full\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    );\n  }\n\n  if (!containersList || containersList.length === 0) {\n    return (\n      <Card>\n        <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n          <Ship className=\"h-12 w-12 text-muted-foreground mb-3\" />\n          <p className=\"text-muted-foreground\">{t(\"shipping.noContainers\", language)}</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <h2 className=\"text-lg font-semibold\">{t(\"shipping.containerHistory\", language)}</h2>\n      {containersList.map((container: any) => (\n        <Card key={container.id} data-testid={`card-container-history-${container.id}`}>\n          <CardHeader className=\"pb-3\">\n            <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n              <CardTitle className=\"text-base\">\n                حاوية #{container.containerNumber || container.id}\n              </CardTitle>\n              <div className=\"flex items-center gap-1\">\n                <Button size=\"icon\" variant=\"ghost\" onClick={() => setViewContainer(container)} data-testid={`button-view-container-${container.id}`}>\n                  <Eye className=\"h-4 w-4\" />\n                </Button>\n                <Button size=\"icon\" variant=\"ghost\" onClick={() => startEdit(container)} data-testid={`button-edit-container-${container.id}`}>\n                  <Pencil className=\"h-4 w-4\" />\n                </Button>\n                <Button size=\"icon\" variant=\"ghost\" onClick={() => handlePrint(container)} data-testid={`button-print-container-${container.id}`}>\n                  <Printer className=\"h-4 w-4\" />\n                </Button>\n                <Badge variant=\"secondary\" className={statusColors[container.status]}>\n                  {statusLabels[container.status] || container.status}\n                </Badge>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-4 text-sm text-muted-foreground flex-wrap\">\n              {container.invoiceNumber && <span>فاتورة: {container.invoiceNumber}</span>}\n              {container.shippingCompanyName && <span>{t(\"shipping.shippingCompany\", language)}: {container.shippingCompanyName}</span>}\n              {container.warehouseName && <span>المخزن: {container.warehouseName}</span>}\n              {!hidePrice && (container.priceCNY > 0 || container.priceUSD > 0) && (\n                <span>\n                  السعر:\n                  {container.priceCNY > 0 && ` ${container.priceCNY.toFixed(2)} CNY`}\n                  {container.priceCNY > 0 && container.priceUSD > 0 && \" | \"}\n                  {container.priceUSD > 0 && ` ${container.priceUSD.toFixed(2)} USD`}\n                </span>\n              )}\n              {container.createdAt && <span>{formatDateFr(container.createdAt)}</span>}\n            </div>\n          </CardHeader>\n        </Card>\n      ))}\n\n      <Dialog open={!!viewContainer} onOpenChange={(open) => { if (!open) setViewContainer(null); }}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>حاوية #{viewContainer?.containerNumber || viewContainer?.id}</DialogTitle>\n          </DialogHeader>\n          {viewContainer && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                <div><span className=\"text-muted-foreground\">{t(\"shipping.invoiceNumber\", language)}:</span> <span className=\"font-medium\">{viewContainer.invoiceNumber || \"-\"}</span></div>\n                <div><span className=\"text-muted-foreground\">{t(\"shipping.containerNumber\", language)}:</span> <span className=\"font-medium\">{viewContainer.containerNumber || \"-\"}</span></div>\n                <div><span className=\"text-muted-foreground\">{t(\"shipping.shippingCompany\", language)}:</span> <span className=\"font-medium\">{viewContainer.shippingCompanyName || \"-\"}</span></div>\n                <div><span className=\"text-muted-foreground\">المخزن:</span> <span className=\"font-medium\">{viewContainer.warehouseName || \"-\"}</span></div>\n                <div><span className=\"text-muted-foreground\">الحالة:</span> <Badge variant=\"secondary\" className={statusColors[viewContainer.status]}>{statusLabels[viewContainer.status] || viewContainer.status}</Badge></div>\n                <div><span className=\"text-muted-foreground\">التاريخ:</span> <span className=\"font-medium\">{viewContainer.createdAt ? formatDateFr(viewContainer.createdAt) : \"-\"}</span></div>\n                {!hidePrice && (viewContainer.priceCNY > 0 || viewContainer.priceUSD > 0) && (\n                  <div className=\"col-span-2\"><span className=\"text-muted-foreground\">السعر:</span> <span className=\"font-medium\">{viewContainer.priceCNY > 0 ? `${viewContainer.priceCNY.toFixed(2)} CNY` : \"\"}{viewContainer.priceCNY > 0 && viewContainer.priceUSD > 0 ? \" | \" : \"\"}{viewContainer.priceUSD > 0 ? `${viewContainer.priceUSD.toFixed(2)} USD` : \"\"}</span></div>\n                )}\n              </div>\n              {viewContainer.items && viewContainer.items.length > 0 && (\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>{t(\"common.product\", language)}</TableHead>\n                      <TableHead>{t(\"common.quantity\", language)}</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {viewContainer.items.map((item: any) => (\n                      <TableRow key={item.id}>\n                        <TableCell>{item.productName || `منتج #${item.productId}`}</TableCell>\n                        <TableCell>{item.quantity}</TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              )}\n              <Button variant=\"outline\" onClick={() => handlePrint(viewContainer)} className=\"w-full\">\n                <Printer className=\"h-4 w-4 ml-2\" />\n                {t(\"common.print\", language)}\n              </Button>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={!!editContainer} onOpenChange={(open) => { if (!open) setEditContainer(null); }}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>تعديل حاوية #{editContainer?.containerNumber || editContainer?.id}</DialogTitle>\n          </DialogHeader>\n          {editContainer && (\n            <div className=\"space-y-3\">\n              <div className=\"space-y-1\">\n                <Label>{t(\"shipping.invoiceNumber\", language)}</Label>\n                <Input value={editInvoice} onChange={(e) => setEditInvoice(e.target.value)} data-testid=\"input-edit-container-invoice\" />\n              </div>\n              <div className=\"space-y-1\">\n                <Label>{t(\"shipping.containerNumber\", language)}</Label>\n                <Input value={editContainerNum} onChange={(e) => setEditContainerNum(e.target.value)} data-testid=\"input-edit-container-number\" />\n              </div>\n              <div className=\"space-y-1\">\n                <Label>{t(\"shipping.shippingCompany\", language)}</Label>\n                <Select value={editCompanyId} onValueChange={setEditCompanyId}>\n                  <SelectTrigger data-testid=\"select-edit-container-company\">\n                    <SelectValue placeholder={t(\"shipping.shippingCompany\", language)} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {shippingCompanies?.map((sc) => (\n                      <SelectItem key={sc.id} value={String(sc.id)}>{sc.name}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              {!hidePrice && <div className=\"grid grid-cols-2 gap-3\">\n                <div className=\"space-y-1\">\n                  <Label>سعر (يوان)</Label>\n                  <Input type=\"number\" step=\"0.01\" value={editPriceCNY} onChange={(e) => setEditPriceCNY(e.target.value)} data-testid=\"input-edit-container-price-cny\" />\n                </div>\n                <div className=\"space-y-1\">\n                  <Label>سعر (دولار)</Label>\n                  <Input type=\"number\" step=\"0.01\" value={editPriceUSD} onChange={(e) => setEditPriceUSD(e.target.value)} data-testid=\"input-edit-container-price-usd\" />\n                </div>\n              </div>}\n              <Button className=\"w-full\" onClick={saveEdit} disabled={updateMutation.isPending} data-testid=\"button-save-edit-container\">\n                {updateMutation.isPending ? \"جاري الحفظ...\" : \"حفظ التعديلات\"}\n              </Button>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":24989,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/pages/supplier-accounts.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Wallet, CreditCard, Printer, Pencil, Trash2, ArrowRightLeft } from \"lucide-react\";\nimport { openPrintWindow } from \"@/lib/printStyles\";\nimport type { Supplier } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\nfunction formatDateFr(dateStr: string | null | undefined): string {\n  if (!dateStr) return \"-\";\n  return new Date(dateStr).toLocaleDateString(\"fr-FR\");\n}\n\nexport default function SupplierAccounts() {\n  const { toast } = useToast();\n  const [selectedSupplier, setSelectedSupplier] = useState(\"\");\n  const [paymentDialogOpen, setPaymentDialogOpen] = useState(false);\n  const [payAmount, setPayAmount] = useState(\"\");\n  const [payCurrency, setPayCurrency] = useState(\"CNY\");\n  const [payNote, setPayNote] = useState(\"\");\n  const [editPaymentDialogOpen, setEditPaymentDialogOpen] = useState(false);\n  const [editPayment, setEditPayment] = useState<any>(null);\n  const [editAmount, setEditAmount] = useState(\"\");\n  const [editCurrency, setEditCurrency] = useState(\"CNY\");\n  const [editNote, setEditNote] = useState(\"\");\n  const [deletePaymentId, setDeletePaymentId] = useState<number | null>(null);\n  const [convertDialogOpen, setConvertDialogOpen] = useState(false);\n  const [convertPayment, setConvertPayment] = useState<any>(null);\n  const [convertRate, setConvertRate] = useState(\"\");\n  const printRef = useRef<HTMLDivElement>(null);\n\n  const { data: suppliers } = useQuery<Supplier[]>({\n    queryKey: [\"/api/suppliers\"],\n  });\n\n  const { data: accountData, isLoading: accountLoading } = useQuery<any>({\n    queryKey: [\"/api/suppliers\", selectedSupplier, \"account\"],\n    enabled: !!selectedSupplier,\n  });\n\n  const paymentMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await apiRequest(\"POST\", \"/api/payments\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\", selectedSupplier, \"account\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/summary\"] });\n      setPaymentDialogOpen(false);\n      setPayAmount(\"\");\n      setPayNote(\"\");\n      toast({ title: \"تم تسجيل الدفعة بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updatePaymentMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: any }) => {\n      const res = await apiRequest(\"PATCH\", `/api/payments/${id}`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\", selectedSupplier, \"account\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/summary\"] });\n      setEditPaymentDialogOpen(false);\n      setEditPayment(null);\n      toast({ title: \"تم تحديث الدفعة بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deletePaymentMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/payments/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\", selectedSupplier, \"account\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/summary\"] });\n      setDeletePaymentId(null);\n      toast({ title: \"تم حذف الدفعة بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const convertPaymentMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: any }) => {\n      const res = await apiRequest(\"PATCH\", `/api/payments/${id}`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\", selectedSupplier, \"account\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/summary\"] });\n      setConvertDialogOpen(false);\n      setConvertPayment(null);\n      setConvertRate(\"\");\n      toast({ title: \"تم تحويل العملة بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const handlePayment = () => {\n    if (!payAmount || !selectedSupplier) return;\n    paymentMutation.mutate({\n      supplierId: parseInt(selectedSupplier),\n      amount: parseFloat(payAmount),\n      currency: payCurrency,\n      note: payNote,\n    });\n  };\n\n  const openEditPayment = (pay: any) => {\n    setEditPayment(pay);\n    setEditAmount(String(pay.amount));\n    setEditCurrency(pay.currency);\n    setEditNote(pay.note || \"\");\n    setEditPaymentDialogOpen(true);\n  };\n\n  const handleUpdatePayment = () => {\n    if (!editPayment) return;\n    updatePaymentMutation.mutate({\n      id: editPayment.id,\n      data: {\n        amount: parseFloat(editAmount),\n        currency: editCurrency,\n        note: editNote,\n      },\n    });\n  };\n\n  const openConvertPayment = (pay: any) => {\n    setConvertPayment(pay);\n    setConvertRate(\"\");\n    setConvertDialogOpen(true);\n  };\n\n  const handleConvert = () => {\n    if (!convertPayment || !convertRate) return;\n    const rate = parseFloat(convertRate);\n    if (rate <= 0) return;\n    const newAmount = convertPayment.amount * rate;\n    const newCurrency = convertPayment.currency === \"CNY\" ? \"USD\" : \"CNY\";\n    const notePrefix = `تحويل من ${convertPayment.currency === \"CNY\" ? \"يوان\" : \"دولار\"} بسعر ${rate}`;\n    const existingNote = convertPayment.note ? ` | ${convertPayment.note}` : \"\";\n    convertPaymentMutation.mutate({\n      id: convertPayment.id,\n      data: {\n        amount: parseFloat(newAmount.toFixed(2)),\n        currency: newCurrency,\n        note: notePrefix + existingNote,\n      },\n    });\n  };\n\n  const handlePrint = () => {\n    const printContent = printRef.current;\n    if (!printContent) return;\n    const supplierName = suppliers?.find(s => s.id === parseInt(selectedSupplier))?.name || \"\";\n    openPrintWindow({\n      title: \"كشف حساب المورد\",\n      subtitle: supplierName,\n      content: printContent.innerHTML,\n    });\n  };\n\n  const remainingCNY = (accountData?.totalCNY || 0) - (accountData?.paidCNY || 0);\n  const remainingUSD = (accountData?.totalUSD || 0) - (accountData?.paidUSD || 0);\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-accounts-title\">حسابات الموردين</h1>\n          <p className=\"text-muted-foreground\">عرض أرصدة ومدفوعات الموردين</p>\n        </div>\n        {selectedSupplier && accountData && (\n          <Button variant=\"outline\" onClick={handlePrint} data-testid=\"button-print-account\">\n            <Printer className=\"h-4 w-4\" />\n            طباعة كشف الحساب\n          </Button>\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label>اختر المورد</Label>\n        <Select value={selectedSupplier} onValueChange={setSelectedSupplier}>\n          <SelectTrigger className=\"max-w-sm\" data-testid=\"select-account-supplier\">\n            <SelectValue placeholder=\"اختر المورد لعرض حسابه\" />\n          </SelectTrigger>\n          <SelectContent>\n            {suppliers?.map((s) => (\n              <SelectItem key={s.id} value={String(s.id)}>{s.name}</SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n\n      {selectedSupplier && (\n        <>\n          {accountLoading ? (\n            <div className=\"space-y-4\">\n              <Skeleton className=\"h-32 w-full\" />\n              <Skeleton className=\"h-48 w-full\" />\n            </div>\n          ) : accountData ? (\n            <div className=\"space-y-6\" ref={printRef}>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm font-medium text-muted-foreground\">إجمالي المستحق (يوان)</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <span className=\"text-2xl font-bold\" data-testid=\"text-total-cny\">{(accountData.totalCNY || 0).toFixed(2)}</span>\n                    <span className=\"text-sm text-muted-foreground mr-1\">CNY</span>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm font-medium text-muted-foreground\">إجمالي المستحق (دولار)</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <span className=\"text-2xl font-bold\" data-testid=\"text-total-usd\">{(accountData.totalUSD || 0).toFixed(2)}</span>\n                    <span className=\"text-sm text-muted-foreground mr-1\">USD</span>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm font-medium text-muted-foreground\">إجمالي المدفوع</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-1\">\n                      <div><span className=\"text-lg font-bold\" data-testid=\"text-paid-cny\">{(accountData.paidCNY || 0).toFixed(2)}</span> <span className=\"text-sm text-muted-foreground\">CNY</span></div>\n                      <div><span className=\"text-lg font-bold\" data-testid=\"text-paid-usd\">{(accountData.paidUSD || 0).toFixed(2)}</span> <span className=\"text-sm text-muted-foreground\">USD</span></div>\n                    </div>\n                  </CardContent>\n                </Card>\n                <Card className=\"border-destructive/30\">\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm font-medium text-destructive\">المبلغ المتبقي</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-1\">\n                      {(remainingCNY > 0 || accountData.totalCNY > 0) && (\n                        <div>\n                          <span className=\"text-lg font-bold text-destructive\" data-testid=\"text-remaining-cny\">{remainingCNY.toFixed(2)}</span>\n                          <span className=\"text-sm text-muted-foreground mr-1\">CNY</span>\n                        </div>\n                      )}\n                      {(remainingUSD > 0 || accountData.totalUSD > 0) && (\n                        <div>\n                          <span className=\"text-lg font-bold text-destructive\" data-testid=\"text-remaining-usd\">{remainingUSD.toFixed(2)}</span>\n                          <span className=\"text-sm text-muted-foreground mr-1\">USD</span>\n                        </div>\n                      )}\n                      {remainingCNY <= 0 && remainingUSD <= 0 && (\n                        <Badge variant=\"secondary\" className=\"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200\">\n                          تم السداد بالكامل\n                        </Badge>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                <h2 className=\"text-lg font-semibold\">البضائع المستلمة</h2>\n                <Dialog open={paymentDialogOpen} onOpenChange={setPaymentDialogOpen}>\n                  <DialogTrigger asChild>\n                    <Button data-testid=\"button-add-payment\">\n                      <CreditCard className=\"h-4 w-4\" />\n                      تسجيل دفعة\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent>\n                    <DialogHeader>\n                      <DialogTitle>تسجيل دفعة للمورد</DialogTitle>\n                    </DialogHeader>\n                    <div className=\"space-y-4 pt-4\">\n                      <div className=\"space-y-2\">\n                        <Label>المبلغ</Label>\n                        <Input\n                          data-testid=\"input-payment-amount\"\n                          type=\"number\"\n                          step=\"0.01\"\n                          value={payAmount}\n                          onChange={(e) => setPayAmount(e.target.value)}\n                          placeholder=\"0.00\"\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label>العملة</Label>\n                        <Select value={payCurrency} onValueChange={setPayCurrency}>\n                          <SelectTrigger data-testid=\"select-payment-currency\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"CNY\">يوان صيني</SelectItem>\n                            <SelectItem value=\"USD\">دولار أمريكي</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label>ملاحظة</Label>\n                        <Input\n                          data-testid=\"input-payment-note\"\n                          value={payNote}\n                          onChange={(e) => setPayNote(e.target.value)}\n                          placeholder=\"ملاحظة اختيارية\"\n                        />\n                      </div>\n                      <Button className=\"w-full\" onClick={handlePayment} disabled={paymentMutation.isPending} data-testid=\"button-submit-payment\">\n                        {paymentMutation.isPending ? \"جاري التسجيل...\" : \"تسجيل الدفعة\"}\n                      </Button>\n                    </div>\n                  </DialogContent>\n                </Dialog>\n              </div>\n\n              {accountData.deliveryItems && accountData.deliveryItems.length > 0 ? (\n                <Card>\n                  <CardContent className=\"pt-6\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>المنتج</TableHead>\n                          <TableHead>الكمية</TableHead>\n                          <TableHead>السعر</TableHead>\n                          <TableHead>العملة</TableHead>\n                          <TableHead>المجموع</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {accountData.deliveryItems.map((item: any, idx: number) => (\n                          <TableRow key={idx}>\n                            <TableCell className=\"font-medium\">{item.productName}</TableCell>\n                            <TableCell>{item.quantity}</TableCell>\n                            <TableCell>{item.price?.toFixed(2)}</TableCell>\n                            <TableCell>{item.currency === \"CNY\" ? \"يوان\" : \"دولار\"}</TableCell>\n                            <TableCell className=\"font-semibold\">{(item.price * item.quantity).toFixed(2)}</TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </CardContent>\n                </Card>\n              ) : (\n                <Card>\n                  <CardContent className=\"flex flex-col items-center justify-center py-8 text-center\">\n                    <Wallet className=\"h-10 w-10 text-muted-foreground mb-2\" />\n                    <p className=\"text-muted-foreground\">لا توجد بضائع مستلمة من هذا المورد</p>\n                  </CardContent>\n                </Card>\n              )}\n\n              {accountData.payments && accountData.payments.length > 0 && (\n                <div className=\"space-y-4\">\n                  <h2 className=\"text-lg font-semibold\">سجل المدفوعات</h2>\n                  <Card>\n                    <CardContent className=\"pt-6\">\n                      <Table>\n                        <TableHeader>\n                          <TableRow>\n                            <TableHead>التاريخ</TableHead>\n                            <TableHead>المبلغ</TableHead>\n                            <TableHead>العملة</TableHead>\n                            <TableHead>ملاحظة</TableHead>\n                            <TableHead>إجراءات</TableHead>\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          {accountData.payments.map((pay: any) => (\n                            <TableRow key={pay.id} data-testid={`row-payment-${pay.id}`}>\n                              <TableCell className=\"text-sm\">{formatDateFr(pay.createdAt)}</TableCell>\n                              <TableCell className=\"font-semibold\">{pay.amount?.toFixed(2)}</TableCell>\n                              <TableCell>{pay.currency === \"CNY\" ? \"يوان\" : \"دولار\"}</TableCell>\n                              <TableCell className=\"text-sm text-muted-foreground\">{pay.note || \"-\"}</TableCell>\n                              <TableCell>\n                                <div className=\"flex gap-1\">\n                                  <Button\n                                    size=\"icon\"\n                                    variant=\"ghost\"\n                                    onClick={() => openEditPayment(pay)}\n                                    data-testid={`button-edit-payment-${pay.id}`}\n                                  >\n                                    <Pencil className=\"h-4 w-4\" />\n                                  </Button>\n                                  <Button\n                                    size=\"icon\"\n                                    variant=\"ghost\"\n                                    onClick={() => openConvertPayment(pay)}\n                                    data-testid={`button-convert-payment-${pay.id}`}\n                                  >\n                                    <ArrowRightLeft className=\"h-4 w-4\" />\n                                  </Button>\n                                  <Button\n                                    size=\"icon\"\n                                    variant=\"ghost\"\n                                    onClick={() => setDeletePaymentId(pay.id)}\n                                    data-testid={`button-delete-payment-${pay.id}`}\n                                  >\n                                    <Trash2 className=\"h-4 w-4 text-destructive\" />\n                                  </Button>\n                                </div>\n                              </TableCell>\n                            </TableRow>\n                          ))}\n                        </TableBody>\n                      </Table>\n                    </CardContent>\n                  </Card>\n                </div>\n              )}\n            </div>\n          ) : null}\n        </>\n      )}\n\n      {!selectedSupplier && (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n            <Wallet className=\"h-12 w-12 text-muted-foreground mb-3\" />\n            <p className=\"text-muted-foreground\">اختر موردًا لعرض حسابه</p>\n          </CardContent>\n        </Card>\n      )}\n\n      <Dialog open={editPaymentDialogOpen} onOpenChange={setEditPaymentDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>تعديل الدفعة</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"space-y-2\">\n              <Label>المبلغ</Label>\n              <Input\n                data-testid=\"input-edit-payment-amount\"\n                type=\"number\"\n                step=\"0.01\"\n                value={editAmount}\n                onChange={(e) => setEditAmount(e.target.value)}\n                placeholder=\"0.00\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>العملة</Label>\n              <Select value={editCurrency} onValueChange={setEditCurrency}>\n                <SelectTrigger data-testid=\"select-edit-payment-currency\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"CNY\">يوان صيني</SelectItem>\n                  <SelectItem value=\"USD\">دولار أمريكي</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>ملاحظة</Label>\n              <Input\n                data-testid=\"input-edit-payment-note\"\n                value={editNote}\n                onChange={(e) => setEditNote(e.target.value)}\n                placeholder=\"ملاحظة اختيارية\"\n              />\n            </div>\n            <Button className=\"w-full\" onClick={handleUpdatePayment} disabled={updatePaymentMutation.isPending} data-testid=\"button-submit-edit-payment\">\n              {updatePaymentMutation.isPending ? \"جاري التحديث...\" : \"حفظ التعديلات\"}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={convertDialogOpen} onOpenChange={setConvertDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>تحويل العملة</DialogTitle>\n          </DialogHeader>\n          {convertPayment && (\n            <div className=\"space-y-4 pt-4\">\n              <div className=\"p-4 bg-muted rounded-md space-y-2\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-muted-foreground\">المبلغ الحالي:</span>\n                  <span className=\"font-bold\">{convertPayment.amount?.toFixed(2)} {convertPayment.currency === \"CNY\" ? \"يوان\" : \"دولار\"}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-muted-foreground\">التحويل إلى:</span>\n                  <span className=\"font-semibold\">{convertPayment.currency === \"CNY\" ? \"دولار أمريكي (USD)\" : \"يوان صيني (CNY)\"}</span>\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <Label>سعر الصرف</Label>\n                <Input\n                  data-testid=\"input-convert-rate\"\n                  type=\"number\"\n                  step=\"0.001\"\n                  value={convertRate}\n                  onChange={(e) => setConvertRate(e.target.value)}\n                  placeholder={convertPayment.currency === \"CNY\" ? \"مثلاً: 0.14 (1 يوان = 0.14 دولار)\" : \"مثلاً: 7.2 (1 دولار = 7.2 يوان)\"}\n                />\n              </div>\n              {convertRate && parseFloat(convertRate) > 0 && (\n                <div className=\"p-3 bg-muted rounded-md\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm\">المبلغ بعد التحويل:</span>\n                    <span className=\"text-lg font-bold\">\n                      {(convertPayment.amount * parseFloat(convertRate)).toFixed(2)} {convertPayment.currency === \"CNY\" ? \"USD\" : \"CNY\"}\n                    </span>\n                  </div>\n                </div>\n              )}\n              <Button className=\"w-full\" onClick={handleConvert} disabled={convertPaymentMutation.isPending || !convertRate} data-testid=\"button-submit-convert\">\n                {convertPaymentMutation.isPending ? \"جاري التحويل...\" : \"تأكيد التحويل\"}\n              </Button>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={!!deletePaymentId} onOpenChange={(open) => { if (!open) setDeletePaymentId(null); }}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>حذف الدفعة</AlertDialogTitle>\n            <AlertDialogDescription>\n              هل أنت متأكد من حذف هذه الدفعة؟ لا يمكن التراجع عن هذا الإجراء.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter className=\"flex gap-2\">\n            <AlertDialogCancel data-testid=\"button-cancel-delete-payment\">إلغاء</AlertDialogCancel>\n            <AlertDialogAction\n              data-testid=\"button-confirm-delete-payment\"\n              onClick={() => deletePaymentId && deletePaymentMutation.mutate(deletePaymentId)}\n              className=\"bg-destructive text-destructive-foreground\"\n            >\n              {deletePaymentMutation.isPending ? \"جاري الحذف...\" : \"حذف\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":26626,"size_tokens":null},"client/src/pages/warehouses.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Plus, Warehouse, Pencil, Trash2 } from \"lucide-react\";\nimport type { Warehouse as WarehouseType } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useLanguage } from \"@/lib/language-context\";\nimport { t } from \"@/lib/translations\";\n\nexport default function Warehouses() {\n  const { toast } = useToast();\n  const { language } = useLanguage();\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [name, setName] = useState(\"\");\n  const [editId, setEditId] = useState<number | null>(null);\n  const [editName, setEditName] = useState(\"\");\n\n  const { data: warehouses, isLoading } = useQuery<WarehouseType[]>({\n    queryKey: [\"/api/warehouses\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: { name: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/warehouses\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/warehouses\"] });\n      setDialogOpen(false);\n      setName(\"\");\n      toast({ title: t(\"warehouses.createSuccess\", language) });\n    },\n    onError: (error: Error) => {\n      toast({ title: t(\"common.error\", language), description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, name }: { id: number; name: string }) => {\n      const res = await apiRequest(\"PATCH\", `/api/warehouses/${id}`, { name });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/warehouses\"] });\n      setEditId(null);\n      setEditName(\"\");\n      toast({ title: t(\"warehouses.editSuccess\", language) });\n    },\n    onError: (error: Error) => {\n      toast({ title: t(\"common.error\", language), description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const res = await apiRequest(\"DELETE\", `/api/warehouses/${id}`);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/warehouses\"] });\n      toast({ title: t(\"warehouses.deleteSuccess\", language) });\n    },\n    onError: (error: Error) => {\n      toast({ title: t(\"common.error\", language), description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const handleCreate = () => {\n    if (!name.trim()) {\n      toast({ title: \"يرجى إدخال اسم المخزن\", variant: \"destructive\" });\n      return;\n    }\n    createMutation.mutate({ name: name.trim() });\n  };\n\n  const handleUpdate = () => {\n    if (!editName.trim() || editId === null) return;\n    updateMutation.mutate({ id: editId, name: editName.trim() });\n  };\n\n  const handleDelete = (id: number, whName: string) => {\n    if (confirm(`هل أنت متأكد من حذف المخزن \"${whName}\"؟`)) {\n      deleteMutation.mutate(id);\n    }\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-warehouses-title\">{t(\"warehouses.title\", language)}</h1>\n          <p className=\"text-muted-foreground\">{t(\"warehouses.subtitle\", language)}</p>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-add-warehouse\">\n              <Plus className=\"h-4 w-4\" />\n              {t(\"warehouses.addWarehouse\", language)}\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>إضافة مخزن جديد</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4 pt-4\">\n              <div className=\"space-y-2\">\n                <Label>{t(\"warehouses.warehouseName\", language)}</Label>\n                <Input\n                  data-testid=\"input-warehouse-name\"\n                  value={name}\n                  onChange={(e) => setName(e.target.value)}\n                  placeholder=\"أدخل اسم المخزن\"\n                />\n              </div>\n              <Button\n                data-testid=\"button-submit-warehouse\"\n                className=\"w-full\"\n                onClick={handleCreate}\n                disabled={createMutation.isPending}\n              >\n                {createMutation.isPending ? \"جاري الإنشاء...\" : \"إنشاء المخزن\"}\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {Array.from({ length: 2 }).map((_, i) => (\n            <Card key={i}><CardContent className=\"p-6\"><Skeleton className=\"h-6 w-32\" /></CardContent></Card>\n          ))}\n        </div>\n      ) : warehouses && warehouses.length > 0 ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {warehouses.map((wh) => (\n            <Card key={wh.id} data-testid={`card-warehouse-${wh.id}`}>\n              <CardContent className=\"flex items-center justify-between gap-3 p-6\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"flex h-10 w-10 items-center justify-center rounded-md bg-primary/10 shrink-0\">\n                    <Warehouse className=\"h-5 w-5 text-primary\" />\n                  </div>\n                  {editId === wh.id ? (\n                    <div className=\"flex items-center gap-2\">\n                      <Input\n                        value={editName}\n                        onChange={(e) => setEditName(e.target.value)}\n                        className=\"w-40\"\n                        data-testid={`input-edit-warehouse-${wh.id}`}\n                      />\n                      <Button size=\"sm\" onClick={handleUpdate} disabled={updateMutation.isPending} data-testid={`button-save-warehouse-${wh.id}`}>\n                        {t(\"common.save\", language)}\n                      </Button>\n                      <Button size=\"sm\" variant=\"ghost\" onClick={() => setEditId(null)} data-testid={`button-cancel-edit-${wh.id}`}>\n                        إلغاء\n                      </Button>\n                    </div>\n                  ) : (\n                    <h3 className=\"font-semibold\">{wh.name}</h3>\n                  )}\n                </div>\n                {editId !== wh.id && (\n                  <div className=\"flex items-center gap-1\">\n                    <Button size=\"icon\" variant=\"ghost\" onClick={() => { setEditId(wh.id); setEditName(wh.name); }} data-testid={`button-edit-warehouse-${wh.id}`}>\n                      <Pencil className=\"h-4 w-4\" />\n                    </Button>\n                    <Button size=\"icon\" variant=\"ghost\" onClick={() => handleDelete(wh.id, wh.name)} data-testid={`button-delete-warehouse-${wh.id}`}>\n                      <Trash2 className=\"h-4 w-4 text-destructive\" />\n                    </Button>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n            <Warehouse className=\"h-12 w-12 text-muted-foreground mb-3\" />\n            <p className=\"text-muted-foreground\">{t(\"warehouses.noWarehouses\", language)}</p>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":8008,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"/{*path}\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1541,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/pages/cashbox.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Printer, Pencil, Trash2, ArrowRightLeft, Plus, TrendingUp, TrendingDown, Landmark, Link, Truck, Building2 } from \"lucide-react\";\nimport { openPrintWindow } from \"@/lib/printStyles\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport type { Supplier, ShippingCompany } from \"@shared/schema\";\n\nfunction formatDateFr(dateStr: string | null | undefined): string {\n  if (!dateStr) return \"-\";\n  return new Date(dateStr).toLocaleDateString(\"fr-FR\");\n}\n\nexport default function Cashbox() {\n  const { toast } = useToast();\n  const [addDialogOpen, setAddDialogOpen] = useState(false);\n  const [txnType, setTxnType] = useState<\"income\" | \"expense\">(\"income\");\n  const [txnAmount, setTxnAmount] = useState(\"\");\n  const [txnCurrency, setTxnCurrency] = useState(\"CNY\");\n  const [txnDescription, setTxnDescription] = useState(\"\");\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [editTxn, setEditTxn] = useState<any>(null);\n  const [editType, setEditType] = useState<\"income\" | \"expense\">(\"income\");\n  const [editAmount, setEditAmount] = useState(\"\");\n  const [editCurrency, setEditCurrency] = useState(\"CNY\");\n  const [editDescription, setEditDescription] = useState(\"\");\n  const [deleteId, setDeleteId] = useState<number | null>(null);\n  const [exchangeDialogOpen, setExchangeDialogOpen] = useState(false);\n  const [exchangeFromCurrency, setExchangeFromCurrency] = useState(\"CNY\");\n  const [exchangeFromAmount, setExchangeFromAmount] = useState(\"\");\n  const [exchangeRate, setExchangeRate] = useState(\"\");\n  const [exchangeDescription, setExchangeDescription] = useState(\"\");\n  const [supplierPayDialogOpen, setSupplierPayDialogOpen] = useState(false);\n  const [spSupplierId, setSpSupplierId] = useState(\"\");\n  const [spAmount, setSpAmount] = useState(\"\");\n  const [spCurrency, setSpCurrency] = useState(\"CNY\");\n  const [spDescription, setSpDescription] = useState(\"\");\n  const [shippingPayDialogOpen, setShippingPayDialogOpen] = useState(false);\n  const [shpCompanyId, setShpCompanyId] = useState(\"\");\n  const [shpAmount, setShpAmount] = useState(\"\");\n  const [shpCurrency, setShpCurrency] = useState(\"CNY\");\n  const [shpDescription, setShpDescription] = useState(\"\");\n  const [filterType, setFilterType] = useState(\"all\");\n  const [filterCurrency, setFilterCurrency] = useState(\"all\");\n  const printRef = useRef<HTMLDivElement>(null);\n\n  const { data: transactions, isLoading: txnsLoading } = useQuery<any[]>({\n    queryKey: [\"/api/cashbox/transactions\"],\n  });\n\n  const { data: summary, isLoading: summaryLoading } = useQuery<any>({\n    queryKey: [\"/api/cashbox/summary\"],\n  });\n\n  const { data: suppliers } = useQuery<Supplier[]>({\n    queryKey: [\"/api/suppliers\"],\n  });\n\n  const { data: shippingCompanies } = useQuery<ShippingCompany[]>({\n    queryKey: [\"/api/shipping-companies\"],\n  });\n\n  const invalidateCashbox = () => {\n    queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/transactions\"] });\n    queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/summary\"] });\n  };\n\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await apiRequest(\"POST\", \"/api/cashbox/transactions\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      invalidateCashbox();\n      setAddDialogOpen(false);\n      resetAddForm();\n      toast({ title: \"تم تسجيل العملية بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: any }) => {\n      const res = await apiRequest(\"PATCH\", `/api/cashbox/transactions/${id}`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      invalidateCashbox();\n      setEditDialogOpen(false);\n      setEditTxn(null);\n      toast({ title: \"تم تحديث العملية بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/cashbox/transactions/${id}`);\n    },\n    onSuccess: () => {\n      invalidateCashbox();\n      setDeleteId(null);\n      toast({ title: \"تم حذف العملية بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const exchangeMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await apiRequest(\"POST\", \"/api/cashbox/exchange\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      invalidateCashbox();\n      setExchangeDialogOpen(false);\n      setExchangeFromCurrency(\"CNY\");\n      setExchangeFromAmount(\"\");\n      setExchangeRate(\"\");\n      setExchangeDescription(\"\");\n      toast({ title: \"تم تحويل العملة بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const supplierPayMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await apiRequest(\"POST\", \"/api/cashbox/supplier-payment\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      invalidateCashbox();\n      queryClient.invalidateQueries({ queryKey: [\"/api/payments\"] });\n      setSupplierPayDialogOpen(false);\n      setSpSupplierId(\"\");\n      setSpAmount(\"\");\n      setSpCurrency(\"CNY\");\n      setSpDescription(\"\");\n      toast({ title: \"تم تسجيل الدفعة للمورد بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const shippingPayMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await apiRequest(\"POST\", \"/api/cashbox/shipping-payment\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      invalidateCashbox();\n      queryClient.invalidateQueries({ queryKey: [\"/api/shipping-payments\"] });\n      setShippingPayDialogOpen(false);\n      setShpCompanyId(\"\");\n      setShpAmount(\"\");\n      setShpCurrency(\"CNY\");\n      setShpDescription(\"\");\n      toast({ title: \"تم تسجيل الدفعة لشركة الشحن بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const resetAddForm = () => {\n    setTxnType(\"income\");\n    setTxnAmount(\"\");\n    setTxnCurrency(\"CNY\");\n    setTxnDescription(\"\");\n  };\n\n  const handleCreate = () => {\n    if (!txnAmount) return;\n    createMutation.mutate({\n      type: txnType,\n      category: \"other\",\n      amount: parseFloat(txnAmount),\n      currency: txnCurrency,\n      description: txnDescription || null,\n    });\n  };\n\n  const openEdit = (txn: any) => {\n    setEditTxn(txn);\n    setEditType(txn.type);\n    setEditAmount(String(txn.amount));\n    setEditCurrency(txn.currency);\n    setEditDescription(txn.description || \"\");\n    setEditDialogOpen(true);\n  };\n\n  const handleUpdate = () => {\n    if (!editTxn) return;\n    updateMutation.mutate({\n      id: editTxn.id,\n      data: {\n        type: editType,\n        amount: parseFloat(editAmount),\n        currency: editCurrency,\n        description: editDescription || null,\n      },\n    });\n  };\n\n  const toCurrency = exchangeFromCurrency === \"CNY\" ? \"USD\" : \"CNY\";\n  const exchangeRateNum = parseFloat(exchangeRate) || 0;\n  const exchangeFromAmountNum = parseFloat(exchangeFromAmount) || 0;\n  const exchangeToAmount = exchangeRateNum > 0 ? (exchangeFromAmountNum * exchangeRateNum).toFixed(2) : \"\";\n\n  const handleExchange = () => {\n    if (!exchangeFromAmount || !exchangeRate || exchangeRateNum <= 0) return;\n    exchangeMutation.mutate({\n      fromCurrency: exchangeFromCurrency,\n      fromAmount: parseFloat(exchangeFromAmount),\n      toCurrency,\n      toAmount: parseFloat(exchangeToAmount),\n      exchangeRate: exchangeRateNum,\n      description: exchangeDescription || null,\n    });\n  };\n\n  const handleSupplierPay = () => {\n    if (!spSupplierId || !spAmount) return;\n    supplierPayMutation.mutate({\n      supplierId: parseInt(spSupplierId),\n      amount: parseFloat(spAmount),\n      currency: spCurrency,\n      description: spDescription || null,\n    });\n  };\n\n  const handleShippingPay = () => {\n    if (!shpCompanyId || !shpAmount) return;\n    shippingPayMutation.mutate({\n      shippingCompanyId: parseInt(shpCompanyId),\n      amount: parseFloat(shpAmount),\n      currency: shpCurrency,\n      description: shpDescription || null,\n    });\n  };\n\n  const handlePrint = () => {\n    const printContent = printRef.current;\n    if (!printContent) return;\n    openPrintWindow({\n      title: \"صندوق الحسابات\",\n      subtitle: \"إدارة دخول وخروج الأموال\",\n      content: printContent.innerHTML,\n    });\n  };\n\n  const filteredTransactions = (transactions || []).filter((txn: any) => {\n    if (filterType !== \"all\" && txn.type !== filterType) return false;\n    if (filterCurrency !== \"all\" && txn.currency !== filterCurrency) return false;\n    return true;\n  });\n\n  const getCategoryLabel = (cat: string) => {\n    switch (cat) {\n      case \"supplier\": return \"مورد\";\n      case \"shipping\": return \"شركة شحن\";\n      case \"expense\": return \"مصروف\";\n      case \"other\": return \"مصاريف أخرى\";\n      default: return cat;\n    }\n  };\n\n  const getTypeLabel = (type: string) => {\n    return type === \"income\" ? \"دخول\" : \"خروج\";\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-cashbox-title\">صندوق الحسابات</h1>\n          <p className=\"text-muted-foreground\">إدارة دخول وخروج الأموال</p>\n        </div>\n        <div className=\"flex gap-2 flex-wrap\">\n          <Button variant=\"outline\" onClick={handlePrint} data-testid=\"button-print-cashbox\">\n            <Printer className=\"h-4 w-4\" />\n            طباعة\n          </Button>\n          <Dialog open={exchangeDialogOpen} onOpenChange={setExchangeDialogOpen}>\n            <DialogTrigger asChild>\n              <Button variant=\"outline\" data-testid=\"button-exchange-currency\">\n                <ArrowRightLeft className=\"h-4 w-4\" />\n                تحويل عملة\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-md\">\n              <DialogHeader>\n                <DialogTitle>تحويل عملة</DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4 pt-4\">\n                <div className=\"p-3 rounded-md bg-muted text-sm text-muted-foreground\">\n                  سيتم خصم المبلغ من رصيد العملة المحولة منها وإضافته لرصيد العملة المحولة إليها\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>التحويل من</Label>\n                  <Select value={exchangeFromCurrency} onValueChange={setExchangeFromCurrency}>\n                    <SelectTrigger data-testid=\"select-exchange-from\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"CNY\">يوان صيني (CNY)</SelectItem>\n                      <SelectItem value=\"USD\">دولار أمريكي (USD)</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>المبلغ</Label>\n                  <Input\n                    data-testid=\"input-exchange-amount\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={exchangeFromAmount}\n                    onChange={(e) => setExchangeFromAmount(e.target.value)}\n                    placeholder=\"0.00\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>سعر الصرف</Label>\n                  <Input\n                    data-testid=\"input-exchange-rate\"\n                    type=\"number\"\n                    step=\"0.0001\"\n                    value={exchangeRate}\n                    onChange={(e) => setExchangeRate(e.target.value)}\n                    placeholder={exchangeFromCurrency === \"CNY\" ? \"مثال: 0.14\" : \"مثال: 7.2\"}\n                  />\n                </div>\n                {exchangeToAmount && (\n                  <div className=\"p-3 rounded-md bg-muted\">\n                    <p className=\"text-sm\">\n                      المبلغ بعد التحويل إلى {toCurrency === \"CNY\" ? \"يوان\" : \"دولار\"}:{\" \"}\n                      <span className=\"font-bold\">{exchangeToAmount}</span>\n                    </p>\n                  </div>\n                )}\n                <div className=\"space-y-2\">\n                  <Label>ملاحظات (اختياري)</Label>\n                  <Input\n                    data-testid=\"input-exchange-description\"\n                    value={exchangeDescription}\n                    onChange={(e) => setExchangeDescription(e.target.value)}\n                    placeholder=\"ملاحظات إضافية\"\n                  />\n                </div>\n                <Button className=\"w-full\" onClick={handleExchange} disabled={exchangeMutation.isPending || !exchangeFromAmount || !exchangeRate} data-testid=\"button-submit-exchange\">\n                  {exchangeMutation.isPending ? \"جاري التحويل...\" : \"تنفيذ التحويل\"}\n                </Button>\n              </div>\n            </DialogContent>\n          </Dialog>\n          <Dialog open={supplierPayDialogOpen} onOpenChange={setSupplierPayDialogOpen}>\n            <DialogTrigger asChild>\n              <Button variant=\"outline\" data-testid=\"button-pay-supplier\">\n                <Building2 className=\"h-4 w-4\" />\n                دفعة مورد\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-md\">\n              <DialogHeader>\n                <DialogTitle>تسجيل دفعة لمورد</DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4 pt-4\">\n                <div className=\"p-3 rounded-md bg-muted text-sm text-muted-foreground\">\n                  سيتم تسجيل الدفعة في حساب المورد وخصمها من صندوق الحسابات\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>المورد</Label>\n                  <Select value={spSupplierId} onValueChange={setSpSupplierId}>\n                    <SelectTrigger data-testid=\"select-sp-supplier\">\n                      <SelectValue placeholder=\"اختر المورد\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {suppliers?.map((s) => (\n                        <SelectItem key={s.id} value={String(s.id)}>{s.name}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>المبلغ</Label>\n                  <Input\n                    data-testid=\"input-sp-amount\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={spAmount}\n                    onChange={(e) => setSpAmount(e.target.value)}\n                    placeholder=\"0.00\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>العملة</Label>\n                  <Select value={spCurrency} onValueChange={setSpCurrency}>\n                    <SelectTrigger data-testid=\"select-sp-currency\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"CNY\">يوان صيني (CNY)</SelectItem>\n                      <SelectItem value=\"USD\">دولار أمريكي (USD)</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>ملاحظات (اختياري)</Label>\n                  <Input\n                    data-testid=\"input-sp-description\"\n                    value={spDescription}\n                    onChange={(e) => setSpDescription(e.target.value)}\n                    placeholder=\"ملاحظات إضافية\"\n                  />\n                </div>\n                <Button className=\"w-full\" onClick={handleSupplierPay} disabled={supplierPayMutation.isPending || !spSupplierId || !spAmount} data-testid=\"button-submit-sp\">\n                  {supplierPayMutation.isPending ? \"جاري التسجيل...\" : \"تسجيل الدفعة\"}\n                </Button>\n              </div>\n            </DialogContent>\n          </Dialog>\n          <Dialog open={shippingPayDialogOpen} onOpenChange={setShippingPayDialogOpen}>\n            <DialogTrigger asChild>\n              <Button variant=\"outline\" data-testid=\"button-pay-shipping\">\n                <Truck className=\"h-4 w-4\" />\n                دفعة شحن\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-md\">\n              <DialogHeader>\n                <DialogTitle>تسجيل دفعة لشركة شحن</DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4 pt-4\">\n                <div className=\"p-3 rounded-md bg-muted text-sm text-muted-foreground\">\n                  سيتم تسجيل الدفعة في حساب شركة الشحن وخصمها من صندوق الحسابات\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>شركة الشحن</Label>\n                  <Select value={shpCompanyId} onValueChange={setShpCompanyId}>\n                    <SelectTrigger data-testid=\"select-shp-company\">\n                      <SelectValue placeholder=\"اختر شركة الشحن\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {shippingCompanies?.map((sc) => (\n                        <SelectItem key={sc.id} value={String(sc.id)}>{sc.name}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>المبلغ</Label>\n                  <Input\n                    data-testid=\"input-shp-amount\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={shpAmount}\n                    onChange={(e) => setShpAmount(e.target.value)}\n                    placeholder=\"0.00\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>العملة</Label>\n                  <Select value={shpCurrency} onValueChange={setShpCurrency}>\n                    <SelectTrigger data-testid=\"select-shp-currency\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"CNY\">يوان صيني (CNY)</SelectItem>\n                      <SelectItem value=\"USD\">دولار أمريكي (USD)</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>ملاحظات (اختياري)</Label>\n                  <Input\n                    data-testid=\"input-shp-description\"\n                    value={shpDescription}\n                    onChange={(e) => setShpDescription(e.target.value)}\n                    placeholder=\"ملاحظات إضافية\"\n                  />\n                </div>\n                <Button className=\"w-full\" onClick={handleShippingPay} disabled={shippingPayMutation.isPending || !shpCompanyId || !shpAmount} data-testid=\"button-submit-shp\">\n                  {shippingPayMutation.isPending ? \"جاري التسجيل...\" : \"تسجيل الدفعة\"}\n                </Button>\n              </div>\n            </DialogContent>\n          </Dialog>\n          <Dialog open={addDialogOpen} onOpenChange={setAddDialogOpen}>\n            <DialogTrigger asChild>\n              <Button data-testid=\"button-add-transaction\">\n                <Plus className=\"h-4 w-4\" />\n                تسجيل عملية\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-md\">\n              <DialogHeader>\n                <DialogTitle>تسجيل عملية جديدة</DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4 pt-4\">\n                <div className=\"space-y-2\">\n                  <Label>نوع العملية</Label>\n                  <Select value={txnType} onValueChange={(v) => setTxnType(v as \"income\" | \"expense\")}>\n                    <SelectTrigger data-testid=\"select-txn-type\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"income\">دخول أموال</SelectItem>\n                      <SelectItem value=\"expense\">خروج أموال</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>المبلغ</Label>\n                  <Input\n                    data-testid=\"input-txn-amount\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={txnAmount}\n                    onChange={(e) => setTxnAmount(e.target.value)}\n                    placeholder=\"0.00\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>العملة</Label>\n                  <Select value={txnCurrency} onValueChange={setTxnCurrency}>\n                    <SelectTrigger data-testid=\"select-txn-currency\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"CNY\">يوان صيني (CNY)</SelectItem>\n                      <SelectItem value=\"USD\">دولار أمريكي (USD)</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>الوصف</Label>\n                  <Input\n                    data-testid=\"input-txn-description\"\n                    value={txnDescription}\n                    onChange={(e) => setTxnDescription(e.target.value)}\n                    placeholder=\"وصف اختياري\"\n                  />\n                </div>\n                <Button className=\"w-full\" onClick={handleCreate} disabled={createMutation.isPending} data-testid=\"button-submit-transaction\">\n                  {createMutation.isPending ? \"جاري التسجيل...\" : \"تسجيل العملية\"}\n                </Button>\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      {summaryLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4\">\n          {Array.from({ length: 6 }).map((_, i) => (\n            <Skeleton key={i} className=\"h-24\" />\n          ))}\n        </div>\n      ) : summary ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4\" ref={printRef}>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-1\">\n                <TrendingUp className=\"h-4 w-4 text-emerald-600\" />\n                دخول (يوان)\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <span className=\"text-xl font-bold text-emerald-600\" data-testid=\"text-income-cny\">{(summary.incomeCNY || 0).toFixed(2)}</span>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-1\">\n                <TrendingUp className=\"h-4 w-4 text-emerald-600\" />\n                دخول (دولار)\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <span className=\"text-xl font-bold text-emerald-600\" data-testid=\"text-income-usd\">{(summary.incomeUSD || 0).toFixed(2)}</span>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-1\">\n                <TrendingDown className=\"h-4 w-4 text-destructive\" />\n                خروج (يوان)\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <span className=\"text-xl font-bold text-destructive\" data-testid=\"text-expense-cny\">{(summary.expenseCNY || 0).toFixed(2)}</span>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-1\">\n                <TrendingDown className=\"h-4 w-4 text-destructive\" />\n                خروج (دولار)\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <span className=\"text-xl font-bold text-destructive\" data-testid=\"text-expense-usd\">{(summary.expenseUSD || 0).toFixed(2)}</span>\n            </CardContent>\n          </Card>\n          <Card className=\"border-primary/30\">\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium flex items-center gap-1\">\n                <Landmark className=\"h-4 w-4\" />\n                الرصيد (يوان)\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <span className={`text-xl font-bold ${(summary.balanceCNY || 0) >= 0 ? \"text-emerald-600\" : \"text-destructive\"}`} data-testid=\"text-balance-cny\">\n                {(summary.balanceCNY || 0).toFixed(2)}\n              </span>\n            </CardContent>\n          </Card>\n          <Card className=\"border-primary/30\">\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium flex items-center gap-1\">\n                <Landmark className=\"h-4 w-4\" />\n                الرصيد (دولار)\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <span className={`text-xl font-bold ${(summary.balanceUSD || 0) >= 0 ? \"text-emerald-600\" : \"text-destructive\"}`} data-testid=\"text-balance-usd\">\n                {(summary.balanceUSD || 0).toFixed(2)}\n              </span>\n            </CardContent>\n          </Card>\n        </div>\n      ) : null}\n\n      <div className=\"flex items-center gap-4 flex-wrap\">\n        <div className=\"space-y-1\">\n          <Label className=\"text-xs text-muted-foreground\">نوع العملية</Label>\n          <Select value={filterType} onValueChange={setFilterType}>\n            <SelectTrigger className=\"w-36\" data-testid=\"select-filter-type\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">الكل</SelectItem>\n              <SelectItem value=\"income\">دخول</SelectItem>\n              <SelectItem value=\"expense\">خروج</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n        <div className=\"space-y-1\">\n          <Label className=\"text-xs text-muted-foreground\">العملة</Label>\n          <Select value={filterCurrency} onValueChange={setFilterCurrency}>\n            <SelectTrigger className=\"w-36\" data-testid=\"select-filter-currency\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">الكل</SelectItem>\n              <SelectItem value=\"CNY\">يوان</SelectItem>\n              <SelectItem value=\"USD\">دولار</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      {txnsLoading ? (\n        <Skeleton className=\"h-48 w-full\" />\n      ) : filteredTransactions.length > 0 ? (\n        <Card>\n          <CardContent className=\"pt-6\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>التاريخ</TableHead>\n                  <TableHead>النوع</TableHead>\n                  <TableHead>التصنيف</TableHead>\n                  <TableHead>الجهة</TableHead>\n                  <TableHead>المبلغ</TableHead>\n                  <TableHead>العملة</TableHead>\n                  <TableHead>الوصف</TableHead>\n                  <TableHead>إجراءات</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredTransactions.map((txn: any) => (\n                  <TableRow key={txn.id} data-testid={`row-txn-${txn.id}`}>\n                    <TableCell className=\"text-sm\">{formatDateFr(txn.createdAt)}</TableCell>\n                    <TableCell>\n                      <Badge variant={txn.type === \"income\" ? \"default\" : \"destructive\"}>\n                        {getTypeLabel(txn.type)}\n                      </Badge>\n                    </TableCell>\n                    <TableCell className=\"text-sm\">{getCategoryLabel(txn.category)}</TableCell>\n                    <TableCell className=\"text-sm font-medium\">{txn.entityName || \"-\"}</TableCell>\n                    <TableCell className={`font-semibold ${txn.type === \"income\" ? \"text-emerald-600\" : \"text-destructive\"}`}>\n                      {txn.type === \"income\" ? \"+\" : \"-\"}{txn.amount?.toFixed(2)}\n                    </TableCell>\n                    <TableCell className=\"text-sm\">{txn.currency === \"CNY\" ? \"يوان\" : \"دولار\"}</TableCell>\n                    <TableCell className=\"text-sm text-muted-foreground max-w-48 truncate\">{txn.description || \"-\"}</TableCell>\n                    <TableCell>\n                      {txn.paymentId || txn.shippingPaymentId || txn.expenseId ? (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          <Link className=\"h-3 w-3 ml-1\" />\n                          {txn.paymentId ? \"دفعة مورد\" : txn.shippingPaymentId ? \"دفعة شحن\" : \"مصروف\"}\n                        </Badge>\n                      ) : (\n                        <div className=\"flex gap-1\">\n                          <Button size=\"icon\" variant=\"ghost\" onClick={() => openEdit(txn)} data-testid={`button-edit-txn-${txn.id}`}>\n                            <Pencil className=\"h-4 w-4\" />\n                          </Button>\n                          <Button size=\"icon\" variant=\"ghost\" onClick={() => setDeleteId(txn.id)} data-testid={`button-delete-txn-${txn.id}`}>\n                            <Trash2 className=\"h-4 w-4 text-destructive\" />\n                          </Button>\n                        </div>\n                      )}\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      ) : (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n            <Landmark className=\"h-12 w-12 text-muted-foreground mb-3\" />\n            <p className=\"text-muted-foreground\">لا توجد عمليات مسجلة</p>\n          </CardContent>\n        </Card>\n      )}\n\n      <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>تعديل العملية</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"space-y-2\">\n              <Label>نوع العملية</Label>\n              <Select value={editType} onValueChange={(v) => setEditType(v as \"income\" | \"expense\")}>\n                <SelectTrigger data-testid=\"select-edit-txn-type\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"income\">دخول أموال</SelectItem>\n                  <SelectItem value=\"expense\">خروج أموال</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>المبلغ</Label>\n              <Input\n                data-testid=\"input-edit-txn-amount\"\n                type=\"number\"\n                step=\"0.01\"\n                value={editAmount}\n                onChange={(e) => setEditAmount(e.target.value)}\n                placeholder=\"0.00\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>العملة</Label>\n              <Select value={editCurrency} onValueChange={setEditCurrency}>\n                <SelectTrigger data-testid=\"select-edit-txn-currency\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"CNY\">يوان صيني (CNY)</SelectItem>\n                  <SelectItem value=\"USD\">دولار أمريكي (USD)</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>الوصف</Label>\n              <Input\n                data-testid=\"input-edit-txn-description\"\n                value={editDescription}\n                onChange={(e) => setEditDescription(e.target.value)}\n                placeholder=\"وصف اختياري\"\n              />\n            </div>\n            <Button className=\"w-full\" onClick={handleUpdate} disabled={updateMutation.isPending} data-testid=\"button-submit-edit-transaction\">\n              {updateMutation.isPending ? \"جاري التحديث...\" : \"تحديث العملية\"}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={deleteId !== null} onOpenChange={(open) => { if (!open) setDeleteId(null); }}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>تأكيد الحذف</AlertDialogTitle>\n            <AlertDialogDescription>هل أنت متأكد من حذف هذه العملية؟ لا يمكن التراجع عن هذا الإجراء.</AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>إلغاء</AlertDialogCancel>\n            <AlertDialogAction onClick={() => deleteId && deleteMutation.mutate(deleteId)} data-testid=\"button-confirm-delete\">\n              حذف\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":36165,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"server/routes.ts":{"content":"import type { Express, Request, Response, NextFunction } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { insertCategorySchema, insertSupplierSchema, insertWarehouseSchema, insertProductSchema, insertProductPartSchema, insertShippingCompanySchema, insertCashboxTransactionSchema, insertExpenseSchema } from \"@shared/schema\";\nimport bcrypt from \"bcryptjs\";\nimport multer from \"multer\";\nimport * as XLSX from \"xlsx\";\n\nconst upload = multer({ storage: multer.memoryStorage(), limits: { fileSize: 5 * 1024 * 1024 } });\n\nfunction requireAuth(req: Request, res: Response, next: NextFunction) {\n  if (!req.session.userId) {\n    return res.status(401).json({ message: \"غير مصرح\" });\n  }\n  next();\n}\n\nfunction requireAdmin(req: Request, res: Response, next: NextFunction) {\n  if (!req.session.userId || req.session.role !== \"admin\") {\n    return res.status(403).json({ message: \"صلاحيات غير كافية\" });\n  }\n  next();\n}\n\nfunction requireNotWarehouse(req: Request, res: Response, next: NextFunction) {\n  if (!req.session.userId) {\n    return res.status(401).json({ message: \"غير مصرح\" });\n  }\n  if (req.session.role === \"warehouse\") {\n    return res.status(403).json({ message: \"صلاحيات غير كافية\" });\n  }\n  next();\n}\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      const { username, password } = req.body;\n      if (!username || !password) {\n        return res.status(400).json({ message: \"يرجى إدخال اسم المستخدم وكلمة المرور\" });\n      }\n      const user = await storage.getUserByUsername(username);\n      if (!user || !user.active) {\n        return res.status(401).json({ message: \"اسم المستخدم أو كلمة المرور غير صحيحة\" });\n      }\n      const valid = await bcrypt.compare(password, user.password);\n      if (!valid) {\n        return res.status(401).json({ message: \"اسم المستخدم أو كلمة المرور غير صحيحة\" });\n      }\n      req.session.userId = user.id;\n      req.session.role = user.role;\n      const { password: _, ...safeUser } = user;\n      const allowedCategories = await storage.getUserCategories(user.id);\n      res.json({ ...safeUser, allowedCategories });\n    } catch (e: any) {\n      res.status(500).json({ message: e.message });\n    }\n  });\n\n  app.post(\"/api/auth/logout\", (req, res) => {\n    req.session.destroy(() => {\n      res.json({ success: true });\n    });\n  });\n\n  app.get(\"/api/auth/me\", async (req, res) => {\n    if (!req.session.userId) {\n      return res.status(401).json({ message: \"غير مصرح\" });\n    }\n    const user = await storage.getUserById(req.session.userId);\n    if (!user) {\n      return res.status(401).json({ message: \"غير مصرح\" });\n    }\n    const { password: _, ...safeUser } = user;\n    const allowedCategories = await storage.getUserCategories(user.id);\n    res.json({ ...safeUser, allowedCategories });\n  });\n\n  app.get(\"/api/users\", requireAdmin, async (_req, res) => {\n    const allUsers = await storage.getUsers();\n    const result = [];\n    for (const u of allUsers) {\n      const { password: _, ...safeUser } = u;\n      const allowedCategories = await storage.getUserCategories(u.id);\n      result.push({ ...safeUser, allowedCategories });\n    }\n    res.json(result);\n  });\n\n  app.get(\"/api/users/:id/categories\", requireAdmin, async (req, res) => {\n    try {\n      const cats = await storage.getUserCategories(parseInt(req.params.id));\n      res.json(cats);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.put(\"/api/users/:id/categories\", requireAdmin, async (req, res) => {\n    try {\n      const userId = parseInt(req.params.id);\n      const { categoryIds } = req.body;\n      if (!Array.isArray(categoryIds)) {\n        return res.status(400).json({ message: \"يرجى تقديم قائمة الفئات\" });\n      }\n      await storage.setUserCategories(userId, categoryIds);\n      res.json({ success: true });\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.patch(\"/api/auth/profile\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const { username, displayName, currentPassword, newPassword } = req.body;\n\n      const user = await storage.getUserById(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"المستخدم غير موجود\" });\n      }\n\n      const updateData: Partial<{ username: string; password: string; displayName: string }> = {};\n\n      if (username && username !== user.username) {\n        const existing = await storage.getUserByUsername(username);\n        if (existing) {\n          return res.status(400).json({ message: \"اسم المستخدم مستخدم بالفعل\" });\n        }\n        updateData.username = username;\n      }\n\n      if (displayName) {\n        updateData.displayName = displayName;\n      }\n\n      if (newPassword) {\n        if (!currentPassword) {\n          return res.status(400).json({ message: \"يرجى إدخال كلمة المرور الحالية\" });\n        }\n        const valid = await bcrypt.compare(currentPassword, user.password);\n        if (!valid) {\n          return res.status(400).json({ message: \"كلمة المرور الحالية غير صحيحة\" });\n        }\n        updateData.password = await bcrypt.hash(newPassword, 10);\n      }\n\n      if (Object.keys(updateData).length === 0) {\n        return res.status(400).json({ message: \"لا توجد تغييرات\" });\n      }\n\n      const updated = await storage.updateUser(userId, updateData);\n      if (!updated) {\n        return res.status(500).json({ message: \"فشل في التحديث\" });\n      }\n      const { password: _, ...safeUser } = updated;\n      const allowedCategories = await storage.getUserCategories(updated.id);\n      res.json({ ...safeUser, allowedCategories });\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.post(\"/api/users\", requireAdmin, async (req, res) => {\n    try {\n      const { username, password, displayName, role } = req.body;\n      if (!username || !password || !displayName) {\n        return res.status(400).json({ message: \"يرجى ملء جميع الحقول\" });\n      }\n      const validRoles = [\"admin\", \"user\", \"warehouse\"];\n      if (role && !validRoles.includes(role)) {\n        return res.status(400).json({ message: \"صلاحية غير صالحة\" });\n      }\n      const existing = await storage.getUserByUsername(username);\n      if (existing) {\n        return res.status(400).json({ message: \"اسم المستخدم مستخدم بالفعل\" });\n      }\n      const hashed = await bcrypt.hash(password, 10);\n      const user = await storage.createUser({ username, password: hashed, displayName, role: role || \"user\" });\n      const { password: _, ...safeUser } = user;\n      res.json(safeUser);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.get(\"/api/categories\", requireAuth, async (_req, res) => {\n    const cats = await storage.getCategories();\n    res.json(cats);\n  });\n\n  app.post(\"/api/categories\", requireAuth, async (req, res) => {\n    try {\n      const parsed = insertCategorySchema.parse(req.body);\n      const cat = await storage.createCategory(parsed);\n      res.json(cat);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.get(\"/api/suppliers\", requireAuth, async (_req, res) => {\n    const sups = await storage.getSuppliers();\n    res.json(sups);\n  });\n\n  app.post(\"/api/suppliers\", requireAuth, async (req, res) => {\n    try {\n      const parsed = insertSupplierSchema.parse(req.body);\n      const sup = await storage.createSupplier(parsed);\n      res.json(sup);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.patch(\"/api/suppliers/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const updated = await storage.updateSupplier(id, req.body);\n      if (!updated) return res.status(404).json({ message: \"المورد غير موجود\" });\n      res.json(updated);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.delete(\"/api/suppliers/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteSupplier(id);\n      res.json({ success: true });\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.patch(\"/api/categories/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const parsed = insertCategorySchema.partial().parse(req.body);\n      const updated = await storage.updateCategory(id, parsed);\n      if (!updated) return res.status(404).json({ message: \"الفئة غير موجودة\" });\n      res.json(updated);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.delete(\"/api/categories/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteCategory(id);\n      res.json({ success: true });\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.get(\"/api/warehouses\", requireAuth, async (_req, res) => {\n    const whs = await storage.getWarehouses();\n    res.json(whs);\n  });\n\n  app.post(\"/api/warehouses\", requireAuth, async (req, res) => {\n    try {\n      const parsed = insertWarehouseSchema.parse(req.body);\n      const wh = await storage.createWarehouse(parsed);\n      res.json(wh);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.patch(\"/api/warehouses/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const updated = await storage.updateWarehouse(id, req.body);\n      res.json(updated);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.delete(\"/api/warehouses/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteWarehouse(id);\n      res.json({ success: true });\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  // Shipping Companies\n  app.get(\"/api/shipping-companies\", requireAuth, async (_req, res) => {\n    const companies = await storage.getShippingCompanies();\n    res.json(companies);\n  });\n\n  app.post(\"/api/shipping-companies\", requireAuth, async (req, res) => {\n    try {\n      const parsed = insertShippingCompanySchema.parse(req.body);\n      const sc = await storage.createShippingCompany(parsed);\n      res.json(sc);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.patch(\"/api/shipping-companies/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const updated = await storage.updateShippingCompany(id, req.body);\n      if (!updated) return res.status(404).json({ message: \"شركة الشحن غير موجودة\" });\n      res.json(updated);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.delete(\"/api/shipping-companies/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteShippingCompany(id);\n      res.json({ success: true });\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.get(\"/api/shipping-companies/:id/account\", requireAuth, async (req, res) => {\n    try {\n      const account = await storage.getShippingCompanyAccount(parseInt(req.params.id));\n      res.json(account);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.get(\"/api/products\", requireAuth, async (req, res) => {\n    const prods = await storage.getProducts();\n    if (req.session.role === \"admin\") {\n      return res.json(prods);\n    }\n    const allowedCats = await storage.getUserCategories(req.session.userId!);\n    if (allowedCats.length === 0) {\n      return res.json([]);\n    }\n    const filtered = prods.filter(p => p.categoryId && allowedCats.includes(p.categoryId));\n    res.json(filtered);\n  });\n\n  app.post(\"/api/products\", requireAuth, async (req, res) => {\n    try {\n      if (req.session.role !== \"admin\") {\n        const allowedCats = await storage.getUserCategories(req.session.userId!);\n        if (!req.body.categoryId || !allowedCats.includes(req.body.categoryId)) {\n          return res.status(403).json({ message: \"ليس لديك صلاحية لإنشاء منتج في هذه الفئة\" });\n        }\n      }\n      const prod = await storage.createProduct(req.body);\n      res.json(prod);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.patch(\"/api/products/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const allowedFields = [\"quantity\", \"name\", \"categoryId\", \"status\"];\n      const updateData: Record<string, any> = {};\n      for (const key of allowedFields) {\n        if (req.body[key] !== undefined) {\n          updateData[key] = req.body[key];\n        }\n      }\n      if (Object.keys(updateData).length === 0) {\n        return res.status(400).json({ message: \"لا توجد بيانات للتحديث\" });\n      }\n      if (updateData.status) {\n        updateData.statusChangedAt = new Date();\n      }\n      const updated = await storage.updateProduct(id, updateData);\n      if (!updated) return res.status(404).json({ message: \"المنتج غير موجود\" });\n      res.json(updated);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.delete(\"/api/products/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteProduct(id);\n      res.json({ success: true });\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.post(\"/api/products/import\", requireAuth, upload.single(\"file\"), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ message: \"يرجى رفع ملف\" });\n      }\n      const workbook = XLSX.read(req.file.buffer, { type: \"buffer\" });\n      const sheetName = workbook.SheetNames[0];\n      const sheet = workbook.Sheets[sheetName];\n      const rows: any[][] = XLSX.utils.sheet_to_json(sheet, { header: 1 });\n\n      if (rows.length === 0) {\n        return res.status(400).json({ message: \"الملف فارغ\" });\n      }\n\n      const allCategories = await storage.getCategories();\n      const imported: any[] = [];\n\n      const allowedCats = req.session.role === \"admin\"\n        ? null\n        : await storage.getUserCategories(req.session.userId!);\n\n      for (const row of rows) {\n        const name = row[0] ? String(row[0]).trim() : \"\";\n        const quantity = parseInt(String(row[1] || \"0\")) || 0;\n        const categoryName = row[2] ? String(row[2]).trim() : \"\";\n\n        if (!name) continue;\n\n        let categoryId: number | null = null;\n        if (categoryName) {\n          const found = allCategories.find(c => c.name === categoryName);\n          if (found) categoryId = found.id;\n        }\n\n        if (allowedCats && (!categoryId || !allowedCats.includes(categoryId))) continue;\n\n        const prod = await storage.createProduct({ name, quantity, categoryId, status: \"purchase_order\" });\n        imported.push(prod);\n      }\n\n      res.json({ imported: imported.length, products: imported });\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.get(\"/api/orders\", requireAuth, async (_req, res) => {\n    const ords = await storage.getOrders();\n    res.json(ords);\n  });\n\n  app.post(\"/api/orders\", requireNotWarehouse, async (req, res) => {\n    try {\n      const { supplierId, items } = req.body;\n      const order = await storage.createOrder(supplierId, items);\n      res.json(order);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.patch(\"/api/order-items/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const updated = await storage.updateOrderItem(id, req.body);\n      if (!updated) return res.status(404).json({ message: \"عنصر الطلب غير موجود\" });\n      res.json(updated);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.get(\"/api/suppliers/:id/ordered-items\", requireAuth, async (req, res) => {\n    try {\n      const items = await storage.getSupplierOrderedItems(parseInt(req.params.id));\n      res.json(items);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.get(\"/api/deliveries\", requireAuth, async (_req, res) => {\n    const dels = await storage.getDeliveries();\n    res.json(dels);\n  });\n\n  app.post(\"/api/deliveries\", requireAuth, async (req, res) => {\n    try {\n      const { supplierId, warehouseId, items } = req.body;\n      const delivery = await storage.createDelivery(supplierId, warehouseId, items);\n      res.json(delivery);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.get(\"/api/containers\", requireAuth, async (_req, res) => {\n    const containersList = await storage.getContainers();\n    res.json(containersList);\n  });\n\n  app.post(\"/api/containers\", requireAuth, async (req, res) => {\n    try {\n      const { items, ...data } = req.body;\n      const container = await storage.createContainer(data, items);\n      res.json(container);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.patch(\"/api/containers/:id\", requireAuth, async (req, res) => {\n    try {\n      const container = await storage.updateContainer(parseInt(req.params.id), req.body);\n      res.json(container);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.patch(\"/api/containers/:id/arrive\", requireAuth, async (req, res) => {\n    try {\n      const container = await storage.markContainerArrived(parseInt(req.params.id));\n      res.json(container);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.get(\"/api/container-documents\", requireAuth, async (_req, res) => {\n    try {\n      const docs = await storage.getContainerDocuments();\n      res.json(docs);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.patch(\"/api/container-documents/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const existing = await storage.getContainerDocument(id);\n      if (!existing) return res.status(404).json({ message: \"not found\" });\n\n      const updateData: any = {};\n      if (typeof req.body.shippingBill === \"boolean\") updateData.shippingBill = req.body.shippingBill;\n      if (typeof req.body.originCertificate === \"boolean\") updateData.originCertificate = req.body.originCertificate;\n      if (typeof req.body.conformityCertificate === \"boolean\") updateData.conformityCertificate = req.body.conformityCertificate;\n      if (req.body.invoice !== undefined) updateData.invoice = req.body.invoice || null;\n\n      if (req.body.moneyArrival !== undefined) {\n        const newAmount = req.body.moneyArrival ? parseFloat(String(req.body.moneyArrival)) : null;\n        const currency = (req.body.moneyArrivalCurrency === \"CNY\" || req.body.moneyArrivalCurrency === \"USD\")\n          ? req.body.moneyArrivalCurrency : (existing.moneyArrivalCurrency || \"CNY\");\n        updateData.moneyArrival = newAmount;\n        updateData.moneyArrivalCurrency = newAmount ? currency : null;\n\n        if (newAmount && newAmount > 0) {\n          if (existing.cashboxTransactionId) {\n            await storage.updateCashboxTransaction(existing.cashboxTransactionId, {\n              amount: newAmount,\n              currency,\n              description: `وصول أموال - فاتورة ${existing.invoiceNumber}`,\n            });\n          } else {\n            const txn = await storage.createCashboxTransaction({\n              type: \"income\",\n              category: \"other\",\n              amount: newAmount,\n              currency,\n              description: `وصول أموال - فاتورة ${existing.invoiceNumber}`,\n            });\n            updateData.cashboxTransactionId = txn.id;\n          }\n        } else if (!newAmount && existing.cashboxTransactionId) {\n          await storage.deleteCashboxTransaction(existing.cashboxTransactionId);\n          updateData.cashboxTransactionId = null;\n        }\n      }\n\n      const updated = await storage.updateContainerDocument(id, updateData);\n      res.json(updated);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.post(\"/api/container-documents/merge\", requireAuth, async (req, res) => {\n    try {\n      const { docIds, groupInvoiceNumber } = req.body;\n      if (!docIds || !Array.isArray(docIds) || docIds.length < 2) {\n        return res.status(400).json({ message: \"يجب اختيار حاويتين على الأقل\" });\n      }\n      for (const id of docIds) {\n        const doc = await storage.getContainerDocument(id);\n        if (!doc) return res.status(400).json({ message: `الفاتورة ${id} غير موجودة` });\n      }\n      const groupId = docIds[0];\n      for (const id of docIds) {\n        await storage.updateContainerDocument(id, { groupInvoiceId: groupId });\n      }\n      if (groupInvoiceNumber) {\n        await storage.updateContainerDocument(groupId, { invoiceNumber: groupInvoiceNumber });\n      }\n      res.json({ success: true });\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.post(\"/api/container-documents/unmerge\", requireAuth, async (req, res) => {\n    try {\n      const { docId } = req.body;\n      const doc = await storage.getContainerDocument(docId);\n      if (!doc || !doc.groupInvoiceId) return res.status(404).json({ message: \"not found\" });\n      const groupId = doc.groupInvoiceId;\n      const allDocs = await storage.getContainerDocuments();\n      const grouped = allDocs.filter((d: any) => d.groupInvoiceId === groupId);\n      for (const d of grouped) {\n        await storage.updateContainerDocument(d.id, { groupInvoiceId: null });\n      }\n      res.json({ success: true });\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.get(\"/api/suppliers/:id/account\", requireAuth, async (req, res) => {\n    try {\n      const account = await storage.getSupplierAccount(parseInt(req.params.id));\n      res.json(account);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.get(\"/api/warehouse-inventory\", requireAuth, async (_req, res) => {\n    try {\n      const inventory = await storage.getWarehouseInventory();\n      res.json(inventory);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.get(\"/api/products/:id/parts\", requireAuth, async (req, res) => {\n    try {\n      const parts = await storage.getProductParts(parseInt(req.params.id));\n      res.json(parts);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.post(\"/api/products/:id/parts\", requireAuth, async (req, res) => {\n    try {\n      const productId = parseInt(req.params.id);\n      const parsed = insertProductPartSchema.parse({ ...req.body, productId });\n      const part = await storage.createProductPart(parsed);\n      res.json(part);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.delete(\"/api/product-parts/:id\", requireAuth, async (req, res) => {\n    try {\n      await storage.deleteProductPart(parseInt(req.params.id));\n      res.json({ success: true });\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.post(\"/api/payments\", requireAuth, async (req, res) => {\n    try {\n      const payment = await storage.createPayment(req.body);\n      const allSuppliers = await storage.getSuppliers();\n      const supplier = allSuppliers.find(s => s.id === payment.supplierId);\n      await storage.createCashboxTransaction({\n        type: \"expense\",\n        category: \"supplier\",\n        amount: payment.amount,\n        currency: payment.currency,\n        supplierId: payment.supplierId,\n        paymentId: payment.id,\n        description: `دفعة للمورد: ${supplier?.name || \"\"}${payment.note ? \" - \" + payment.note : \"\"}`,\n      });\n      res.json(payment);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.patch(\"/api/payments/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { amount, currency, note } = req.body;\n      const updateData: Record<string, any> = {};\n      if (amount !== undefined) updateData.amount = amount;\n      if (currency !== undefined) updateData.currency = currency;\n      if (note !== undefined) updateData.note = note;\n      if (Object.keys(updateData).length === 0) {\n        return res.status(400).json({ message: \"لا توجد بيانات للتحديث\" });\n      }\n      const updated = await storage.updatePayment(id, updateData);\n      if (!updated) return res.status(404).json({ message: \"الدفعة غير موجودة\" });\n      const cashboxUpdate: Record<string, any> = {};\n      if (amount !== undefined) cashboxUpdate.amount = amount;\n      if (currency !== undefined) cashboxUpdate.currency = currency;\n      if (note !== undefined) {\n        const allSuppliers = await storage.getSuppliers();\n        const supplier = allSuppliers.find(s => s.id === updated.supplierId);\n        cashboxUpdate.description = `دفعة للمورد: ${supplier?.name || \"\"}${note ? \" - \" + note : \"\"}`;\n      }\n      await storage.updateCashboxByPaymentId(id, cashboxUpdate);\n      res.json(updated);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.delete(\"/api/payments/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteCashboxByPaymentId(id);\n      await storage.deletePayment(id);\n      res.json({ success: true });\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  // Cashbox\n  app.get(\"/api/cashbox/transactions\", requireAuth, async (_req, res) => {\n    try {\n      const txns = await storage.getCashboxTransactions();\n      res.json(txns);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.get(\"/api/cashbox/summary\", requireAuth, async (_req, res) => {\n    try {\n      const summary = await storage.getCashboxSummary();\n      res.json(summary);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.post(\"/api/cashbox/transactions\", requireAuth, async (req, res) => {\n    try {\n      const parsed = insertCashboxTransactionSchema.parse(req.body);\n      const txn = await storage.createCashboxTransaction(parsed);\n      res.json(txn);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.patch(\"/api/cashbox/transactions/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const existing = await storage.getCashboxTransactions();\n      const txn = existing.find((t: any) => t.id === id);\n      if (txn && (txn.paymentId || txn.shippingPaymentId || txn.expenseId)) {\n        return res.status(400).json({ message: \"لا يمكن تعديل عملية مرتبطة بدفعة أو مصروف، قم بالتعديل من الصفحة المعنية\" });\n      }\n      const partial = insertCashboxTransactionSchema.partial().parse(req.body);\n      const updated = await storage.updateCashboxTransaction(id, partial);\n      if (!updated) return res.status(404).json({ message: \"العملية غير موجودة\" });\n      res.json(updated);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.delete(\"/api/cashbox/transactions/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const existing = await storage.getCashboxTransactions();\n      const txn = existing.find((t: any) => t.id === id);\n      if (txn && (txn.paymentId || txn.shippingPaymentId || txn.expenseId)) {\n        return res.status(400).json({ message: \"لا يمكن حذف عملية مرتبطة بدفعة أو مصروف، قم بالحذف من الصفحة المعنية\" });\n      }\n      await storage.deleteCashboxTransaction(id);\n      res.json({ success: true });\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  // Currency Exchange in Cashbox\n  app.post(\"/api/cashbox/exchange\", requireAuth, async (req, res) => {\n    try {\n      const { fromCurrency, fromAmount, toCurrency, toAmount, exchangeRate, description } = req.body;\n      if (!fromCurrency || !toCurrency || !fromAmount || !toAmount || !exchangeRate) {\n        return res.status(400).json({ message: \"جميع الحقول مطلوبة\" });\n      }\n      if (fromCurrency === toCurrency) {\n        return res.status(400).json({ message: \"يجب اختيار عملتين مختلفتين\" });\n      }\n      const rateNote = `تحويل ${parseFloat(fromAmount).toFixed(2)} ${fromCurrency === \"CNY\" ? \"يوان\" : \"دولار\"} → ${parseFloat(toAmount).toFixed(2)} ${toCurrency === \"CNY\" ? \"يوان\" : \"دولار\"} | سعر الصرف: ${exchangeRate}`;\n      const descSuffix = description ? ` | ${description}` : \"\";\n      const expenseTxn = await storage.createCashboxTransaction({\n        type: \"expense\",\n        category: \"other\",\n        amount: parseFloat(fromAmount),\n        currency: fromCurrency,\n        description: rateNote + descSuffix,\n      });\n      const incomeTxn = await storage.createCashboxTransaction({\n        type: \"income\",\n        category: \"other\",\n        amount: parseFloat(toAmount),\n        currency: toCurrency,\n        description: rateNote + descSuffix,\n      });\n      res.json({ expenseTxn, incomeTxn });\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  // Cashbox Supplier Payment (linked to supplier accounts)\n  app.post(\"/api/cashbox/supplier-payment\", requireAuth, async (req, res) => {\n    try {\n      const { supplierId, amount, currency, description } = req.body;\n      if (!supplierId || !amount) {\n        return res.status(400).json({ message: \"المورد والمبلغ مطلوبان\" });\n      }\n      const payment = await storage.createPayment({\n        supplierId: parseInt(supplierId),\n        amount: parseFloat(amount),\n        currency: currency || \"CNY\",\n        note: description || null,\n      });\n      const allSuppliers = await storage.getSuppliers();\n      const supplier = allSuppliers.find(s => s.id === payment.supplierId);\n      await storage.createCashboxTransaction({\n        type: \"expense\",\n        category: \"supplier\",\n        amount: payment.amount,\n        currency: payment.currency,\n        supplierId: payment.supplierId,\n        paymentId: payment.id,\n        description: `دفعة للمورد: ${supplier?.name || \"\"}${payment.note ? \" - \" + payment.note : \"\"}`,\n      });\n      res.json(payment);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  // Cashbox Shipping Payment (linked to shipping company accounts)\n  app.post(\"/api/cashbox/shipping-payment\", requireAuth, async (req, res) => {\n    try {\n      const { shippingCompanyId, amount, currency, description } = req.body;\n      if (!shippingCompanyId || !amount) {\n        return res.status(400).json({ message: \"شركة الشحن والمبلغ مطلوبان\" });\n      }\n      const payment = await storage.createShippingPayment({\n        shippingCompanyId: parseInt(shippingCompanyId),\n        amount: parseFloat(amount),\n        currency: currency || \"CNY\",\n        note: description || null,\n      });\n      const companies = await storage.getShippingCompanies();\n      const company = companies.find(c => c.id === payment.shippingCompanyId);\n      await storage.createCashboxTransaction({\n        type: \"expense\",\n        category: \"shipping\",\n        amount: payment.amount,\n        currency: payment.currency,\n        shippingCompanyId: payment.shippingCompanyId,\n        shippingPaymentId: payment.id,\n        description: `دفعة لشركة الشحن: ${company?.name || \"\"}${payment.note ? \" - \" + payment.note : \"\"}`,\n      });\n      res.json(payment);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  // Shipping Payments\n  app.post(\"/api/shipping-payments\", requireAuth, async (req, res) => {\n    try {\n      const payment = await storage.createShippingPayment(req.body);\n      const companies = await storage.getShippingCompanies();\n      const company = companies.find(c => c.id === payment.shippingCompanyId);\n      await storage.createCashboxTransaction({\n        type: \"expense\",\n        category: \"shipping\",\n        amount: payment.amount,\n        currency: payment.currency,\n        shippingCompanyId: payment.shippingCompanyId,\n        shippingPaymentId: payment.id,\n        description: `دفعة لشركة الشحن: ${company?.name || \"\"}${payment.note ? \" - \" + payment.note : \"\"}`,\n      });\n      res.json(payment);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.patch(\"/api/shipping-payments/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { amount, currency, note } = req.body;\n      const updateData: Record<string, any> = {};\n      if (amount !== undefined) updateData.amount = amount;\n      if (currency !== undefined) updateData.currency = currency;\n      if (note !== undefined) updateData.note = note;\n      if (Object.keys(updateData).length === 0) {\n        return res.status(400).json({ message: \"لا توجد بيانات للتحديث\" });\n      }\n      const updated = await storage.updateShippingPayment(id, updateData);\n      if (!updated) return res.status(404).json({ message: \"الدفعة غير موجودة\" });\n      const cashboxUpdate: Record<string, any> = {};\n      if (amount !== undefined) cashboxUpdate.amount = amount;\n      if (currency !== undefined) cashboxUpdate.currency = currency;\n      if (note !== undefined) {\n        const companies = await storage.getShippingCompanies();\n        const company = companies.find(c => c.id === updated.shippingCompanyId);\n        cashboxUpdate.description = `دفعة لشركة الشحن: ${company?.name || \"\"}${note ? \" - \" + note : \"\"}`;\n      }\n      await storage.updateCashboxByShippingPaymentId(id, cashboxUpdate);\n      res.json(updated);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.delete(\"/api/shipping-payments/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteCashboxByShippingPaymentId(id);\n      await storage.deleteShippingPayment(id);\n      res.json({ success: true });\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.get(\"/api/expenses\", requireAuth, async (_req, res) => {\n    try {\n      const list = await storage.getExpenses();\n      res.json(list);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.post(\"/api/expenses\", requireAuth, async (req, res) => {\n    try {\n      const parsed = insertExpenseSchema.parse(req.body);\n      const expense = await storage.createExpense(parsed);\n      await storage.createCashboxTransaction({\n        type: \"expense\",\n        category: \"expense\",\n        amount: expense.amount,\n        currency: expense.currency,\n        expenseId: expense.id,\n        description: `مصروف: ${expense.title}${expense.description ? \" - \" + expense.description : \"\"}`,\n      });\n      res.json(expense);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.patch(\"/api/expenses/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { title, amount, currency, description } = req.body;\n      const updateData: Record<string, any> = {};\n      if (title !== undefined) updateData.title = title;\n      if (amount !== undefined) updateData.amount = amount;\n      if (currency !== undefined) updateData.currency = currency;\n      if (description !== undefined) updateData.description = description;\n      if (Object.keys(updateData).length === 0) {\n        return res.status(400).json({ message: \"لا توجد بيانات للتحديث\" });\n      }\n      const updated = await storage.updateExpense(id, updateData);\n      if (!updated) return res.status(404).json({ message: \"المصروف غير موجود\" });\n      const cashboxUpdate: Record<string, any> = {};\n      if (amount !== undefined) cashboxUpdate.amount = amount;\n      if (currency !== undefined) cashboxUpdate.currency = currency;\n      cashboxUpdate.description = `مصروف: ${updated.title}${updated.description ? \" - \" + updated.description : \"\"}`;\n      await storage.updateCashboxByExpenseId(id, cashboxUpdate);\n      res.json(updated);\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  app.delete(\"/api/expenses/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteCashboxByExpenseId(id);\n      await storage.deleteExpense(id);\n      res.json({ success: true });\n    } catch (e: any) {\n      res.status(400).json({ message: e.message });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":38132,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/pages/categories.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Plus, FolderOpen, Trash2, Pencil } from \"lucide-react\";\nimport type { Category } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\nexport default function Categories() {\n  const { toast } = useToast();\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [selectedCategory, setSelectedCategory] = useState<Category | null>(null);\n  const [name, setName] = useState(\"\");\n  const [editName, setEditName] = useState(\"\");\n\n  const { data: categories, isLoading } = useQuery<Category[]>({\n    queryKey: [\"/api/categories\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: { name: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/categories\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/categories\"] });\n      setDialogOpen(false);\n      setName(\"\");\n      toast({ title: \"تم إنشاء الفئة بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, name }: { id: number; name: string }) => {\n      const res = await apiRequest(\"PATCH\", `/api/categories/${id}`, { name });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/categories\"] });\n      setEditDialogOpen(false);\n      setSelectedCategory(null);\n      setEditName(\"\");\n      toast({ title: \"تم تعديل الفئة بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/categories/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/categories\"] });\n      setDeleteDialogOpen(false);\n      setSelectedCategory(null);\n      toast({ title: \"تم حذف الفئة بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ في الحذف\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const handleCreate = () => {\n    if (!name.trim()) {\n      toast({ title: \"يرجى إدخال اسم الفئة\", variant: \"destructive\" });\n      return;\n    }\n    createMutation.mutate({ name: name.trim() });\n  };\n\n  const handleEdit = () => {\n    if (!editName.trim() || !selectedCategory) {\n      toast({ title: \"يرجى إدخال اسم الفئة\", variant: \"destructive\" });\n      return;\n    }\n    updateMutation.mutate({ id: selectedCategory.id, name: editName.trim() });\n  };\n\n  const openEdit = (cat: Category) => {\n    setSelectedCategory(cat);\n    setEditName(cat.name);\n    setEditDialogOpen(true);\n  };\n\n  const openDelete = (cat: Category) => {\n    setSelectedCategory(cat);\n    setDeleteDialogOpen(true);\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-categories-title\">الفئات</h1>\n          <p className=\"text-muted-foreground\">إدارة فئات المنتجات</p>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-add-category\">\n              <Plus className=\"h-4 w-4\" />\n              إضافة فئة\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>إضافة فئة جديدة</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4 pt-4\">\n              <div className=\"space-y-2\">\n                <Label>اسم الفئة</Label>\n                <Input\n                  data-testid=\"input-category-name\"\n                  value={name}\n                  onChange={(e) => setName(e.target.value)}\n                  placeholder=\"أدخل اسم الفئة\"\n                />\n              </div>\n              <Button\n                data-testid=\"button-submit-category\"\n                className=\"w-full\"\n                onClick={handleCreate}\n                disabled={createMutation.isPending}\n              >\n                {createMutation.isPending ? \"جاري الإنشاء...\" : \"إنشاء الفئة\"}\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {Array.from({ length: 3 }).map((_, i) => (\n            <Card key={i}><CardContent className=\"p-6\"><Skeleton className=\"h-6 w-32\" /></CardContent></Card>\n          ))}\n        </div>\n      ) : categories && categories.length > 0 ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {categories.map((cat) => (\n            <Card key={cat.id} className=\"hover-elevate\" data-testid={`card-category-${cat.id}`}>\n              <CardContent className=\"flex items-center gap-3 p-6\">\n                <div className=\"flex h-10 w-10 items-center justify-center rounded-md bg-primary/10 shrink-0\">\n                  <FolderOpen className=\"h-5 w-5 text-primary\" />\n                </div>\n                <h3 className=\"font-semibold flex-1\">{cat.name}</h3>\n                <Button\n                  size=\"icon\"\n                  variant=\"ghost\"\n                  onClick={() => openEdit(cat)}\n                  data-testid={`button-edit-category-${cat.id}`}\n                >\n                  <Pencil className=\"h-4 w-4\" />\n                </Button>\n                <Button\n                  size=\"icon\"\n                  variant=\"ghost\"\n                  onClick={() => openDelete(cat)}\n                  data-testid={`button-delete-category-${cat.id}`}\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n            <FolderOpen className=\"h-12 w-12 text-muted-foreground mb-3\" />\n            <p className=\"text-muted-foreground\">لا توجد فئات</p>\n          </CardContent>\n        </Card>\n      )}\n\n      <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>تعديل الفئة</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"space-y-2\">\n              <Label>اسم الفئة</Label>\n              <Input\n                data-testid=\"input-edit-category-name\"\n                value={editName}\n                onChange={(e) => setEditName(e.target.value)}\n                placeholder=\"أدخل اسم الفئة\"\n              />\n            </div>\n            <Button\n              data-testid=\"button-submit-edit-category\"\n              className=\"w-full\"\n              onClick={handleEdit}\n              disabled={updateMutation.isPending}\n            >\n              {updateMutation.isPending ? \"جاري التعديل...\" : \"تعديل الفئة\"}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>حذف الفئة</AlertDialogTitle>\n            <AlertDialogDescription>\n              هل أنت متأكد من حذف الفئة \"{selectedCategory?.name}\"؟ لا يمكن التراجع عن هذا الإجراء.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter className=\"flex gap-2\">\n            <AlertDialogCancel data-testid=\"button-cancel-delete-category\">إلغاء</AlertDialogCancel>\n            <AlertDialogAction\n              data-testid=\"button-confirm-delete-category\"\n              onClick={() => selectedCategory && deleteMutation.mutate(selectedCategory.id)}\n              className=\"bg-destructive text-destructive-foreground\"\n            >\n              {deleteMutation.isPending ? \"جاري الحذف...\" : \"حذف\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":9390,"size_tokens":null},"client/src/App.tsx":{"content":"import { useState, useEffect, createContext, useContext } from \"react\";\nimport { Switch, Route, Redirect } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/app-sidebar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { LogOut, Languages, Settings, Eye, EyeOff } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport NotFound from \"@/pages/not-found\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Products from \"@/pages/products\";\nimport Suppliers from \"@/pages/suppliers\";\nimport Categories from \"@/pages/categories\";\nimport Warehouses from \"@/pages/warehouses\";\nimport Orders from \"@/pages/orders\";\nimport Deliveries from \"@/pages/deliveries\";\nimport Shipping from \"@/pages/shipping\";\nimport Arrivals from \"@/pages/arrivals\";\nimport SupplierAccounts from \"@/pages/supplier-accounts\";\nimport ShippingAccounts from \"@/pages/shipping-accounts\";\nimport WarehouseInventory from \"@/pages/warehouse-inventory\";\nimport Login from \"@/pages/login\";\nimport UserManagement from \"@/pages/user-management\";\nimport Cashbox from \"@/pages/cashbox\";\nimport Expenses from \"@/pages/expenses\";\nimport ContainerInvoices from \"@/pages/container-invoices\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useStatusAlerts } from \"@/hooks/use-status-alerts\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { LanguageContext, useLanguage } from \"@/lib/language-context\";\nimport type { Language } from \"@/lib/translations\";\nimport { t } from \"@/lib/translations\";\n\ninterface AuthUser {\n  id: number;\n  username: string;\n  displayName: string;\n  role: string;\n  allowedCategories: number[];\n}\n\ninterface AuthContextType {\n  user: AuthUser | null;\n  setUser: (user: AuthUser | null) => void;\n}\n\nexport const AuthContext = createContext<AuthContextType>({ user: null, setUser: () => {} });\n\nexport function useAuth() {\n  return useContext(AuthContext);\n}\n\nfunction AdminRoute({ component: Component }: { component: React.ComponentType }) {\n  const { user } = useAuth();\n  if (user?.role !== \"admin\") return <Redirect to=\"/\" />;\n  return <Component />;\n}\n\nfunction NonWarehouseRoute({ component: Component }: { component: React.ComponentType }) {\n  const { user } = useAuth();\n  if (user?.role === \"warehouse\") return <Redirect to=\"/\" />;\n  return <Component />;\n}\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Dashboard} />\n      <Route path=\"/products\" component={Products} />\n      <Route path=\"/suppliers\">{() => <NonWarehouseRoute component={Suppliers} />}</Route>\n      <Route path=\"/categories\">{() => <NonWarehouseRoute component={Categories} />}</Route>\n      <Route path=\"/warehouses\" component={Warehouses} />\n      <Route path=\"/orders\" component={Orders} />\n      <Route path=\"/deliveries\" component={Deliveries} />\n      <Route path=\"/shipping\" component={Shipping} />\n      <Route path=\"/arrivals\">{() => <AdminRoute component={Arrivals} />}</Route>\n      <Route path=\"/supplier-accounts\">{() => <AdminRoute component={SupplierAccounts} />}</Route>\n      <Route path=\"/shipping-accounts\">{() => <AdminRoute component={ShippingAccounts} />}</Route>\n      <Route path=\"/warehouse-inventory\" component={WarehouseInventory} />\n      <Route path=\"/users\">{() => <AdminRoute component={UserManagement} />}</Route>\n      <Route path=\"/cashbox\">{() => <AdminRoute component={Cashbox} />}</Route>\n      <Route path=\"/expenses\">{() => <AdminRoute component={Expenses} />}</Route>\n      <Route path=\"/container-invoices\">{() => <AdminRoute component={ContainerInvoices} />}</Route>\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction StatusAlertProvider() {\n  useStatusAlerts();\n  return null;\n}\n\nfunction ProfileDialog({ open, onOpenChange, user, onUpdate }: {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  user: AuthUser;\n  onUpdate: (user: AuthUser) => void;\n}) {\n  const [username, setUsername] = useState(user.username);\n  const [displayName, setDisplayName] = useState(user.displayName);\n  const [currentPassword, setCurrentPassword] = useState(\"\");\n  const [newPassword, setNewPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [showCurrentPassword, setShowCurrentPassword] = useState(false);\n  const [showNewPassword, setShowNewPassword] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [error, setError] = useState(\"\");\n  const { toast } = useToast();\n  const { language } = useLanguage();\n\n  useEffect(() => {\n    if (open) {\n      setUsername(user.username);\n      setDisplayName(user.displayName);\n      setCurrentPassword(\"\");\n      setNewPassword(\"\");\n      setConfirmPassword(\"\");\n      setError(\"\");\n    }\n  }, [open, user]);\n\n  const handleSave = async () => {\n    setError(\"\");\n\n    if (!username.trim() || !displayName.trim()) {\n      setError(t(\"profile.errorRequired\", language));\n      return;\n    }\n\n    if (newPassword && newPassword !== confirmPassword) {\n      setError(t(\"profile.errorMismatch\", language));\n      return;\n    }\n\n    if (newPassword && !currentPassword) {\n      setError(t(\"profile.errorCurrentRequired\", language));\n      return;\n    }\n\n    try {\n      setSaving(true);\n      const body: any = { username: username.trim(), displayName: displayName.trim() };\n      if (newPassword) {\n        body.currentPassword = currentPassword;\n        body.newPassword = newPassword;\n      }\n      const res = await apiRequest(\"PATCH\", \"/api/auth/profile\", body);\n      const updated = await res.json();\n      onUpdate(updated);\n      toast({ title: t(\"profile.success\", language) });\n      onOpenChange(false);\n    } catch (e: any) {\n      let msg = t(\"profile.errorGeneric\", language);\n      if (e?.message) {\n        try {\n          const parsed = JSON.parse(e.message.replace(/^\\d+:\\s*/, \"\"));\n          msg = parsed.message || msg;\n        } catch {\n          msg = e.message.replace(/^\\d+:\\s*/, \"\");\n        }\n      }\n      setError(msg);\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const dir = language === \"ar\" ? \"rtl\" : \"ltr\";\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-md\" dir={dir}>\n        <DialogHeader>\n          <DialogTitle>{t(\"profile.title\", language)}</DialogTitle>\n        </DialogHeader>\n        <div className=\"space-y-4 py-2\">\n          {error && (\n            <div className=\"text-sm text-destructive bg-destructive/10 p-2 rounded-md\" data-testid=\"text-profile-error\">\n              {error}\n            </div>\n          )}\n          <div className=\"space-y-2\">\n            <Label>{t(\"profile.username\", language)}</Label>\n            <Input\n              value={username}\n              onChange={(e) => setUsername(e.target.value)}\n              data-testid=\"input-profile-username\"\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>{t(\"profile.displayName\", language)}</Label>\n            <Input\n              value={displayName}\n              onChange={(e) => setDisplayName(e.target.value)}\n              data-testid=\"input-profile-display-name\"\n            />\n          </div>\n          <div className=\"border-t pt-4 space-y-2\">\n            <Label className=\"text-muted-foreground\">{t(\"profile.changePassword\", language)}</Label>\n            <div className=\"space-y-2\">\n              <Label>{t(\"profile.currentPassword\", language)}</Label>\n              <div className=\"flex gap-1\">\n                <Input\n                  type={showCurrentPassword ? \"text\" : \"password\"}\n                  value={currentPassword}\n                  onChange={(e) => setCurrentPassword(e.target.value)}\n                  className=\"flex-1\"\n                  data-testid=\"input-profile-current-password\"\n                />\n                <Button\n                  type=\"button\"\n                  size=\"icon\"\n                  variant=\"ghost\"\n                  onClick={() => setShowCurrentPassword(!showCurrentPassword)}\n                  data-testid=\"button-toggle-current-password\"\n                >\n                  {showCurrentPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                </Button>\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>{t(\"profile.newPassword\", language)}</Label>\n              <div className=\"flex gap-1\">\n                <Input\n                  type={showNewPassword ? \"text\" : \"password\"}\n                  value={newPassword}\n                  onChange={(e) => setNewPassword(e.target.value)}\n                  className=\"flex-1\"\n                  data-testid=\"input-profile-new-password\"\n                />\n                <Button\n                  type=\"button\"\n                  size=\"icon\"\n                  variant=\"ghost\"\n                  onClick={() => setShowNewPassword(!showNewPassword)}\n                  data-testid=\"button-toggle-new-password\"\n                >\n                  {showNewPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                </Button>\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>{t(\"profile.confirmPassword\", language)}</Label>\n              <Input\n                type=\"password\"\n                value={confirmPassword}\n                onChange={(e) => setConfirmPassword(e.target.value)}\n                data-testid=\"input-profile-confirm-password\"\n              />\n            </div>\n          </div>\n          <div className=\"flex gap-2 justify-end pt-2\">\n            <Button variant=\"outline\" onClick={() => onOpenChange(false)} data-testid=\"button-profile-cancel\">\n              {t(\"profile.cancel\", language)}\n            </Button>\n            <Button onClick={handleSave} disabled={saving} data-testid=\"button-profile-save\">\n              {saving ? t(\"profile.saving\", language) : t(\"profile.save\", language)}\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction App() {\n  const [user, setUser] = useState<AuthUser | null>(null);\n  const [checking, setChecking] = useState(true);\n  const [profileOpen, setProfileOpen] = useState(false);\n  const [language, setLanguage] = useState<Language>(() => {\n    return (localStorage.getItem(\"app-language\") as Language) || \"ar\";\n  });\n\n  const handleLanguageChange = (lang: Language) => {\n    setLanguage(lang);\n    localStorage.setItem(\"app-language\", lang);\n    document.documentElement.dir = lang === \"ar\" ? \"rtl\" : \"ltr\";\n    document.documentElement.lang = lang === \"ar\" ? \"ar\" : \"zh\";\n  };\n\n  useEffect(() => {\n    fetch(\"/api/auth/me\", { credentials: \"include\" })\n      .then(res => {\n        if (res.ok) return res.json();\n        throw new Error(\"not logged in\");\n      })\n      .then(data => setUser(data))\n      .catch(() => setUser(null))\n      .finally(() => setChecking(false));\n  }, []);\n\n  const handleLogout = async () => {\n    await apiRequest(\"POST\", \"/api/auth/logout\");\n    setUser(null);\n    queryClient.clear();\n  };\n\n  if (checking) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Skeleton className=\"h-12 w-48\" />\n      </div>\n    );\n  }\n\n  if (!user) {\n    return (\n      <QueryClientProvider client={queryClient}>\n        <TooltipProvider>\n          <Login onLogin={setUser} />\n          <Toaster />\n        </TooltipProvider>\n      </QueryClientProvider>\n    );\n  }\n\n  const style = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <LanguageContext.Provider value={{ language, setLanguage: handleLanguageChange }}>\n          <AuthContext.Provider value={{ user, setUser }}>\n            <StatusAlertProvider />\n            <SidebarProvider style={style as React.CSSProperties}>\n              <div className=\"flex h-screen w-full\">\n                <AppSidebar />\n                <div className=\"flex flex-col flex-1 min-w-0\">\n                  <header className=\"flex items-center justify-between gap-2 px-3 border-b h-12 shrink-0\">\n                    <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n                    <div className=\"flex items-center gap-2\">\n                      {user.role === \"warehouse\" && (\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => handleLanguageChange(language === \"ar\" ? \"zh\" : \"ar\")}\n                          data-testid=\"button-language-toggle\"\n                        >\n                          <Languages className=\"h-4 w-4\" />\n                          <span className=\"mr-1\">{t(\"header.switchLang\", language)}</span>\n                        </Button>\n                      )}\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => setProfileOpen(true)}\n                        className=\"text-sm text-muted-foreground\"\n                        data-testid=\"button-profile-settings\"\n                      >\n                        <Settings className=\"h-4 w-4\" />\n                        <span>{user.displayName}</span>\n                      </Button>\n                      <Button size=\"icon\" variant=\"ghost\" onClick={handleLogout} data-testid=\"button-logout\">\n                        <LogOut className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </header>\n                  <main className=\"flex-1 overflow-auto\">\n                    <Router />\n                  </main>\n                </div>\n              </div>\n            </SidebarProvider>\n          </AuthContext.Provider>\n          <ProfileDialog\n            open={profileOpen}\n            onOpenChange={setProfileOpen}\n            user={user}\n            onUpdate={setUser}\n          />\n        </LanguageContext.Provider>\n        <Toaster />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":14506,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"replit.md":{"content":"# Inventory Management System (نظام إدارة المخزون)\n\n## Overview\nA comprehensive inventory management system for managing goods imported from China. Built with Express.js backend and React frontend with Arabic RTL interface.\n\n## Architecture\n- **Frontend**: React + Vite + TailwindCSS + Shadcn UI, RTL Arabic layout\n- **Backend**: Express.js with PostgreSQL via Drizzle ORM\n- **Database**: PostgreSQL (Neon-backed via Replit)\n- **Auth**: Session-based with bcrypt password hashing, admin/user roles\n\n## Key Features\n- Authentication with session management and role-based access (admin/user)\n- User management (admin only) - create/list users with role assignment\n- Products management with status tracking, Excel import, quantity reset, and aging alerts\n- Suppliers management with edit/delete (integrity checks block deletion if related records exist)\n- Categories & Warehouses management (categories blocked from deletion if products exist)\n- Order creation workflow (select supplier → select products → confirm with prices in CNY/USD)\n- Delivery/Receiving workflow (receive goods from supplier with dimensions)\n- Container shipping management\n- Container arrival tracking\n- History lists for orders, deliveries, and containers\n- Supplier account management with remaining balance calculation, payment history, and print functionality\n- Status aging alerts (products with unchanged status for 3+ days get visual warnings)\n\n## Project Structure\n- `shared/schema.ts` - All database schemas and types (users, products, orders, deliveries, containers, payments)\n- `server/db.ts` - Database connection\n- `server/storage.ts` - Storage layer with all CRUD operations\n- `server/routes.ts` - API routes (includes auth middleware)\n- `server/seed.ts` - Database seeding\n- `client/src/pages/` - All page components\n- `client/src/components/app-sidebar.tsx` - Navigation sidebar\n\n## Database Tables\nusers, categories, suppliers, warehouses, products, product_parts, orders, order_items, deliveries, delivery_items, containers, container_items, container_documents, payments, sessions, user_categories, shipping_companies, shipping_payments, cashbox_transactions\n\n## Product Status Flow\npurchase_order → ordered → received → semi_manufactured → shipping → arrived\n\n## Semi-Manufactured / Composite Products\n- Products with \"semi_manufactured\" status can have parts defined via product_parts table\n- Each part has: name, quantity, length, width, height, weight, piecesPerCarton\n- Parts are managed via Layers icon button on products page (only visible for semi_manufactured products)\n- Parts list is displayed during delivery receiving for semi-manufactured products\n- \"Add composite product\" button creates product directly with semi_manufactured status and opens parts dialog\n\n## User Role Restrictions\n- Admin users: Full access to all pages and features\n- Regular users (role: user): Only see Dashboard and Products pages in sidebar (create products and track status only)\n- Warehouse users (role: warehouse): See Dashboard, Products, Warehouses, Orders (read-only), Deliveries, Warehouse Inventory, Shipping. Cannot see any prices anywhere. Cannot create orders.\n- Non-admin users cannot access: supplier accounts, shipping accounts, cashbox, expenses, user management\n\n## Currencies\nCNY (Yuan) and USD (Dollar)\n\n## Auth\n- Default admin: username \"admin\", password \"admin123\"\n- Session-based auth with express-session and connect-pg-simple\n- Role enum: admin, user, warehouse\n\n## Category-Based Permissions\n- user_categories table links users to permitted categories\n- Admin users bypass all category restrictions (see/create in all categories)\n- Non-admin users can only view/create products in their permitted categories\n- User management page (admin only) includes category assignment dialog\n- Backend enforces permissions on GET /api/products and POST /api/products\n- Auth response includes allowedCategories array for frontend filtering\n- Excel import respects category permissions for non-admin users\n\n## Shipping Companies\n- shipping_companies table: id, name, phone, address\n- Containers reference shippingCompanyId (FK to shipping_companies)\n- Containers have priceCNY and priceUSD fields for container pricing\n- Shipping page: dropdown to select shipping company + price fields in CNY/USD\n- Shipping company accounts page: similar to supplier accounts with payment tracking, currency conversion, print\n\n## Warehouse Inventory\n- /warehouse-inventory page shows products with \"received\" or \"semi_manufactured\" status\n- Displays quantity, weight, volume, dimensions for each product\n- Composite products show their parts with individual weight/volume\n- Print functionality for warehouse inventory report\n- Summary cards: total products, quantity, weight, volume\n\n## Order Edit & Print\n- Orders history: each order card has print button for individual order printing\n- Each order item has edit button to modify quantity, price, currency\n- Order print opens formatted print window with supplier info, items table, totals\n\n## Cashbox (صندوق الحسابات)\n- cashbox_transactions table: id, type (income/expense), category (supplier/shipping/other/expense), amount, currency, supplierId, shippingCompanyId, expenseId, description, createdAt\n- /cashbox page: income/expense tracking with dual currency (CNY/USD) balance cards\n- Transaction categories: supplier payments, shipping company payments, expense box entries, other\n- Features: add/edit/delete transactions, currency exchange, supplier/shipping payments, type/currency filters, print functionality\n- Currency exchange: converts between CNY/USD by creating two linked transactions (expense from source + income to target)\n- Supplier payment from cashbox: creates payment record in supplier accounts + cashbox expense entry (linked via paymentId)\n- Shipping payment from cashbox: creates payment record in shipping accounts + cashbox expense entry (linked via shippingPaymentId)\n- API endpoints: POST /api/cashbox/exchange, POST /api/cashbox/supplier-payment, POST /api/cashbox/shipping-payment\n- Summary cards: income CNY, income USD, expense CNY, expense USD, balance CNY, balance USD\n- Linked payments: cashbox_transactions has paymentId, shippingPaymentId, and expenseId columns\n- Supplier payments auto-create cashbox expense entries (linked via paymentId)\n- Shipping payments auto-create cashbox expense entries (linked via shippingPaymentId)\n- Expense box entries auto-create cashbox expense entries (linked via expenseId)\n- Linked entries show badge (\"دفعة مورد\" / \"دفعة شحن\" / \"مصروف\") and cannot be edited/deleted from cashbox page\n- Edit/delete linked entries only via supplier accounts, shipping accounts, or expenses pages\n\n## Expenses Box (صندوق المصاريف)\n- expenses table: id, title, amount, currency, description, createdAt\n- /expenses page: dedicated expense tracking with dual currency summary cards\n- Features: add/edit/delete expenses, currency filter, print functionality\n- Each expense auto-creates a linked cashbox transaction (category: \"expense\")\n- Edit/delete expenses auto-updates/deletes the linked cashbox entry\n- Summary cards: total expenses CNY, total expenses USD\n\n## Container Invoices (سجل الفواتير)\n- container_documents table: id, containerId, invoiceNumber, invoiceDate, shippingBill, originCertificate, conformityCertificate, invoice, moneyArrival, moneyArrivalCurrency, cashboxTransactionId\n- Auto-created when a container is shipped (createContainer auto-inserts row with invoiceNumber and date)\n- /container-invoices page: table with toggle switches for certificates, editable invoice and money arrival fields\n- When moneyArrival is entered, auto-creates cashbox income transaction (linked via cashboxTransactionId)\n- Updating moneyArrival updates the linked cashbox entry; clearing it deletes the cashbox entry\n\n## Recent Changes\n- Added container invoices tracking page with auto-cashbox integration\n- Added cashbox currency exchange (CNY↔USD) with dual transaction creation\n- Added cashbox supplier/shipping payment buttons linked to their respective accounts\n- Added expenses box (صندوق المصاريف) with cashbox auto-linking\n- Linked supplier and shipping payments to cashbox: auto-create/update/delete expense entries\n- Added cashbox (صندوق الحسابات) for tracking money in/out with dual currency support\n- Added shipping companies management (CRUD, accounts with payments, currency conversion, print)\n- Added warehouse inventory page with weight/volume tracking and composite product parts display\n- Added container pricing in CNY and USD with shipping company selection\n- Added order item editing and individual order printing\n- Product quantity now updates when delivery is received\n- Added category-based permissions system (user_categories table, admin UI, backend enforcement)\n- Added semi-manufactured product status with parts management system\n- Products page: Layers icon button for semi_manufactured products to manage parts (add/view/delete)\n- Deliveries page: parts list displayed when receiving semi-manufactured products\n- Added status aging alerts on products page (3-day threshold, amber warning icons)\n- Enhanced supplier accounts with remaining balance card, payment history, print, edit/delete payments, and currency conversion\n- Added history lists for deliveries and containers\n- Excel product import with Arabic/English column name support\n- Integrity checks on supplier/category deletion\n- Supplier search by name, phone, or address\n- Payment edit and delete with confirmation dialogs\n- Payment currency conversion between CNY and USD with custom exchange rate\n- French date format (dd/mm/yyyy) across all pages using toLocaleDateString(\"fr-FR\")\n- Orders page: editable remaining quantity per product, reset button to zero\n- Container shipping: supports both received and semi_manufactured products\n- Added quantity field to product_parts table\n- Removed \"purchase\" status; all new products default to \"purchase_order\"\n- Non-admin users sidebar restricted to Dashboard and Products only\n- Added \"Add Composite Product\" button with separate dialog\n- Added profile settings dialog: users can change username, display name, and password from header\n- Profile dialog supports bilingual translations (Arabic/Chinese) for warehouse users\n","path":null,"size_bytes":10361,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/pages/user-management.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Plus, UserPlus, Shield, User, FolderOpen } from \"lucide-react\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useAuth } from \"@/App\";\nimport type { Category } from \"@shared/schema\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\n\nexport default function UserManagement() {\n  const { toast } = useToast();\n  const { user: currentUser } = useAuth();\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [displayName, setDisplayName] = useState(\"\");\n  const [role, setRole] = useState(\"user\");\n  const [permDialogOpen, setPermDialogOpen] = useState(false);\n  const [permUser, setPermUser] = useState<any>(null);\n  const [selectedCats, setSelectedCats] = useState<number[]>([]);\n\n  if (currentUser?.role !== \"admin\") {\n    return (\n      <div className=\"p-6\">\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n            <Shield className=\"h-12 w-12 text-muted-foreground mb-3\" />\n            <p className=\"text-muted-foreground\">ليس لديك صلاحية للوصول لهذه الصفحة</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const { data: users, isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const { data: categories } = useQuery<Category[]>({\n    queryKey: [\"/api/categories\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await apiRequest(\"POST\", \"/api/users\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      setDialogOpen(false);\n      setUsername(\"\");\n      setPassword(\"\");\n      setDisplayName(\"\");\n      setRole(\"user\");\n      toast({ title: \"تم إنشاء المستخدم بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const setCategoriesMutation = useMutation({\n    mutationFn: async ({ userId, categoryIds }: { userId: number; categoryIds: number[] }) => {\n      const res = await apiRequest(\"PUT\", `/api/users/${userId}/categories`, { categoryIds });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      setPermDialogOpen(false);\n      setPermUser(null);\n      toast({ title: \"تم تحديث صلاحيات الفئات بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const handleCreate = () => {\n    if (!username.trim() || !password.trim() || !displayName.trim()) {\n      toast({ title: \"يرجى ملء جميع الحقول\", variant: \"destructive\" });\n      return;\n    }\n    createMutation.mutate({ username: username.trim(), password, displayName: displayName.trim(), role });\n  };\n\n  const openPermissions = (u: any) => {\n    setPermUser(u);\n    setSelectedCats(u.allowedCategories || []);\n    setPermDialogOpen(true);\n  };\n\n  const toggleCategory = (catId: number) => {\n    setSelectedCats(prev =>\n      prev.includes(catId) ? prev.filter(id => id !== catId) : [...prev, catId]\n    );\n  };\n\n  const handleSavePermissions = () => {\n    if (!permUser) return;\n    setCategoriesMutation.mutate({ userId: permUser.id, categoryIds: selectedCats });\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-users-title\">إدارة المستخدمين</h1>\n          <p className=\"text-muted-foreground\">إنشاء وإدارة حسابات المستخدمين وصلاحياتهم</p>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-add-user\">\n              <UserPlus className=\"h-4 w-4\" />\n              إضافة مستخدم\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>إنشاء مستخدم جديد</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4 pt-4\">\n              <div className=\"space-y-2\">\n                <Label>اسم المستخدم (للدخول)</Label>\n                <Input\n                  data-testid=\"input-new-username\"\n                  value={username}\n                  onChange={(e) => setUsername(e.target.value)}\n                  placeholder=\"اسم المستخدم\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>كلمة المرور</Label>\n                <Input\n                  data-testid=\"input-new-password\"\n                  type=\"password\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  placeholder=\"كلمة المرور\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>الاسم الظاهر</Label>\n                <Input\n                  data-testid=\"input-new-displayname\"\n                  value={displayName}\n                  onChange={(e) => setDisplayName(e.target.value)}\n                  placeholder=\"الاسم الكامل\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>الصلاحية</Label>\n                <Select value={role} onValueChange={setRole}>\n                  <SelectTrigger data-testid=\"select-user-role\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"admin\">مدير</SelectItem>\n                    <SelectItem value=\"user\">مستخدم</SelectItem>\n                    <SelectItem value=\"warehouse\">عامل مخزن</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <Button\n                data-testid=\"button-submit-user\"\n                className=\"w-full\"\n                onClick={handleCreate}\n                disabled={createMutation.isPending}\n              >\n                {createMutation.isPending ? \"جاري الإنشاء...\" : \"إنشاء المستخدم\"}\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <Card>\n        <CardContent className=\"pt-6\">\n          {isLoading ? (\n            <div className=\"space-y-3\">\n              {Array.from({ length: 3 }).map((_, i) => (\n                <Skeleton key={i} className=\"h-12 w-full\" />\n              ))}\n            </div>\n          ) : users && users.length > 0 ? (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>#</TableHead>\n                  <TableHead>اسم المستخدم</TableHead>\n                  <TableHead>الاسم الظاهر</TableHead>\n                  <TableHead>الصلاحية</TableHead>\n                  <TableHead>الفئات المسموحة</TableHead>\n                  <TableHead>تاريخ الإنشاء</TableHead>\n                  <TableHead>إجراءات</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {users.map((u: any, idx: number) => (\n                  <TableRow key={u.id} data-testid={`row-user-${u.id}`}>\n                    <TableCell>{idx + 1}</TableCell>\n                    <TableCell className=\"font-medium\">{u.username}</TableCell>\n                    <TableCell>{u.displayName}</TableCell>\n                    <TableCell>\n                      <Badge variant={u.role === \"admin\" ? \"default\" : \"secondary\"}>\n                        {u.role === \"admin\" ? \"مدير\" : u.role === \"warehouse\" ? \"عامل مخزن\" : \"مستخدم\"}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>\n                      {u.role === \"admin\" ? (\n                        <span className=\"text-sm text-muted-foreground\">جميع الفئات</span>\n                      ) : (\n                        <div className=\"flex flex-wrap gap-1\">\n                          {u.allowedCategories && u.allowedCategories.length > 0 ? (\n                            u.allowedCategories.map((catId: number) => {\n                              const cat = categories?.find(c => c.id === catId);\n                              return cat ? (\n                                <Badge key={catId} variant=\"secondary\" className=\"text-xs\">\n                                  {cat.name}\n                                </Badge>\n                              ) : null;\n                            })\n                          ) : (\n                            <span className=\"text-sm text-muted-foreground\">لا توجد فئات</span>\n                          )}\n                        </div>\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-sm text-muted-foreground\">\n                      {u.createdAt ? new Date(u.createdAt).toLocaleDateString(\"fr-FR\") : \"-\"}\n                    </TableCell>\n                    <TableCell>\n                      {u.role !== \"admin\" && (\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => openPermissions(u)}\n                          data-testid={`button-permissions-${u.id}`}\n                        >\n                          <FolderOpen className=\"h-4 w-4\" />\n                        </Button>\n                      )}\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          ) : (\n            <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n              <User className=\"h-12 w-12 text-muted-foreground mb-3\" />\n              <p className=\"text-muted-foreground\">لا يوجد مستخدمين</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={permDialogOpen} onOpenChange={setPermDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>صلاحيات الفئات - {permUser?.displayName}</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 pt-4\">\n            <p className=\"text-sm text-muted-foreground\">\n              اختر الفئات التي يمكن لهذا المستخدم إنشاء المنتجات فيها وتتبعها\n            </p>\n            {categories && categories.length > 0 ? (\n              <div className=\"space-y-3 max-h-64 overflow-y-auto\">\n                {categories.map((cat) => (\n                  <div\n                    key={cat.id}\n                    className=\"flex items-center gap-3 p-3 rounded-md border cursor-pointer hover-elevate\"\n                    onClick={() => toggleCategory(cat.id)}\n                    data-testid={`checkbox-category-${cat.id}`}\n                  >\n                    <Checkbox\n                      checked={selectedCats.includes(cat.id)}\n                      onCheckedChange={() => toggleCategory(cat.id)}\n                    />\n                    <span className=\"font-medium\">{cat.name}</span>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-sm text-muted-foreground text-center py-4\">لا توجد فئات</p>\n            )}\n            <Button\n              className=\"w-full\"\n              onClick={handleSavePermissions}\n              disabled={setCategoriesMutation.isPending}\n              data-testid=\"button-save-permissions\"\n            >\n              {setCategoriesMutation.isPending ? \"جاري الحفظ...\" : \"حفظ الصلاحيات\"}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":12899,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Package, Users, ShoppingCart, Ship, Anchor, Warehouse } from \"lucide-react\";\nimport type { Product, Supplier, Container } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useLanguage } from \"@/lib/language-context\";\nimport { t, getStatusLabel } from \"@/lib/translations\";\n\nconst statusColors: Record<string, string> = {\n  purchase_order: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200\",\n  ordered: \"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200\",\n  received: \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\",\n  semi_manufactured: \"bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-200\",\n  shipping: \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200\",\n  arrived: \"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200\",\n};\n\nconst statusKeys = [\"purchase_order\", \"ordered\", \"received\", \"semi_manufactured\", \"shipping\", \"arrived\"];\n\nexport default function Dashboard() {\n  const { language } = useLanguage();\n  const { data: products, isLoading: productsLoading } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n  const { data: suppliers, isLoading: suppliersLoading } = useQuery<Supplier[]>({\n    queryKey: [\"/api/suppliers\"],\n  });\n  const { data: containers, isLoading: containersLoading } = useQuery<Container[]>({\n    queryKey: [\"/api/containers\"],\n  });\n\n  const statusCounts = products?.reduce((acc, p) => {\n    acc[p.status] = (acc[p.status] || 0) + 1;\n    return acc;\n  }, {} as Record<string, number>) || {};\n\n  const shippingContainers = containers?.filter(c => c.status === \"shipping\") || [];\n  const arrivedContainers = containers?.filter(c => c.status === \"arrived\") || [];\n\n  const isLoading = productsLoading || suppliersLoading || containersLoading;\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold\" data-testid=\"text-dashboard-title\">{t(\"dashboard.title\", language)}</h1>\n        <p className=\"text-muted-foreground\">{t(\"dashboard.overview\", language)}</p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        {isLoading ? (\n          Array.from({ length: 4 }).map((_, i) => (\n            <Card key={i}>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <Skeleton className=\"h-4 w-24\" />\n                <Skeleton className=\"h-4 w-4\" />\n              </CardHeader>\n              <CardContent>\n                <Skeleton className=\"h-8 w-16\" />\n              </CardContent>\n            </Card>\n          ))\n        ) : (\n          <>\n            <Card data-testid=\"card-total-products\">\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">{t(\"dashboard.totalProducts\", language)}</CardTitle>\n                <Package className=\"h-4 w-4 text-muted-foreground\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{products?.length || 0}</div>\n              </CardContent>\n            </Card>\n\n            <Card data-testid=\"card-total-suppliers\">\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">{t(\"dashboard.totalSuppliers\", language)}</CardTitle>\n                <Users className=\"h-4 w-4 text-muted-foreground\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{suppliers?.length || 0}</div>\n              </CardContent>\n            </Card>\n\n            <Card data-testid=\"card-shipping-containers\">\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">{t(\"dashboard.containersShipping\", language)}</CardTitle>\n                <Ship className=\"h-4 w-4 text-muted-foreground\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{shippingContainers.length}</div>\n              </CardContent>\n            </Card>\n\n            <Card data-testid=\"card-arrived-containers\">\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">{t(\"dashboard.containersArrived\", language)}</CardTitle>\n                <Anchor className=\"h-4 w-4 text-muted-foreground\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{arrivedContainers.length}</div>\n              </CardContent>\n            </Card>\n          </>\n        )}\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-base\">{t(\"dashboard.productsByStatus\", language)}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"space-y-3\">\n                {Array.from({ length: 4 }).map((_, i) => (\n                  <Skeleton key={i} className=\"h-8 w-full\" />\n                ))}\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {statusKeys.map((key) => (\n                  <div key={key} className=\"flex items-center justify-between gap-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <Badge variant=\"secondary\" className={statusColors[key]}>\n                        {getStatusLabel(key, language)}\n                      </Badge>\n                    </div>\n                    <span className=\"text-lg font-semibold\">{statusCounts[key] || 0}</span>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-base\">{t(\"dashboard.recentContainers\", language)}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"space-y-3\">\n                {Array.from({ length: 5 }).map((_, i) => (\n                  <Skeleton key={i} className=\"h-6 w-full\" />\n                ))}\n              </div>\n            ) : products && products.length > 0 ? (\n              <div className=\"space-y-2\">\n                {products.slice(0, 8).map((p) => (\n                  <div key={p.id} className=\"flex items-center justify-between gap-2 py-1\">\n                    <span className=\"text-sm truncate\">{p.name}</span>\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-sm text-muted-foreground\">{p.quantity}</span>\n                      <Badge variant=\"secondary\" className={statusColors[p.status]}>\n                        {getStatusLabel(p.status, language)}\n                      </Badge>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-sm text-muted-foreground text-center py-8\">{t(\"common.noData\", language)}</p>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":7537,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/pages/container-invoices.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Printer, FileText, X, Save, Merge, Unlink } from \"lucide-react\";\nimport { openPrintWindow } from \"@/lib/printStyles\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Switch } from \"@/components/ui/switch\";\n\nexport default function ContainerInvoices() {\n  const { toast } = useToast();\n  const [editingId, setEditingId] = useState<number | null>(null);\n  const [editInvoice, setEditInvoice] = useState(\"\");\n  const [editMoneyArrival, setEditMoneyArrival] = useState(\"\");\n  const [editMoneyArrivalCurrency, setEditMoneyArrivalCurrency] = useState(\"CNY\");\n  const [mergeDialogOpen, setMergeDialogOpen] = useState(false);\n  const [selectedForMerge, setSelectedForMerge] = useState<number[]>([]);\n  const [mergeInvoiceNumber, setMergeInvoiceNumber] = useState(\"\");\n\n  const { data: docs, isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/container-documents\"],\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: any }) => {\n      const res = await apiRequest(\"PATCH\", `/api/container-documents/${id}`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/container-documents\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/transactions\"] });\n      setEditingId(null);\n      toast({ title: \"تم التحديث بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const mergeMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await apiRequest(\"POST\", \"/api/container-documents/merge\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/container-documents\"] });\n      setMergeDialogOpen(false);\n      setSelectedForMerge([]);\n      setMergeInvoiceNumber(\"\");\n      toast({ title: \"تم دمج الحاويات في فاتورة واحدة\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const unmergeMutation = useMutation({\n    mutationFn: async (docId: number) => {\n      const res = await apiRequest(\"POST\", \"/api/container-documents/unmerge\", { docId });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/container-documents\"] });\n      toast({ title: \"تم فك الدمج\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const toggleField = (id: number, field: string, value: boolean) => {\n    updateMutation.mutate({ id, data: { [field]: value } });\n  };\n\n  const startEdit = (doc: any) => {\n    setEditingId(doc.id);\n    setEditInvoice(doc.invoice || \"\");\n    setEditMoneyArrival(doc.moneyArrival ? String(doc.moneyArrival) : \"\");\n    setEditMoneyArrivalCurrency(doc.moneyArrivalCurrency || \"CNY\");\n  };\n\n  const saveEdit = (id: number) => {\n    updateMutation.mutate({\n      id,\n      data: {\n        invoice: editInvoice || null,\n        moneyArrival: editMoneyArrival || null,\n        moneyArrivalCurrency: editMoneyArrivalCurrency,\n      },\n    });\n  };\n\n  const toggleMergeSelection = (docId: number) => {\n    setSelectedForMerge(prev =>\n      prev.includes(docId) ? prev.filter(id => id !== docId) : [...prev, docId]\n    );\n  };\n\n  const handleMerge = () => {\n    if (selectedForMerge.length < 2) {\n      toast({ title: \"يجب اختيار حاويتين على الأقل\", variant: \"destructive\" });\n      return;\n    }\n    mergeMutation.mutate({ docIds: selectedForMerge, groupInvoiceNumber: mergeInvoiceNumber });\n  };\n\n  const handlePrint = () => {\n    const printContent = document.getElementById(\"invoices-table\");\n    if (!printContent) return;\n    openPrintWindow({\n      title: \"سجل فواتير الحاويات\",\n      subtitle: \"متابعة مستندات الحاويات\",\n      content: printContent.outerHTML,\n    });\n  };\n\n  const formatDate = (d: string | null) => {\n    if (!d) return \"-\";\n    return new Date(d).toLocaleDateString(\"fr-FR\");\n  };\n\n  const groupedDocs = (() => {\n    if (!docs) return [];\n    const groups: Record<string, any[]> = {};\n    const ungrouped: any[] = [];\n\n    for (const doc of docs) {\n      if (doc.groupInvoiceId) {\n        const key = String(doc.groupInvoiceId);\n        if (!groups[key]) groups[key] = [];\n        groups[key].push(doc);\n      } else {\n        ungrouped.push(doc);\n      }\n    }\n\n    const result: any[] = [];\n    for (const [groupId, groupDocs] of Object.entries(groups)) {\n      result.push({ type: \"group\", groupId: Number(groupId), docs: groupDocs });\n    }\n    for (const doc of ungrouped) {\n      result.push({ type: \"single\", doc });\n    }\n    return result;\n  })();\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6 space-y-4\">\n        <Skeleton className=\"h-8 w-48\" />\n        <Skeleton className=\"h-64 w-full\" />\n      </div>\n    );\n  }\n\n  const ungroupedDocs = docs?.filter(d => !d.groupInvoiceId) || [];\n\n  return (\n    <div className=\"p-6 space-y-4\">\n      <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n        <h1 className=\"text-2xl font-bold\" data-testid=\"text-page-title\">سجل فواتير الحاويات</h1>\n        <div className=\"flex items-center gap-2 flex-wrap\">\n          <Button variant=\"outline\" onClick={() => setMergeDialogOpen(true)} data-testid=\"button-merge-invoices\">\n            <Merge className=\"h-4 w-4 ml-2\" />\n            دمج حاويات\n          </Button>\n          <Button variant=\"outline\" onClick={handlePrint} data-testid=\"button-print-invoices\">\n            <Printer className=\"h-4 w-4 ml-2\" />\n            طباعة\n          </Button>\n        </div>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <FileText className=\"h-5 w-5\" />\n            متابعة مستندات الحاويات\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"overflow-x-auto\">\n            <Table id=\"invoices-table\" data-testid=\"table-invoices\">\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"text-center\">رقم الفاتورة</TableHead>\n                  <TableHead className=\"text-center\">تاريخ الفاتورة</TableHead>\n                  <TableHead className=\"text-center\">بوليصة الشحن</TableHead>\n                  <TableHead className=\"text-center\">شهادة المنشأ</TableHead>\n                  <TableHead className=\"text-center\">شهادة المطابقة</TableHead>\n                  <TableHead className=\"text-center\">الفاتورة</TableHead>\n                  <TableHead className=\"text-center\">وصول الأموال</TableHead>\n                  <TableHead className=\"text-center\">إجراءات</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {(!docs || docs.length === 0) ? (\n                  <TableRow>\n                    <TableCell colSpan={8} className=\"text-center text-muted-foreground\">\n                      لا توجد فواتير بعد - يتم إنشاؤها تلقائياً عند تحميل الحاويات\n                    </TableCell>\n                  </TableRow>\n                ) : (\n                  groupedDocs.map((entry, idx) => {\n                    if (entry.type === \"group\") {\n                      return entry.docs.map((doc: any, docIdx: number) => (\n                        <TableRow key={doc.id} className=\"bg-muted/30\" data-testid={`row-doc-${doc.id}`}>\n                          {docIdx === 0 && (\n                            <TableCell className=\"text-center font-bold\" rowSpan={entry.docs.length} data-testid={`text-invoice-number-${doc.id}`}>\n                              <div className=\"flex flex-col items-center gap-1\">\n                                <Badge variant=\"secondary\">{doc.invoiceNumber || \"-\"}</Badge>\n                                <span className=\"text-xs text-muted-foreground\">({entry.docs.length} حاويات)</span>\n                                <Button size=\"sm\" variant=\"ghost\" onClick={() => unmergeMutation.mutate(doc.id)} data-testid={`button-unmerge-${doc.id}`}>\n                                  <Unlink className=\"h-3 w-3 ml-1\" />\n                                  فك الدمج\n                                </Button>\n                              </div>\n                            </TableCell>\n                          )}\n                          <TableCell className=\"text-center\" data-testid={`text-invoice-date-${doc.id}`}>\n                            {formatDate(doc.invoiceDate)}\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            <Switch checked={doc.shippingBill || false} onCheckedChange={(val) => toggleField(doc.id, \"shippingBill\", val)} data-testid={`switch-shipping-bill-${doc.id}`} />\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            <Switch checked={doc.originCertificate || false} onCheckedChange={(val) => toggleField(doc.id, \"originCertificate\", val)} data-testid={`switch-origin-cert-${doc.id}`} />\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            <Switch checked={doc.conformityCertificate || false} onCheckedChange={(val) => toggleField(doc.id, \"conformityCertificate\", val)} data-testid={`switch-conformity-cert-${doc.id}`} />\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            {editingId === doc.id ? (\n                              <Input value={editInvoice} onChange={(e) => setEditInvoice(e.target.value)} className=\"text-center\" data-testid={`input-invoice-${doc.id}`} />\n                            ) : (\n                              <span data-testid={`text-invoice-${doc.id}`}>{doc.invoice || \"-\"}</span>\n                            )}\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            {editingId === doc.id ? (\n                              <div className=\"flex items-center gap-1\">\n                                <Input type=\"number\" value={editMoneyArrival} onChange={(e) => setEditMoneyArrival(e.target.value)} className=\"text-center\" placeholder=\"المبلغ\" data-testid={`input-money-arrival-${doc.id}`} />\n                                <Select value={editMoneyArrivalCurrency} onValueChange={setEditMoneyArrivalCurrency}>\n                                  <SelectTrigger className=\"w-24\" data-testid={`select-money-currency-${doc.id}`}>\n                                    <SelectValue />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    <SelectItem value=\"CNY\">يوان</SelectItem>\n                                    <SelectItem value=\"USD\">دولار</SelectItem>\n                                  </SelectContent>\n                                </Select>\n                              </div>\n                            ) : (\n                              <span data-testid={`text-money-arrival-${doc.id}`}>\n                                {doc.moneyArrival ? (\n                                  <Badge variant=\"default\">\n                                    {doc.moneyArrival} {doc.moneyArrivalCurrency === \"CNY\" ? \"يوان\" : \"دولار\"}\n                                  </Badge>\n                                ) : \"-\"}\n                              </span>\n                            )}\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            {editingId === doc.id ? (\n                              <div className=\"flex items-center justify-center gap-1\">\n                                <Button size=\"icon\" variant=\"ghost\" onClick={() => saveEdit(doc.id)} data-testid={`button-save-${doc.id}`}>\n                                  <Save className=\"h-4 w-4\" />\n                                </Button>\n                                <Button size=\"icon\" variant=\"ghost\" onClick={() => setEditingId(null)} data-testid={`button-cancel-${doc.id}`}>\n                                  <X className=\"h-4 w-4\" />\n                                </Button>\n                              </div>\n                            ) : (\n                              <Button size=\"icon\" variant=\"ghost\" onClick={() => startEdit(doc)} data-testid={`button-edit-${doc.id}`}>\n                                <FileText className=\"h-4 w-4\" />\n                              </Button>\n                            )}\n                          </TableCell>\n                        </TableRow>\n                      ));\n                    } else {\n                      const doc = entry.doc;\n                      return (\n                        <TableRow key={doc.id} data-testid={`row-doc-${doc.id}`}>\n                          <TableCell className=\"text-center font-medium\" data-testid={`text-invoice-number-${doc.id}`}>\n                            {doc.invoiceNumber || \"-\"}\n                          </TableCell>\n                          <TableCell className=\"text-center\" data-testid={`text-invoice-date-${doc.id}`}>\n                            {formatDate(doc.invoiceDate)}\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            <Switch checked={doc.shippingBill || false} onCheckedChange={(val) => toggleField(doc.id, \"shippingBill\", val)} data-testid={`switch-shipping-bill-${doc.id}`} />\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            <Switch checked={doc.originCertificate || false} onCheckedChange={(val) => toggleField(doc.id, \"originCertificate\", val)} data-testid={`switch-origin-cert-${doc.id}`} />\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            <Switch checked={doc.conformityCertificate || false} onCheckedChange={(val) => toggleField(doc.id, \"conformityCertificate\", val)} data-testid={`switch-conformity-cert-${doc.id}`} />\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            {editingId === doc.id ? (\n                              <Input value={editInvoice} onChange={(e) => setEditInvoice(e.target.value)} className=\"text-center\" data-testid={`input-invoice-${doc.id}`} />\n                            ) : (\n                              <span data-testid={`text-invoice-${doc.id}`}>{doc.invoice || \"-\"}</span>\n                            )}\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            {editingId === doc.id ? (\n                              <div className=\"flex items-center gap-1\">\n                                <Input type=\"number\" value={editMoneyArrival} onChange={(e) => setEditMoneyArrival(e.target.value)} className=\"text-center\" placeholder=\"المبلغ\" data-testid={`input-money-arrival-${doc.id}`} />\n                                <Select value={editMoneyArrivalCurrency} onValueChange={setEditMoneyArrivalCurrency}>\n                                  <SelectTrigger className=\"w-24\" data-testid={`select-money-currency-${doc.id}`}>\n                                    <SelectValue />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    <SelectItem value=\"CNY\">يوان</SelectItem>\n                                    <SelectItem value=\"USD\">دولار</SelectItem>\n                                  </SelectContent>\n                                </Select>\n                              </div>\n                            ) : (\n                              <span data-testid={`text-money-arrival-${doc.id}`}>\n                                {doc.moneyArrival ? (\n                                  <Badge variant=\"default\">\n                                    {doc.moneyArrival} {doc.moneyArrivalCurrency === \"CNY\" ? \"يوان\" : \"دولار\"}\n                                  </Badge>\n                                ) : \"-\"}\n                              </span>\n                            )}\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            {editingId === doc.id ? (\n                              <div className=\"flex items-center justify-center gap-1\">\n                                <Button size=\"icon\" variant=\"ghost\" onClick={() => saveEdit(doc.id)} data-testid={`button-save-${doc.id}`}>\n                                  <Save className=\"h-4 w-4\" />\n                                </Button>\n                                <Button size=\"icon\" variant=\"ghost\" onClick={() => setEditingId(null)} data-testid={`button-cancel-${doc.id}`}>\n                                  <X className=\"h-4 w-4\" />\n                                </Button>\n                              </div>\n                            ) : (\n                              <Button size=\"icon\" variant=\"ghost\" onClick={() => startEdit(doc)} data-testid={`button-edit-${doc.id}`}>\n                                <FileText className=\"h-4 w-4\" />\n                              </Button>\n                            )}\n                          </TableCell>\n                        </TableRow>\n                      );\n                    }\n                  })\n                )}\n              </TableBody>\n            </Table>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Dialog open={mergeDialogOpen} onOpenChange={setMergeDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>دمج حاويات في فاتورة واحدة</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label>رقم الفاتورة المشتركة</Label>\n              <Input\n                value={mergeInvoiceNumber}\n                onChange={(e) => setMergeInvoiceNumber(e.target.value)}\n                placeholder=\"أدخل رقم الفاتورة\"\n                data-testid=\"input-merge-invoice-number\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>اختر الحاويات للدمج</Label>\n              <div className=\"max-h-60 overflow-y-auto space-y-2 border rounded-md p-3\">\n                {ungroupedDocs.map((doc: any) => (\n                  <div key={doc.id} className=\"flex items-center gap-2\">\n                    <Checkbox\n                      checked={selectedForMerge.includes(doc.id)}\n                      onCheckedChange={() => toggleMergeSelection(doc.id)}\n                      data-testid={`checkbox-merge-${doc.id}`}\n                    />\n                    <span className=\"text-sm\">\n                      {doc.invoiceNumber || `حاوية #${doc.id}`} - {formatDate(doc.invoiceDate)}\n                    </span>\n                  </div>\n                ))}\n              </div>\n              {selectedForMerge.length > 0 && (\n                <p className=\"text-sm text-muted-foreground\">تم اختيار {selectedForMerge.length} حاوية</p>\n              )}\n            </div>\n            <Button\n              className=\"w-full\"\n              onClick={handleMerge}\n              disabled={selectedForMerge.length < 2 || mergeMutation.isPending}\n              data-testid=\"button-confirm-merge\"\n            >\n              {mergeMutation.isPending ? \"جاري الدمج...\" : \"دمج الحاويات\"}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":20966,"size_tokens":null},"client/src/lib/language-context.ts":{"content":"import { createContext, useContext } from \"react\";\nimport type { Language } from \"./translations\";\n\ninterface LanguageContextType {\n  language: Language;\n  setLanguage: (lang: Language) => void;\n}\n\nexport const LanguageContext = createContext<LanguageContextType>({\n  language: \"ar\",\n  setLanguage: () => {},\n});\n\nexport function useLanguage() {\n  return useContext(LanguageContext);\n}\n","path":null,"size_bytes":386,"size_tokens":null},"client/src/pages/expenses.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Printer, Pencil, Trash2, Plus, Receipt, TrendingDown } from \"lucide-react\";\nimport { openPrintWindow } from \"@/lib/printStyles\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport type { Expense } from \"@shared/schema\";\n\nfunction formatDateFr(dateStr: string | null | undefined): string {\n  if (!dateStr) return \"-\";\n  return new Date(dateStr).toLocaleDateString(\"fr-FR\");\n}\n\nexport default function Expenses() {\n  const { toast } = useToast();\n  const [addDialogOpen, setAddDialogOpen] = useState(false);\n  const [title, setTitle] = useState(\"\");\n  const [amount, setAmount] = useState(\"\");\n  const [currency, setCurrency] = useState(\"CNY\");\n  const [description, setDescription] = useState(\"\");\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [editExpense, setEditExpense] = useState<any>(null);\n  const [editTitle, setEditTitle] = useState(\"\");\n  const [editAmount, setEditAmount] = useState(\"\");\n  const [editCurrency, setEditCurrency] = useState(\"CNY\");\n  const [editDescription, setEditDescription] = useState(\"\");\n  const [deleteId, setDeleteId] = useState<number | null>(null);\n  const [filterCurrency, setFilterCurrency] = useState(\"all\");\n  const printRef = useRef<HTMLDivElement>(null);\n\n  const { data: expenses, isLoading } = useQuery<Expense[]>({\n    queryKey: [\"/api/expenses\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await apiRequest(\"POST\", \"/api/expenses\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/expenses\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/summary\"] });\n      setAddDialogOpen(false);\n      resetAddForm();\n      toast({ title: \"تم تسجيل المصروف بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: any }) => {\n      const res = await apiRequest(\"PATCH\", `/api/expenses/${id}`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/expenses\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/summary\"] });\n      setEditDialogOpen(false);\n      setEditExpense(null);\n      toast({ title: \"تم تحديث المصروف بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/expenses/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/expenses\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/cashbox/summary\"] });\n      setDeleteId(null);\n      toast({ title: \"تم حذف المصروف بنجاح\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"خطأ\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const resetAddForm = () => {\n    setTitle(\"\");\n    setAmount(\"\");\n    setCurrency(\"CNY\");\n    setDescription(\"\");\n  };\n\n  const handleCreate = () => {\n    if (!title || !amount) return;\n    createMutation.mutate({\n      title,\n      amount: parseFloat(amount),\n      currency,\n      description: description || null,\n    });\n  };\n\n  const openEdit = (exp: any) => {\n    setEditExpense(exp);\n    setEditTitle(exp.title);\n    setEditAmount(String(exp.amount));\n    setEditCurrency(exp.currency);\n    setEditDescription(exp.description || \"\");\n    setEditDialogOpen(true);\n  };\n\n  const handleUpdate = () => {\n    if (!editExpense) return;\n    updateMutation.mutate({\n      id: editExpense.id,\n      data: {\n        title: editTitle,\n        amount: parseFloat(editAmount),\n        currency: editCurrency,\n        description: editDescription || null,\n      },\n    });\n  };\n\n  const filteredExpenses = (expenses || []).filter((exp: any) => {\n    if (filterCurrency !== \"all\" && exp.currency !== filterCurrency) return false;\n    return true;\n  });\n\n  const totalCNY = (expenses || [])\n    .filter((e: any) => e.currency === \"CNY\")\n    .reduce((sum: number, e: any) => sum + (e.amount || 0), 0);\n\n  const totalUSD = (expenses || [])\n    .filter((e: any) => e.currency === \"USD\")\n    .reduce((sum: number, e: any) => sum + (e.amount || 0), 0);\n\n  const handlePrint = () => {\n    const printContent = printRef.current;\n    if (!printContent) return;\n    const summaryHtml = `\n      <div class=\"summary-grid\">\n        <div class=\"summary-card danger\">\n          <div class=\"summary-label\">إجمالي المصاريف (يوان)</div>\n          <div class=\"summary-value danger\">${totalCNY.toFixed(2)}<span class=\"currency-label\">CNY</span></div>\n        </div>\n        <div class=\"summary-card danger\">\n          <div class=\"summary-label\">إجمالي المصاريف (دولار)</div>\n          <div class=\"summary-value danger\">${totalUSD.toFixed(2)}<span class=\"currency-label\">USD</span></div>\n        </div>\n      </div>\n    `;\n    openPrintWindow({\n      title: \"صندوق المصاريف\",\n      content: summaryHtml + printContent.innerHTML,\n    });\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-expenses-title\">صندوق المصاريف</h1>\n          <p className=\"text-muted-foreground\">تسجيل وإدارة المصاريف</p>\n        </div>\n        <div className=\"flex gap-2 flex-wrap\">\n          <Button variant=\"outline\" onClick={handlePrint} data-testid=\"button-print-expenses\">\n            <Printer className=\"h-4 w-4\" />\n            طباعة\n          </Button>\n          <Dialog open={addDialogOpen} onOpenChange={setAddDialogOpen}>\n            <DialogTrigger asChild>\n              <Button data-testid=\"button-add-expense\">\n                <Plus className=\"h-4 w-4\" />\n                تسجيل مصروف\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-md\">\n              <DialogHeader>\n                <DialogTitle>تسجيل مصروف جديد</DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4 pt-4\">\n                <div className=\"space-y-2\">\n                  <Label>عنوان المصروف</Label>\n                  <Input\n                    data-testid=\"input-expense-title\"\n                    value={title}\n                    onChange={(e) => setTitle(e.target.value)}\n                    placeholder=\"مثال: إيجار مكتب، رواتب، نقل...\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>المبلغ</Label>\n                  <Input\n                    data-testid=\"input-expense-amount\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={amount}\n                    onChange={(e) => setAmount(e.target.value)}\n                    placeholder=\"0.00\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>العملة</Label>\n                  <Select value={currency} onValueChange={setCurrency}>\n                    <SelectTrigger data-testid=\"select-expense-currency\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"CNY\">يوان صيني (CNY)</SelectItem>\n                      <SelectItem value=\"USD\">دولار أمريكي (USD)</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>الوصف</Label>\n                  <Input\n                    data-testid=\"input-expense-description\"\n                    value={description}\n                    onChange={(e) => setDescription(e.target.value)}\n                    placeholder=\"وصف اختياري\"\n                  />\n                </div>\n                <Button className=\"w-full\" onClick={handleCreate} disabled={createMutation.isPending} data-testid=\"button-submit-expense\">\n                  {createMutation.isPending ? \"جاري التسجيل...\" : \"تسجيل المصروف\"}\n                </Button>\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <Skeleton className=\"h-24\" />\n          <Skeleton className=\"h-24\" />\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-1\">\n                <TrendingDown className=\"h-4 w-4 text-destructive\" />\n                إجمالي المصاريف (يوان)\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <span className=\"text-xl font-bold text-destructive\" data-testid=\"text-total-expenses-cny\">{totalCNY.toFixed(2)}</span>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-1\">\n                <TrendingDown className=\"h-4 w-4 text-destructive\" />\n                إجمالي المصاريف (دولار)\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <span className=\"text-xl font-bold text-destructive\" data-testid=\"text-total-expenses-usd\">{totalUSD.toFixed(2)}</span>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      <div className=\"flex items-center gap-4 flex-wrap\">\n        <div className=\"space-y-1\">\n          <Label className=\"text-xs text-muted-foreground\">العملة</Label>\n          <Select value={filterCurrency} onValueChange={setFilterCurrency}>\n            <SelectTrigger className=\"w-36\" data-testid=\"select-filter-expense-currency\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">الكل</SelectItem>\n              <SelectItem value=\"CNY\">يوان</SelectItem>\n              <SelectItem value=\"USD\">دولار</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      {isLoading ? (\n        <Skeleton className=\"h-48 w-full\" />\n      ) : filteredExpenses.length > 0 ? (\n        <Card>\n          <CardContent className=\"pt-6\" ref={printRef}>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>التاريخ</TableHead>\n                  <TableHead>العنوان</TableHead>\n                  <TableHead>المبلغ</TableHead>\n                  <TableHead>العملة</TableHead>\n                  <TableHead>الوصف</TableHead>\n                  <TableHead>إجراءات</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredExpenses.map((exp: any) => (\n                  <TableRow key={exp.id} data-testid={`row-expense-${exp.id}`}>\n                    <TableCell className=\"text-sm\">{formatDateFr(exp.createdAt)}</TableCell>\n                    <TableCell className=\"text-sm font-medium\">{exp.title}</TableCell>\n                    <TableCell className=\"font-semibold text-destructive\">\n                      -{exp.amount?.toFixed(2)}\n                    </TableCell>\n                    <TableCell className=\"text-sm\">{exp.currency === \"CNY\" ? \"يوان\" : \"دولار\"}</TableCell>\n                    <TableCell className=\"text-sm text-muted-foreground max-w-48 truncate\">{exp.description || \"-\"}</TableCell>\n                    <TableCell>\n                      <div className=\"flex gap-1\">\n                        <Button size=\"icon\" variant=\"ghost\" onClick={() => openEdit(exp)} data-testid={`button-edit-expense-${exp.id}`}>\n                          <Pencil className=\"h-4 w-4\" />\n                        </Button>\n                        <Button size=\"icon\" variant=\"ghost\" onClick={() => setDeleteId(exp.id)} data-testid={`button-delete-expense-${exp.id}`}>\n                          <Trash2 className=\"h-4 w-4 text-destructive\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      ) : (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n            <Receipt className=\"h-12 w-12 text-muted-foreground mb-3\" />\n            <p className=\"text-muted-foreground\">لا توجد مصاريف مسجلة</p>\n          </CardContent>\n        </Card>\n      )}\n\n      <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>تعديل المصروف</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"space-y-2\">\n              <Label>عنوان المصروف</Label>\n              <Input\n                data-testid=\"input-edit-expense-title\"\n                value={editTitle}\n                onChange={(e) => setEditTitle(e.target.value)}\n                placeholder=\"عنوان المصروف\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>المبلغ</Label>\n              <Input\n                data-testid=\"input-edit-expense-amount\"\n                type=\"number\"\n                step=\"0.01\"\n                value={editAmount}\n                onChange={(e) => setEditAmount(e.target.value)}\n                placeholder=\"0.00\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>العملة</Label>\n              <Select value={editCurrency} onValueChange={setEditCurrency}>\n                <SelectTrigger data-testid=\"select-edit-expense-currency\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"CNY\">يوان صيني (CNY)</SelectItem>\n                  <SelectItem value=\"USD\">دولار أمريكي (USD)</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>الوصف</Label>\n              <Input\n                data-testid=\"input-edit-expense-description\"\n                value={editDescription}\n                onChange={(e) => setEditDescription(e.target.value)}\n                placeholder=\"وصف اختياري\"\n              />\n            </div>\n            <Button className=\"w-full\" onClick={handleUpdate} disabled={updateMutation.isPending} data-testid=\"button-submit-edit-expense\">\n              {updateMutation.isPending ? \"جاري التحديث...\" : \"تحديث المصروف\"}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={deleteId !== null} onOpenChange={(open) => { if (!open) setDeleteId(null); }}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>تأكيد الحذف</AlertDialogTitle>\n            <AlertDialogDescription>هل أنت متأكد من حذف هذا المصروف؟ سيتم أيضاً حذف القيد المرتبط في صندوق الحسابات.</AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>إلغاء</AlertDialogCancel>\n            <AlertDialogAction onClick={() => deleteId && deleteMutation.mutate(deleteId)} data-testid=\"button-confirm-delete-expense\">\n              حذف\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":17561,"size_tokens":null},"client/src/lib/translations.ts":{"content":"export type Language = \"ar\" | \"zh\";\n\nconst translations: Record<string, Record<Language, string>> = {\n  // Sidebar\n  \"sidebar.main\": { ar: \"الرئيسية\", zh: \"主菜单\" },\n  \"sidebar.operations\": { ar: \"العمليات\", zh: \"操作\" },\n  \"sidebar.dashboard\": { ar: \"لوحة التحكم\", zh: \"控制面板\" },\n  \"sidebar.products\": { ar: \"المنتجات\", zh: \"产品\" },\n  \"sidebar.warehouses\": { ar: \"المخازن\", zh: \"仓库\" },\n  \"sidebar.orders\": { ar: \"إنشاء طلب\", zh: \"创建订单\" },\n  \"sidebar.deliveries\": { ar: \"تسليم البضاعة\", zh: \"收货\" },\n  \"sidebar.warehouseInventory\": { ar: \"جرد المخزن\", zh: \"仓库盘点\" },\n  \"sidebar.shipping\": { ar: \"تحميل البضاعة\", zh: \"装运货物\" },\n\n  // Common\n  \"common.search\": { ar: \"بحث...\", zh: \"搜索...\" },\n  \"common.save\": { ar: \"حفظ\", zh: \"保存\" },\n  \"common.cancel\": { ar: \"إلغاء\", zh: \"取消\" },\n  \"common.delete\": { ar: \"حذف\", zh: \"删除\" },\n  \"common.edit\": { ar: \"تعديل\", zh: \"编辑\" },\n  \"common.add\": { ar: \"إضافة\", zh: \"添加\" },\n  \"common.confirm\": { ar: \"تأكيد\", zh: \"确认\" },\n  \"common.close\": { ar: \"إغلاق\", zh: \"关闭\" },\n  \"common.print\": { ar: \"طباعة\", zh: \"打印\" },\n  \"common.loading\": { ar: \"جاري التحميل...\", zh: \"加载中...\" },\n  \"common.noData\": { ar: \"لا توجد بيانات\", zh: \"无数据\" },\n  \"common.error\": { ar: \"خطأ\", zh: \"错误\" },\n  \"common.success\": { ar: \"تم بنجاح\", zh: \"操作成功\" },\n  \"common.name\": { ar: \"الاسم\", zh: \"名称\" },\n  \"common.quantity\": { ar: \"الكمية\", zh: \"数量\" },\n  \"common.status\": { ar: \"الحالة\", zh: \"状态\" },\n  \"common.date\": { ar: \"التاريخ\", zh: \"日期\" },\n  \"common.category\": { ar: \"الفئة\", zh: \"类别\" },\n  \"common.supplier\": { ar: \"المورد\", zh: \"供应商\" },\n  \"common.warehouse\": { ar: \"المخزن\", zh: \"仓库\" },\n  \"common.product\": { ar: \"المنتج\", zh: \"产品\" },\n  \"common.next\": { ar: \"التالي\", zh: \"下一步\" },\n  \"common.back\": { ar: \"رجوع\", zh: \"返回\" },\n  \"common.total\": { ar: \"المجموع\", zh: \"总计\" },\n  \"common.all\": { ar: \"الكل\", zh: \"全部\" },\n  \"common.reset\": { ar: \"تصفير\", zh: \"重置\" },\n\n  // Status labels\n  \"status.purchase_order\": { ar: \"طلب شراء\", zh: \"采购订单\" },\n  \"status.ordered\": { ar: \"تم الطلب\", zh: \"已下单\" },\n  \"status.received\": { ar: \"تم الاستلام\", zh: \"已收货\" },\n  \"status.semi_manufactured\": { ar: \"نصف مصنعة\", zh: \"半成品\" },\n  \"status.shipping\": { ar: \"شحن\", zh: \"运输中\" },\n  \"status.arrived\": { ar: \"وصل\", zh: \"已到达\" },\n\n  // Dashboard\n  \"dashboard.title\": { ar: \"لوحة التحكم\", zh: \"控制面板\" },\n  \"dashboard.overview\": { ar: \"نظرة عامة على المخزون والعمليات\", zh: \"库存和运营概览\" },\n  \"dashboard.totalProducts\": { ar: \"إجمالي المنتجات\", zh: \"产品总数\" },\n  \"dashboard.totalSuppliers\": { ar: \"إجمالي الموردين\", zh: \"供应商总数\" },\n  \"dashboard.containersShipping\": { ar: \"حاويات قيد الشحن\", zh: \"运输中的集装箱\" },\n  \"dashboard.containersArrived\": { ar: \"حاويات وصلت\", zh: \"已到达的集装箱\" },\n  \"dashboard.productsByStatus\": { ar: \"المنتجات حسب الحالة\", zh: \"按状态分类的产品\" },\n  \"dashboard.recentContainers\": { ar: \"أحدث الحاويات\", zh: \"最新集装箱\" },\n  \"dashboard.containerNumber\": { ar: \"رقم الحاوية\", zh: \"集装箱号\" },\n  \"dashboard.items\": { ar: \"أصناف\", zh: \"项目\" },\n\n  // Products\n  \"products.title\": { ar: \"المنتجات\", zh: \"产品\" },\n  \"products.subtitle\": { ar: \"إدارة المنتجات والمخزون\", zh: \"产品和库存管理\" },\n  \"products.addProduct\": { ar: \"إضافة منتج\", zh: \"添加产品\" },\n  \"products.addComposite\": { ar: \"إضافة منتج مركب\", zh: \"添加组合产品\" },\n  \"products.importExcel\": { ar: \"استيراد Excel\", zh: \"导入Excel\" },\n  \"products.resetQuantities\": { ar: \"تصفير الكميات\", zh: \"重置数量\" },\n  \"products.productName\": { ar: \"اسم المنتج\", zh: \"产品名称\" },\n  \"products.remaining\": { ar: \"المتبقي\", zh: \"剩余\" },\n  \"products.productCount\": { ar: \"منتجات\", zh: \"产品\" },\n  \"products.noProducts\": { ar: \"لا توجد منتجات\", zh: \"没有产品\" },\n  \"products.confirmDelete\": { ar: \"هل أنت متأكد من حذف هذا المنتج؟\", zh: \"确定要删除此产品吗？\" },\n  \"products.deleteSuccess\": { ar: \"تم حذف المنتج بنجاح\", zh: \"产品删除成功\" },\n  \"products.createSuccess\": { ar: \"تم إنشاء المنتج بنجاح\", zh: \"产品创建成功\" },\n  \"products.statusAge\": { ar: \"يوم في هذه الحالة\", zh: \"天处于此状态\" },\n  \"products.parts\": { ar: \"الأجزاء\", zh: \"部件\" },\n  \"products.partName\": { ar: \"اسم الجزء\", zh: \"部件名称\" },\n  \"products.length\": { ar: \"الطول\", zh: \"长度\" },\n  \"products.width\": { ar: \"العرض\", zh: \"宽度\" },\n  \"products.height\": { ar: \"الارتفاع\", zh: \"高度\" },\n  \"products.weight\": { ar: \"الوزن\", zh: \"重量\" },\n  \"products.piecesPerCarton\": { ar: \"قطعة/كرتون\", zh: \"件/箱\" },\n  \"products.kg\": { ar: \"كجم\", zh: \"公斤\" },\n  \"products.cm\": { ar: \"سم\", zh: \"厘米\" },\n\n  // Orders\n  \"orders.title\": { ar: \"إنشاء طلب\", zh: \"创建订单\" },\n  \"orders.subtitle\": { ar: \"إنشاء طلبات شراء جديدة\", zh: \"创建新采购订单\" },\n  \"orders.newOrder\": { ar: \"طلب جديد\", zh: \"新订单\" },\n  \"orders.selectSupplier\": { ar: \"اختر المورد\", zh: \"选择供应商\" },\n  \"orders.selectProducts\": { ar: \"اختر المنتجات\", zh: \"选择产品\" },\n  \"orders.orderSummary\": { ar: \"ملخص الطلب\", zh: \"订单摘要\" },\n  \"orders.quantityOrdered\": { ar: \"الكمية المطلوبة\", zh: \"订购数量\" },\n  \"orders.price\": { ar: \"السعر\", zh: \"价格\" },\n  \"orders.currency\": { ar: \"العملة\", zh: \"货币\" },\n  \"orders.orderHistory\": { ar: \"سجل الطلبات\", zh: \"订单历史\" },\n  \"orders.orderDate\": { ar: \"تاريخ الطلب\", zh: \"订单日期\" },\n  \"orders.noOrders\": { ar: \"لا توجد طلبات\", zh: \"没有订单\" },\n  \"orders.createSuccess\": { ar: \"تم إنشاء الطلب بنجاح\", zh: \"订单创建成功\" },\n  \"orders.confirmOrder\": { ar: \"تأكيد الطلب\", zh: \"确认订单\" },\n\n  // Deliveries\n  \"deliveries.title\": { ar: \"تسليم البضاعة\", zh: \"收货\" },\n  \"deliveries.subtitle\": { ar: \"استلام البضائع من الموردين\", zh: \"从供应商接收货物\" },\n  \"deliveries.newDelivery\": { ar: \"تسليم جديد\", zh: \"新收货\" },\n  \"deliveries.selectSupplier\": { ar: \"اختر المورد\", zh: \"选择供应商\" },\n  \"deliveries.selectWarehouse\": { ar: \"اختر المخزن\", zh: \"选择仓库\" },\n  \"deliveries.length\": { ar: \"طول\", zh: \"长\" },\n  \"deliveries.width\": { ar: \"عرض\", zh: \"宽\" },\n  \"deliveries.height\": { ar: \"ارتفاع\", zh: \"高\" },\n  \"deliveries.weight\": { ar: \"وزن\", zh: \"重量\" },\n  \"deliveries.pcsCarton\": { ar: \"قطعة/كرتون\", zh: \"件/箱\" },\n  \"deliveries.deliveryHistory\": { ar: \"سجل التسليمات\", zh: \"收货历史\" },\n  \"deliveries.noDeliveries\": { ar: \"لا توجد تسليمات\", zh: \"没有收货记录\" },\n  \"deliveries.createSuccess\": { ar: \"تم تسليم البضاعة بنجاح\", zh: \"收货成功\" },\n  \"deliveries.confirmDelivery\": { ar: \"تأكيد التسليم\", zh: \"确认收货\" },\n  \"deliveries.parts\": { ar: \"الأجزاء\", zh: \"部件\" },\n\n  // Shipping\n  \"shipping.title\": { ar: \"تحميل البضاعة\", zh: \"装运货物\" },\n  \"shipping.subtitle\": { ar: \"شحن البضائع في حاويات\", zh: \"将货物装入集装箱\" },\n  \"shipping.newContainer\": { ar: \"حاوية جديدة\", zh: \"新集装箱\" },\n  \"shipping.containerNumber\": { ar: \"رقم الحاوية\", zh: \"集装箱号\" },\n  \"shipping.invoiceNumber\": { ar: \"رقم الفاتورة\", zh: \"发票号\" },\n  \"shipping.shippingCompany\": { ar: \"شركة الشحن\", zh: \"运输公司\" },\n  \"shipping.selectWarehouse\": { ar: \"اختر المخزن\", zh: \"选择仓库\" },\n  \"shipping.containerHistory\": { ar: \"سجل الحاويات\", zh: \"集装箱历史\" },\n  \"shipping.noContainers\": { ar: \"لا توجد حاويات\", zh: \"没有集装箱\" },\n  \"shipping.shipSuccess\": { ar: \"تم شحن الحاوية بنجاح\", zh: \"集装箱装运成功\" },\n  \"shipping.confirmShip\": { ar: \"تأكيد الشحن\", zh: \"确认装运\" },\n  \"shipping.items\": { ar: \"الأصناف\", zh: \"项目\" },\n  \"shipping.view\": { ar: \"عرض\", zh: \"查看\" },\n\n  // Warehouses\n  \"warehouses.title\": { ar: \"المخازن\", zh: \"仓库\" },\n  \"warehouses.subtitle\": { ar: \"إدارة المخازن\", zh: \"仓库管理\" },\n  \"warehouses.addWarehouse\": { ar: \"إضافة مخزن\", zh: \"添加仓库\" },\n  \"warehouses.warehouseName\": { ar: \"اسم المخزن\", zh: \"仓库名称\" },\n  \"warehouses.noWarehouses\": { ar: \"لا توجد مخازن\", zh: \"没有仓库\" },\n  \"warehouses.createSuccess\": { ar: \"تم إنشاء المخزن بنجاح\", zh: \"仓库创建成功\" },\n  \"warehouses.editSuccess\": { ar: \"تم تعديل المخزن بنجاح\", zh: \"仓库编辑成功\" },\n  \"warehouses.deleteSuccess\": { ar: \"تم حذف المخزن بنجاح\", zh: \"仓库删除成功\" },\n  \"warehouses.confirmDelete\": { ar: \"هل أنت متأكد من حذف هذا المخزن؟\", zh: \"确定要删除此仓库吗？\" },\n\n  // Warehouse Inventory\n  \"warehouseInv.title\": { ar: \"جرد المخزن\", zh: \"仓库盘点\" },\n  \"warehouseInv.subtitle\": { ar: \"البضائع المستلمة في المخزن\", zh: \"仓库已收货物\" },\n  \"warehouseInv.totalProducts\": { ar: \"إجمالي المنتجات\", zh: \"产品总数\" },\n  \"warehouseInv.totalQuantity\": { ar: \"إجمالي الكمية\", zh: \"总数量\" },\n  \"warehouseInv.totalWeight\": { ar: \"إجمالي الوزن\", zh: \"总重量\" },\n  \"warehouseInv.totalVolume\": { ar: \"إجمالي الحجم\", zh: \"总体积\" },\n  \"warehouseInv.volume\": { ar: \"الحجم\", zh: \"体积\" },\n  \"warehouseInv.dimensions\": { ar: \"الأبعاد\", zh: \"尺寸\" },\n  \"warehouseInv.noInventory\": { ar: \"لا توجد بضائع في المخزن\", zh: \"仓库中没有货物\" },\n\n  // Header\n  \"header.logout\": { ar: \"تسجيل الخروج\", zh: \"退出登录\" },\n  \"header.switchLang\": { ar: \"中文\", zh: \"العربية\" },\n\n  // Profile\n  \"profile.title\": { ar: \"الملف الشخصي\", zh: \"个人资料\" },\n  \"profile.username\": { ar: \"اسم المستخدم\", zh: \"用户名\" },\n  \"profile.displayName\": { ar: \"اسم العرض\", zh: \"显示名称\" },\n  \"profile.changePassword\": { ar: \"تغيير كلمة المرور (اختياري)\", zh: \"更改密码（可选）\" },\n  \"profile.currentPassword\": { ar: \"كلمة المرور الحالية\", zh: \"当前密码\" },\n  \"profile.newPassword\": { ar: \"كلمة المرور الجديدة\", zh: \"新密码\" },\n  \"profile.confirmPassword\": { ar: \"تأكيد كلمة المرور الجديدة\", zh: \"确认新密码\" },\n  \"profile.save\": { ar: \"حفظ\", zh: \"保存\" },\n  \"profile.saving\": { ar: \"جاري الحفظ...\", zh: \"保存中...\" },\n  \"profile.cancel\": { ar: \"إلغاء\", zh: \"取消\" },\n  \"profile.success\": { ar: \"تم تحديث الملف الشخصي بنجاح\", zh: \"个人资料更新成功\" },\n  \"profile.errorRequired\": { ar: \"يرجى ملء اسم المستخدم واسم العرض\", zh: \"请填写用户名和显示名称\" },\n  \"profile.errorMismatch\": { ar: \"كلمة المرور الجديدة غير متطابقة\", zh: \"新密码不匹配\" },\n  \"profile.errorCurrentRequired\": { ar: \"يرجى إدخال كلمة المرور الحالية\", zh: \"请输入当前密码\" },\n  \"profile.errorGeneric\": { ar: \"فشل في التحديث\", zh: \"更新失败\" },\n};\n\nexport function t(key: string, lang: Language): string {\n  return translations[key]?.[lang] ?? key;\n}\n\nexport function getStatusLabel(status: string, lang: Language): string {\n  return t(`status.${status}`, lang);\n}\n","path":null,"size_bytes":12202,"size_tokens":null},"client/src/hooks/use-status-alerts.ts":{"content":"import { useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Product } from \"@shared/schema\";\n\ninterface AlertRule {\n  status: string;\n  label: string;\n  thresholdMs: number;\n  intervalMs: number;\n}\n\nconst ALERT_RULES: AlertRule[] = [\n  {\n    status: \"purchase_order\",\n    label: \"طلب شراء\",\n    thresholdMs: 7 * 24 * 60 * 60 * 1000,\n    intervalMs: 60 * 60 * 1000,\n  },\n  {\n    status: \"ordered\",\n    label: \"تم الطلب\",\n    thresholdMs: 30 * 24 * 60 * 60 * 1000,\n    intervalMs: 24 * 60 * 60 * 1000,\n  },\n  {\n    status: \"received\",\n    label: \"تم الاستلام\",\n    thresholdMs: 7 * 24 * 60 * 60 * 1000,\n    intervalMs: 60 * 60 * 1000,\n  },\n];\n\nconst STORAGE_KEY = \"status_alerts_last_shown\";\n\nfunction getLastShown(): Record<string, number> {\n  try {\n    return JSON.parse(localStorage.getItem(STORAGE_KEY) || \"{}\");\n  } catch {\n    return {};\n  }\n}\n\nfunction setLastShown(key: string, time: number) {\n  const data = getLastShown();\n  data[key] = time;\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));\n}\n\nexport function useStatusAlerts() {\n  const { toast } = useToast();\n\n  const { data: products } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n    refetchInterval: 60 * 1000,\n  });\n\n  useEffect(() => {\n    if (!products || products.length === 0) return;\n\n    const now = Date.now();\n    const lastShown = getLastShown();\n\n    for (const rule of ALERT_RULES) {\n      const overdueProducts = products.filter((p) => {\n        if (p.status !== rule.status || !p.statusChangedAt) return false;\n        const changedAt = new Date(p.statusChangedAt).getTime();\n        return now - changedAt > rule.thresholdMs;\n      });\n\n      if (overdueProducts.length === 0) continue;\n\n      const alertKey = `alert_${rule.status}`;\n      const lastAlertTime = lastShown[alertKey] || 0;\n\n      if (now - lastAlertTime < rule.intervalMs) continue;\n\n      const thresholdLabel =\n        rule.thresholdMs >= 30 * 24 * 60 * 60 * 1000 ? \"شهر\" : \"أسبوع\";\n\n      const productNames = overdueProducts\n        .slice(0, 5)\n        .map((p) => p.name)\n        .join(\"، \");\n      const extra =\n        overdueProducts.length > 5\n          ? ` و ${overdueProducts.length - 5} منتج آخر`\n          : \"\";\n\n      toast({\n        title: `تنبيه: ${overdueProducts.length} منتج بحالة \"${rule.label}\" منذ أكثر من ${thresholdLabel}`,\n        description: `${productNames}${extra}`,\n        variant: \"destructive\",\n        duration: 10000,\n      });\n\n      setLastShown(alertKey, now);\n    }\n  }, [products, toast]);\n}\n","path":null,"size_bytes":2650,"size_tokens":null},"client/src/lib/printStyles.ts":{"content":"export function getProfessionalPrintStyles(dir: string = \"rtl\", textAlign: string = \"right\") {\n  return `\n    * { margin: 0; padding: 0; box-sizing: border-box; }\n    \n    @page {\n      size: A4;\n      margin: 15mm 12mm;\n    }\n    \n    body {\n      font-family: 'Segoe UI', 'Cairo', Tahoma, Arial, sans-serif;\n      padding: 0;\n      direction: ${dir};\n      color: #1a1a2e;\n      font-size: 13px;\n      line-height: 1.6;\n      background: #fff;\n    }\n\n    .print-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      border-bottom: 3px solid #1a1a2e;\n      padding-bottom: 16px;\n      margin-bottom: 24px;\n    }\n\n    .print-header-logo {\n      flex-shrink: 0;\n    }\n\n    .print-header-logo img {\n      max-width: 140px;\n      height: auto;\n    }\n\n    .print-header-info {\n      text-align: ${textAlign === \"right\" ? \"left\" : \"right\"};\n      flex-shrink: 0;\n    }\n\n    .print-header-info .company-name {\n      font-size: 10px;\n      color: #666;\n      margin-bottom: 2px;\n    }\n\n    .print-header-info .print-date {\n      font-size: 11px;\n      color: #888;\n    }\n\n    .print-title {\n      text-align: center;\n      margin-bottom: 8px;\n    }\n\n    .print-title h1 {\n      font-size: 22px;\n      font-weight: 700;\n      color: #1a1a2e;\n      margin: 0;\n    }\n\n    .print-title .subtitle {\n      font-size: 14px;\n      color: #555;\n      margin-top: 4px;\n    }\n\n    .print-divider {\n      height: 1px;\n      background: linear-gradient(to ${textAlign === \"right\" ? \"left\" : \"right\"}, #1a1a2e, transparent);\n      margin: 16px 0;\n    }\n\n    .info-row {\n      display: flex;\n      gap: 24px;\n      flex-wrap: wrap;\n      margin-bottom: 16px;\n      font-size: 13px;\n    }\n\n    .info-row .info-item {\n      display: flex;\n      gap: 6px;\n      align-items: center;\n    }\n\n    .info-row .info-label {\n      color: #666;\n      font-weight: 400;\n    }\n\n    .info-row .info-value {\n      font-weight: 600;\n      color: #1a1a2e;\n    }\n\n    .summary-grid {\n      display: grid;\n      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n      gap: 12px;\n      margin: 20px 0;\n    }\n\n    .summary-card {\n      border: 1.5px solid #e0e0e0;\n      border-radius: 8px;\n      padding: 14px 16px;\n      background: #fafbfc;\n      text-align: center;\n    }\n\n    .summary-card.highlight {\n      border-color: #1a1a2e;\n      background: #f0f1f5;\n    }\n\n    .summary-card.success {\n      border-color: #27ae60;\n      background: #f0faf4;\n    }\n\n    .summary-card.danger {\n      border-color: #e74c3c;\n      background: #fdf0ef;\n    }\n\n    .summary-label {\n      font-size: 11px;\n      color: #777;\n      text-transform: uppercase;\n      letter-spacing: 0.3px;\n      margin-bottom: 6px;\n      font-weight: 500;\n    }\n\n    .summary-value {\n      font-size: 20px;\n      font-weight: 700;\n      color: #1a1a2e;\n    }\n\n    .summary-value.success { color: #1e8449; }\n    .summary-value.danger { color: #c0392b; }\n    .summary-value.income { color: #1e8449; }\n    .summary-value.expense { color: #c0392b; }\n    .summary-value .currency-label {\n      font-size: 11px;\n      font-weight: 400;\n      color: #999;\n      margin-${textAlign === \"right\" ? \"right\" : \"left\"}: 4px;\n    }\n\n    table {\n      width: 100%;\n      border-collapse: separate;\n      border-spacing: 0;\n      margin: 16px 0;\n      font-size: 12px;\n    }\n\n    thead th {\n      background: #1a1a2e;\n      color: #fff;\n      font-weight: 600;\n      padding: 10px 12px;\n      text-align: ${textAlign};\n      font-size: 12px;\n      letter-spacing: 0.3px;\n      white-space: nowrap;\n    }\n\n    thead th:first-child {\n      border-radius: ${dir === \"rtl\" ? \"0 6px 0 0\" : \"6px 0 0 0\"};\n    }\n\n    thead th:last-child {\n      border-radius: ${dir === \"rtl\" ? \"6px 0 0 0\" : \"0 6px 0 0\"};\n    }\n\n    tbody td {\n      padding: 9px 12px;\n      border-bottom: 1px solid #eee;\n      text-align: ${textAlign};\n      color: #333;\n    }\n\n    tbody tr:nth-child(even) {\n      background: #f8f9fb;\n    }\n\n    tbody tr:last-child td {\n      border-bottom: 2px solid #1a1a2e;\n    }\n\n    tbody tr:last-child td:first-child {\n      border-radius: ${dir === \"rtl\" ? \"0 0 6px 0\" : \"0 0 0 6px\"};\n    }\n\n    tbody tr:last-child td:last-child {\n      border-radius: ${dir === \"rtl\" ? \"0 0 0 6px\" : \"0 0 6px 0\"};\n    }\n\n    .text-center { text-align: center; }\n\n    .totals-section {\n      margin-top: 20px;\n      padding: 16px 20px;\n      background: #f0f1f5;\n      border-radius: 8px;\n      border: 1.5px solid #d0d3dc;\n    }\n\n    .total-row {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 6px 0;\n      font-size: 15px;\n    }\n\n    .total-row + .total-row {\n      border-top: 1px solid #d0d3dc;\n    }\n\n    .total-row .total-label { \n      color: #555;\n      font-weight: 500;\n    }\n\n    .total-row .total-amount {\n      font-weight: 700;\n      font-size: 17px;\n      color: #1a1a2e;\n    }\n\n    .badge {\n      display: inline-block;\n      padding: 2px 10px;\n      border-radius: 12px;\n      font-size: 11px;\n      font-weight: 600;\n    }\n\n    .badge-received { background: #d4edda; color: #155724; }\n    .badge-semi { background: #d1ecf1; color: #0c5460; }\n    .badge-success { background: #d4edda; color: #155724; }\n    .badge-danger { background: #f8d7da; color: #721c24; }\n    .badge-warning { background: #fff3cd; color: #856404; }\n    .badge-info { background: #d1ecf1; color: #0c5460; }\n    .badge-default { background: #e2e3e5; color: #383d41; }\n    .badge-confirmed { background: #d4edda; color: #155724; }\n    .badge-pending { background: #fff3cd; color: #856404; }\n\n    .yes { color: #1e8449; font-weight: 700; }\n    .no { color: #c0392b; font-weight: 700; }\n\n    .remaining { color: #c0392b; }\n    .paid { color: #27ae60; }\n    .income { color: #27ae60; }\n    .expense { color: #c0392b; }\n\n    .section-title {\n      font-size: 15px;\n      font-weight: 700;\n      color: #1a1a2e;\n      margin: 24px 0 10px;\n      padding-bottom: 6px;\n      border-bottom: 2px solid #eee;\n    }\n\n    .parts-table { margin: 8px 0; }\n    .parts-table td, .parts-table th { padding: 5px 8px; font-size: 11px; }\n\n    .print-footer {\n      margin-top: 40px;\n      padding-top: 12px;\n      border-top: 2px solid #1a1a2e;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      font-size: 10px;\n      color: #999;\n    }\n\n    .print-footer .footer-left,\n    .print-footer .footer-right {\n      display: flex;\n      gap: 16px;\n    }\n\n    .no-print { display: none !important; }\n\n    @media print {\n      body { padding: 0; -webkit-print-color-adjust: exact; print-color-adjust: exact; }\n      thead th { background: #1a1a2e !important; color: #fff !important; }\n      tbody tr:nth-child(even) { background: #f8f9fb !important; }\n      .summary-card { background: #fafbfc !important; }\n      .summary-card.highlight { background: #f0f1f5 !important; }\n      .summary-card.success { background: #f0faf4 !important; }\n      .summary-card.danger { background: #fdf0ef !important; }\n      .totals-section { background: #f0f1f5 !important; }\n      .badge-received { background: #d4edda !important; }\n      .badge-semi { background: #d1ecf1 !important; }\n      .badge-success { background: #d4edda !important; }\n      .badge-danger { background: #f8d7da !important; }\n      .badge-warning { background: #fff3cd !important; }\n      .badge-info { background: #d1ecf1 !important; }\n      .badge-default { background: #e2e3e5 !important; }\n    }\n  `;\n}\n\nexport function generatePrintHeader(title: string, subtitle?: string, dir: string = \"rtl\") {\n  const dateStr = new Date().toLocaleDateString(\"fr-FR\");\n  const textAlign = dir === \"rtl\" ? \"left\" : \"right\";\n  return `\n    <div class=\"print-header\">\n      <div class=\"print-header-logo\">\n        <img src=\"/images/gnt-logo.png\" alt=\"GNT\" />\n      </div>\n      <div class=\"print-header-info\" style=\"text-align: ${textAlign};\">\n        <div class=\"print-date\">${dateStr}</div>\n      </div>\n    </div>\n    <div class=\"print-title\">\n      <h1>${title}</h1>\n      ${subtitle ? `<div class=\"subtitle\">${subtitle}</div>` : \"\"}\n    </div>\n    <div class=\"print-divider\"></div>\n  `;\n}\n\nexport function generatePrintFooter() {\n  return `\n    <div class=\"print-footer\">\n      <div class=\"footer-left\">\n        <span>GNT Trading</span>\n      </div>\n      <div class=\"footer-right\">\n        <span>${new Date().toLocaleDateString(\"fr-FR\")} ${new Date().toLocaleTimeString(\"fr-FR\", { hour: \"2-digit\", minute: \"2-digit\" })}</span>\n      </div>\n    </div>\n  `;\n}\n\nexport function openPrintWindow(options: {\n  title: string;\n  subtitle?: string;\n  content: string;\n  dir?: string;\n  lang?: string;\n}) {\n  const { title, subtitle, content, dir = \"rtl\", lang = \"ar\" } = options;\n  const textAlign = dir === \"rtl\" ? \"right\" : \"left\";\n  const printWindow = window.open(\"\", \"_blank\");\n  if (!printWindow) return;\n  \n  printWindow.document.write(`\n    <!DOCTYPE html>\n    <html dir=\"${dir}\" lang=\"${lang}\">\n    <head>\n      <meta charset=\"utf-8\">\n      <title>${title}</title>\n      <style>${getProfessionalPrintStyles(dir, textAlign)}</style>\n    </head>\n    <body>\n      ${generatePrintHeader(title, subtitle, dir)}\n      ${content}\n      ${generatePrintFooter()}\n    </body>\n    </html>\n  `);\n  printWindow.document.close();\n  setTimeout(() => printWindow.print(), 300);\n}\n","path":null,"size_bytes":9327,"size_tokens":null}},"version":2}